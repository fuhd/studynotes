CSRF之攻击手段与影响
=================================================================
首先让我们来看一下针对`CSRF`漏洞实施的 **两种典型的攻击模式**。即 **“输入－执行”这种简单模式下的攻击手段** 以及
**中途包含确认页面时的攻击方法**。

### “输入－执行”模式的CSRF攻击
此处用更改密码页面作为“输入－执行”模式下关键处理的例子。以下`PHP`脚本展示了更改密码处理的概要。
```php
//代码清单：/45/45-001.php（登录脚本）

<?php   //用来确认用户已登录的脚本
    session_start();
    $id = @$_GET['id'];
    if(! $id) $id = 'yamada';
    $_SESSION['id'] = $id;
?>
<body>
已登录 (id:<?php echo
    htmlspecialchars($id, ENT_NOQUOTES 'UTF-8'); ?>) <br>
<a href="45-002.php">更改密码</a>
</body>
```
```php
//代码清单：/45/45-002.php（密码输入页面）

<?php
    session_start();
    //确认登录 省略
?>
<body>
<form action="45-003.php" method="POST">
新密码 <input name="pwd" type="password"><br>
<input type="submit" value="更改密码">
</form>
</body>
```
```php
//代码清单：/45/45-003.php（执行更改密码）

<?php
    function ex($s) {       //用于防范XSS的HTML转义及显示处理函数
        echo htmlspecialhars($s, ENT_COMPAT, 'UTF-8');
    }
    session_start();
    $id = $_SESSION['id'];  //取得用户名
    //确认登录 省略
    $pwd = $_POST['pwd'];   //取得用户密码
    //更改密码处理 将用户$id的密码更改为$pwd
?>
<body>
<?php ex($id); ?>
</body>
```