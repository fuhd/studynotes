对外接口
================================================================================
elasticsearch对外提供的API是以 **HTTP协议** 的方式，通过JSON格式以 **REST** 约定对外提供。
**HTTP配置文件是放在elasticsearch.yml中**，注意，所有与HTTP配置相关的内容都是 **静态配置**，
也就是 **需要重启后才生效**。HTTP对外接口模块是可以禁用的，只需要设置 **http.enabled为false**
即可。elasticsearch **集群中的通信是通过内部接口实现的**，而不是HTTP协议。在集群中不需要所有节
点都开启HTTP协议，**正常情况下，只需要在一个节点上开启HTTP协议**。

### 1.API约定

#### 1.1.多索引参数
大多数API支持 **多索引查询**，就是 **同时可以查询多个索引中的数据**，例如，参数test1、test2、
test3表示同时搜索test1、test2、test3三个索引中的数据（或者用 `_all` 全部索引，**`_all`是内
部定义的关键字**）。**在参数中同时支持通配符的操作**，例如 +test*、-test3表示查询所有test开头
的索引，排除test3。多索引查询还支持以下参数：
+ **ignore_unavailable**：当索引不存在或者关闭的时候，是否忽略这些索引，值为true和false。
+ **allow_no_indices**：当使用通配符查询所有索引的时候，当有索引不存在的时候是否返回查询失败。
值为值为true和false。
+ **expand_wildcards**: 控制通配符索引表达式匹配具体哪一类的索引，值为open，close，none，all。
open表示只支持开启状态的索引，close表示只支持关闭状态的索引，none表示不可用，all表示同时支持open
和close索引。
```
注意：文档操作API和索引别名API不支持多索引参数。
```

#### 1.2.日期筛选
**日期筛选可以限定时间序列索引的搜索范围**，而不是搜索全部内容，通过时间限定，可以从集群中减少搜索的
内容，提高搜索效率和减少资源占用。
```
注意：几乎所有的API都支持日期筛选。
```
日期筛选的语法为：
```
<static_name{date_math_expr{date_format|time_zone}}>
```
语法解释：
+ **static_name**： 索引的名称；
+ **date_math_expr**：动态日期计算表达式；
+ **date_format**：日期格式；
+ **time_zone**：时区，默认为UTC；

例如：
```shell
curl -XGET '127.0.0.1:9200/<logstash-{now%2Fd-2d}>/_search'{
  "query": {......}
}
```
```
提示：由于URL编码的问题，上面的/被替换成了%2F：now/d-2d 被转换为 now%2Fd-2d
```
假设当前时间为2013.7.17日中午，下面列举几个例子：
```
<secilog-{now/d}>  ：                        secilog-2013.07.17
<secilog-{now/M}>  ：                        secilog-2013.07.01
<secilog-{now/M{YYYY.MM}}>  ：               secilog-2013.07
<secilog-{now/M-1M{YYYY.MM}}>   ：           secilog-2013.06
<secilog-{now/d{YYYY.MM.dd|+12:00}}  ：      secilog-2013.7.18 
```

### 2.REST介绍

### 3.Head插件安装
在学习Elasticsearch的过程中也要借助一些工具来进行。官方文档中的模拟工具用的是 **curl**，这是
控制台工具，不是很直观。这里用 **Head插件** 来作为请求的工具。

插件安装，在 **elasticsearch/bin目录** 下执行下面的命令：
```shell
./plugin install mobz/elasticsearch-head
```
安装成功后，启动Elasticsearch，然后在浏览器中输入：
```
http://127.0.0.1:9200/_plugin/head/
```
可以看到如下图：

![Head插件安装](img/head.png)

在后面大多数的接口操作中使用Any Request面板进行交互：

![AnyRequest](img/AnyRequest.png)

**注意：在请求URL中要用127.0.0.1或者绑定的具体IP地址，用localhost不起作用**。

### 4.创建库

### 5.插入数据

### 6.修改文档

### 7.查询文档

### 8.删除文档

### 9.删除库
