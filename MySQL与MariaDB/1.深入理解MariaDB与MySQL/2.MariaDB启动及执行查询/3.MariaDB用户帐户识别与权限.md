MariaDB用户帐户识别与权限
============================================

### 用户识别
与其他DBMS略有不同，MariaDB的用户帐号不仅包含 **用户名**，而且用户的 **连接点（运行客户端的主机名，域名，
IP地址）** 也是用户帐号的组成部分。在MariaDB中用于包围标识符，常常使用 **单引号（'）** 表示。
示例，下面的用户帐号只能在运行MariaDB服务器的机器中使用`svc_id`连接MariaDB服务器。若只注册了下面
一个用户帐号，那么在其他计算机中使用`svc_id`将无法连接到MariaDB服务器：
```
‘svc_id’@'127.0.0.1'
```
若想创建可以从 **外部所有计算机** 连接MariaDB服务器的用户帐号，只需将用户帐号的主机部分替换为 **“％”**
即可，“％”代表所有IP或主机名。

如果存在多个重复帐号，MariaDB服务器进行用户认证时会从中选取一个。此时，MariaDB服务器会选择哪一个呢？
示例：
```
'svc_id'@'192.168.0.10'         （该帐号密码为：123）
'svc_id'@'%'                    （该帐号密码为：abc）
```
在IP地址为192.168.0.10的PC上连接MariaDB服务器时，连接成功与否取决于用户使用第一个还是第二个帐号
信息进行连接。MariaDB服务器会选择哪一个呢？ **选择权限与帐号信息时，MariaDB总是先选择范围最小的那个**。
上面两个帐号信息中，'svc_id'@'192.168.0.10'会被选择。注意，在使用此帐号登录时，必须使用密码123，
如果使用密码abc进行登录时，会因密码不一致而遭到MariaDB服务器的拒绝。那么，为什么MariaDB服务器允许
重复帐号存在呢？因为数据库系统的运维过程中常常会遇到这种需求。但是，这也会引发一些问题，比如开发者常常
会遇到“无法连接MariaDB服务器”的情况。

### 权限
MariaDB服务器中存在多种权限，只有理解这些基本权限，才能根据用途为连接服务器的用户赋予相应的权限。
从MariaDB10.0开始，用户可以创建 **权限组（Role）**，并可以将它赋予某特定用户，一个权限组包含多个权限。

根据MariaDB权限的作用范围，可以将权限分为 **服务器级权限**，**数据库级权限**，**表级权限**，
以及 **与存储程序相关的权限**。此外还有列级权限，由于这种权限并不常用，帮省略。为某个用户赋予权限时，
要使用如下所示的 **GRANT命令**。其中，**ON子句** 用于指定 **数据库对象**，可指定的数据库对象有如下几种：

1. **＊.＊**：该对象为整个MariaDB服务器，此时在`privilege_list`中只能用全局权限。
2. **db1.＊**：该对象为某个特定的数据库，`privilege_list`中可以出现除全局权限外的数据库级，表级，存储程序级权限。
3. **db1.table1**：该对象为某个数据库中的一个表，`privilege_list`中只能使用表级权限。
4. **db1.stored_program1**：该对象为某个数据库的一个存储程序，`privilege_list`中只能使用存储程序级别权限。

#### 全局权限
| 权限            | 说明            |
| :------------- | :------------- |
| CREATE USER    | 创建一个新帐户的权限|
| FILE           | 使用LOAD DATA INFILE 或 LOAD FILE()函数访问磁盘文件时所需的权限|
| GRANT OPTION   | 可以对其他用户授权的权限（即使有GRANT权限，也只能将自己拥有的权限授予其他用户）|
| PROCESS        | 该权限下，使用SHOW PROCESSLIST命令能够查看MariaDB服务器内的进程|
| RELOAD         | 拥有该权限即可执行FLUSH...命令|
| REPLICATION CLIENT| 拥有该权限后，使用SHOW MASTER STATUS与SHOW SLAVE STATUS命令可以查看主/从服务器的状态|
| REPLICATION SLAVE| 从MariaDB服务器连接主MariaDB服务器时，使用的用户帐号需要该权限（只有拥有该权限，从服务器才能访问主MariaDB服务器中发生的更改）|
| SHOW DATABASES| 显示数据库列表的权限|
| SHUTDOWN| 关闭MariaDB服务的权限|
| SUPER| 略了，反正注意尽量不要为普通用户或服务帐号授予SUPER权限|

#### 数据库级权限
| 权限            | 说明            |
| :------------- | :------------- |
| CREATE       | 创建新数据库的权限       |
| CREATE ROUTINE| 创建新存储程序或函数的权限|
| CREATE TEMPORARY TABLES| 创建临时表的权限（与创建内部临时表无关）|
| DROP| 删除数据库的权限|
| EVENT| 创建，删除事件的权限|
| GRANT OPTION| 拥有该权限后，可以将数据库权限赋予其他用户（向其他用户授权时，仅限于自己拥有的权限）|
| LOCK TABLES| 拥有该权限后，可以使用LOCK TABLES命令锁定表|

#### 表级权限
| 权限            | 说明            |
| :------------- | :------------- |
| ALTER| 修改表结构的权限|
| CREATE| 创建表的权限|
| CREATE VIEW| 创建视图的权限|
| DELETE| 删除（DELETE查询）表记录的权限|
| DROP| 删除表或视图的权限|
| GRANT OPTION| 拥有该权限即可将表权限授予其他用户|
| INDEX| 拥有该权限后，可以使用CREATE INDEX命令创建索引（若拥有创建表的权限，则即使无该权限，也可以随CREATE TABLE语句一起创建索引）|
| INSERT| 向表中存储记录的权限|
| SELECT| 访问表记录的权限|
| SHOW VIEW| 拥有该权限后，使用SHOW CREATE VIEW命令可以查看视图结构|
| TRIGGER| 创建，删除，执行触发器的权限|
| UPDATE| 修改表记录的权限|

#### 存储程序级权限
| 权限            | 说明            |
| :------------- | :------------- |
| ALTER ROUTINE| 修改存储程序（过程与函数）内容的权限|
| EXECUTE| 执行存储程序（过程与函数）的权限|
| GRANT OPTION| 拥有该权限后，可以向其他用户授予存储程序（过程与函数）权限|

### 赋予权限
为用户赋予权限时，要使用GRANT SQL语句。GRANT语句使用如下 **语法** 编写，编写时要根据各权限的作用范围指定
相应的数据库对象：
```sql
GRANT <privilege_list> ON <db>.<table> TO '<user>'@'<host>';
GRANT <privilege_list> ON <db>.<table> TO '<user>'@'<host>'DENTIFIED BY '<password>' WITH GRANT OPTION;
```
使用GRANT语句可以为 **某个特定用户** 分配权限，**若指定用户不存在，则先创建用户，然后再为其赋予权限**。
指定用户尚未创建时，使用GRANT语句可以同时创建用户与赋予权限。并且，在GRANT命令中使用 **IDENTIFIED BY**
子句可以为创建的用户 **设置密码**。与其他权限不同，`GRANT OPTION`权限在GRANT语句的末尾使用 **WITH GRANT OPTION**
子句赋予。privilege_list中同时有多个权限时，可以使用 **逗号（,）** 将多个权限分隔开。**TO** 关键字之后是获得权限的用户，
**ON** 关键字之后用于指定向哪个数据库的哪个对象授予权限。权限范围不同，所用的方法也不相同。
#### 全局权限
```sql
GRANT SUPER ON *.* TO 'user'@'localhost';
```
授予全局权限时，在ON子句中使用"*.*"，表示该权限的作用范围为所有DB的所有对象。也就是说，由于无法只针对
某个特定DB授予全局权限，所以授予全局权限时不能将其作用范围指定为某个DB或者特定对象。SUPER这类全局
权限不能以DB或数据对象为单位进行授予，所以授予时一般只使用“*.*”。
#### 数据库权限
```sql
GRANT EVENT ON *.* TO 'user'@'localhost';
GRANT EVENT on employees.* TO 'user'@'localhost';
```
授予DB权限时，可以只针对某个特定的DB，也可以针对服务器中的所有DB。因此，授权时在ON子句中既可以使用
“*.*”，也可以使用“employees.＊”，如上所示。
#### 数据表权限
```sql
GRANT SELECT,INSERT,UPDATE,DELETE ON *.* TO 'user'@'localhost';
GRANT SELECT,INSERT,UPDATE,DELETE ON employees.* TO 'user'@'localhost';
GRANT SELECT,INSERT,UPDATE,DELETE ON employees.department TO 'user'@'localhost';
```
如第一个示例所示，授予对象权限时，“对象”可以指服务器里所有数据库中的对象；也可以仅指某个特定DB的对象，
如第二个示例所示。当然，授权时也可以只针对某个特定DB中的特定表，如第三示例所示。
```sql
--列级权限授权示例，只有这三种权限，没有DELETE
GRANT SELECT,INSERT,UPDATE (dept_name) ON employees.department TO 'user'@'localhost';
```
设置权限时虽然可以为权限指定多个级别，多个范围，但是 **表级权限与列级权限并不常用**。

**使用GRANT命令赋予的权限信息存储于mysql数据库（MariaDB的认证与字典数据库）的`user`表与`host`表**。

### 权限组
从MariaDB 10.0.5开始，权限管理支持多种方式。不仅可以将各权限分配给用户，还可以将一些权限集中起来
创建为一个权限组（Role），然后将权限组赋予个别用户。**但目前情形看，实际工作中使用权限组还是有些不便**。
这里就省略了！！
