统计信息
==============================================
基于代价的优化中，统计信息是最重要的依据。

### MySQL5.6的统计信息
由于MariaDB10.0包含MySQL5.6的功能，所以掌握MySQL 5.6管理统计信息的方法将有助于理解MariaDB10.0
管理统计信息的方法。MySQL5.6中，使用`InnoDB`存储引擎的数据表的统计信息可以永久（Persistent）管理。
从MySQL5.6开始在`mysql`数据库的`innodb_index_stats`数据表与`innodb_table_stats`数据表中
也可以访问索引。
```sql
SHOW TABLES LIKE '%_stats';
```
显示：
```
+---------------------------+
| Tables_in_mysql (%_stats) |
+---------------------------+
| column_stats              |
| index_stats               |
| innodb_index_stats        |
| innodb_table_stats        |
| table_stats               |
+---------------------------+
5 rows in set (0.00 sec)
```
在MySQL5.6中创建数据表时，可以设置`STATS_PERSISTENT`选项，根据其设置值确定是否以数据表为单位永久保存统计信息。
示例：
```sql
CREATE TABLE tab_test(
  fd1 INT,
  fd2 VARCHAR(20),
  PRIMARY KEY(fd1)
)ENIGNE = InnoDB STATS_PERSISTENT=1;
```
+ **STATS_PERSISTENT＝0**：采用MySQL5.5以前的方式管理数据表的统计信息，不保存于`mysql`数据库
的`innodb_index_stats`与`innodb_table_stats`数据表。
+ **STATS_PERSISTENT=1**：将数据表的统计信息保存到`mysql`数据库的`innodb_index_stats`与
`innodb_table_stats`数据表。
+ **STATS_PERSISTENT=DEFAULT**：其效果与创建数据表时不设置`STATS_PERSISTENT`选项相同，
是否永久管理数据表的统计信息由`innodb_stats_presistent`系统变量设置值决定。

**`innodb_stats_presistent`系统变量的默认值为ON(1)**，创建数据表时，若不使用`STATS_PERSISTENT`
选项，则使用永久统计信息，并将统计信息保存到`innodb_index_stats`与`innodb_table_stats`数据表。

示例，创建`tab_persistent`与`tab_transient`两个数据表时，使用`STATS_PERSISTENT`选项，
并且分别设置为1与0：
```sql
CREATE TABLE tab_persistent(fd1 INT PRIMARY KEY,fd2 INT)ENGINE=InnoDB STATS_PERSISTENT=1;
CREATE TABLE tab_transient(fd1 INT PRIMARY KEY,fd2 INT)ENGINE=InnoDB STATS_PERSISTENT=0;
```
再执行：
```sql
SELECT * FROM mysql.innodb_table_stats WHERE table_name IN ('tab_persistent','tab_transient') \G
```
显示：
```
*************************** 1. row ***************************
           database_name: firstdb
              table_name: tab_persistent
             last_update: 2016-05-27 17:59:32
                  n_rows: 0
    clustered_index_size: 1
sum_of_other_index_sizes: 0
1 row in set (0.00 sec)
```
创建数据表后，访问`mysql`数据库的`innodb_table_stats`数据表的统计信息。可以看到，只能访问
`tab_persistent`数据表（采用`STATS_PERSISTENT=1`选项创建）的统计信息。当然，也可以使用
`ALTER TABLE`命令将数据表的统计信息更改为永久状态（`STATS_PERSISTENT=1`）或短期状态（`STATS_PERSISTENT=0`）。
