Oozie快速入门
================================================================================
## 1.构建Oozie

### 1.1.系统要求
+ Unix机箱（在Mac OS X和Linux上测试）
+ Java JDK 1.8+
+ Maven 3.0.1+
+ Hadoop 2.6.0+
+ Pig 0.10.1+

JDK命令（java，javac）必须位于命令路径中；Maven命令（mvn）必须位于命令路径中。

### 1.2.构建Oozie
从[Oozie站点](oozie.apache.org/)的“Releases”下拉菜单下载Oozie的源代码。然后，解压缩源代码
压缩包，并进入解压目录中执行如下命令：
```shell 
$ bin/mkdistro.sh [-DskipTests]
```
运行`mkdistro.sh`将创建Oozie的二进制分发文件。**默认情况下，oozie war不包含hadoop和
hcatalog库，但oozie工作需要它们**。添加这些库有两个选项：
1. 在安装时，将hadoop和hcatalog库复制到libext并运行`oozie-setup.sh`来设置Oozie。当需要在
具有不同hadoop/hcatalog版本的多个设置中使用相同的oozie包时，这是合适的。
2. 使用`-Puber`构建，它将在oozie var中捆绑所需的库。此外，以下选项可用于自定义依赖项的版本：
    ```
    -Dhadoop.version=<version> - default 2.6.0
    -Ptez - Bundle tez jars in hive and pig sharelibs. Useful if you want to use tez
    +as the execution engine for those applications.
    -Dpig.version=<version> - default 0.16.0
    -Dpig.classifier=<classifier> - default h2
    -Dsqoop.version=<version> - default 1.4.3
    -Dsqoop.classifier=<classifier> - default hadoop100
    -Djetty.version=<version> - default 9.3.20.v20170531
    -Dopenjpa.version=<version> - default 2.2.2
    -Dxerces.version=<version> - default 2.10.0
    -Dcurator.version=<version> - default 2.5.0
    -Dhive.version=<version - default 1.2.0
    -Dhbase.version=<version> - default 1.2.3
    -Dtez.version=<version> - default 0.8.4

    重要提示：如果针对Hadoop 3构建，必须激活配置文件hadoop-3
    ```

## 2.服务安装

### 2.1.系统要求
+ Unix机箱（在Mac OS X和Linux上测试）
+ Java JDK 1.8+
+ Hadoop
    - Apache Hadoop (用1.2.1和2.6.0+测试)
+ ExtJS库（可选，启用Oozie webconsole）
    - ExtJS 2.2

Java 1.8+ bin目录应位于命令路径中。

### 2.2.服务安装
**重要提示**：Oozie忽略 *`OOZIE_HOME`* 的任何设定值，Oozie自动计算其home目录。
+ 构建Oozie二进制分发版
+ 下载Hadoop二进制发行版
+ 下载ExtJS库（必须是2.2版）

**注意**：ExtJS库未与Oozie捆绑在一起，因为它使用不同的许可证。

**注意**：Oozie UI浏览器兼容性Chrome（全部），Firefox（3.5），Internet Explorer（8.0），
Opera（10.5）。

**注意**：建议将Oozie Unix用户用于Oozie服务。

解压Oozie发行版tar.gz。

解压Hadoop发行版tar.gz（作为Oozie Unix用户）。

**注意**：为Oozie进程配置带有proxyuser的Hadoop集群。

Hadoop **core-site.xml中需要以下两个属性**：
```xml
<!-- OOZIE -->
<property>
    <name>hadoop.proxyuser.[OOZIE_SERVER_USER].hosts</name>
    <value>[OOZIE_SERVER_HOSTNAME]</value>
  </property>
  <property>
    <name>hadoop.proxyuser.[OOZIE_SERVER_USER].groups</name>
    <value>[USER_GROUPS_THAT_ALLOW_IMPERSONATION]</value>
</property>
```
用特定值替换大写字母部分，然后重新启动Hadoop。

ExtJS库是可选的（只有Oozie Web控制台才能工作）

**重要提示**：所有Oozie服务器脚本（`oozie-setup.sh`，`oozied.sh`，`oozie-start.sh`，
`oozie-run.sh`和`oozie-stop.sh`）仅在拥有Oozie安装目录的Unix用户下运行，如有必要在调用脚本
时使用 **`sudo -u OOZIE_USER`**。

从Oozie 3.3.2开始，`oozie-start.sh`，`oozie-run.sh`和`oozie-stop.sh`已被弃用，并将打印
警告。应该使用`oozied.sh`脚本;`start`，`run`或`stop`将作为参数传递，将分别执行`oozie-start.sh`，
`oozie-run.sh`和`oozie-stop.sh`的行为。

在扩展Oozie的目录中创建一个 **libext/** 目录。

如果使用ExtJS库将ZIP文件复制到`libext/`目录。如果战争中尚未包含hadoop和hcatalog库，请将相应
的库添加到`libext/`目录中。

运行`oozie-setup.sh`以将新的 **sharelib** 上传到hdfs时：
```shell
sharelib create -fs fs_default_name [-locallib sharelib]
```
命令可用，**其中第一个参数是默认的fs名称，第二个参数是要安装的Oozie sharelib，它可以是tarball
或它的扩展版本。如果省略第二个参数，将使用Oozie安装目录中的Oozie sharelib tarball。不推荐使
用升级命令，应该使用create命令创建新版本的sharelib。将Sharelib文件复制到新的`lib_ <timestamped>`
目录。在开始时，服务器从最新的时间戳目录中选择sharelib。启动服务器时还清除sharelib目录，该目录
早于sharelib保留天数（定义为oozie.service.ShareLibService.temp.sharelib.retention.days，
默认为7天）**。

`db create|upgrade|postupgrade -run [-sqlfile <FILE>]`命令用于创建，升级或postupgrade 
oozie db以及可选的sql文件。

运行`oozie-setup.sh`脚本以配置Oozie，添加所有组件到`libext/`目录。
```shell
$ bin/oozie-setup.sh sharelib create -fs <FS_URI> [-locallib <PATH>]
        sharelib upgrade -fs <FS_URI> [-locallib <PATH>]
        db create|upgrade|postupgrade -run [-sqlfile <FILE>]
```

**重要信息**：如果Oozie服务需要与具有自签名证书的外部服务器建立安全连接，请确保指定包含所需证书
的信任库的位置。可以通过在`oozie-site.xml`中配置`oozie.https.truststore.file`，或者通过
设置`javax.net.ssl.trustStore`系统属性来完成。如果在两个位置都设置了它，则将使用作为系统属性
传递的值。

使用 **ooziedb.sh** 命令行工具 **创建Oozie DB**：
```shell
$ bin/ooziedb.sh create -sqlfile oozie.sql -run
```
```
Validate DB Connection.
DONE
Check DB schema does not exist
DONE
Check OOZIE_SYS table does not exist
DONE
Create SQL schema
DONE
DONE
Create OOZIE_SYS table
DONE

Oozie DB has been created for Oozie version '3.2.0'
```
**启动Oozie作为守护进程运行**：
```shell
$ bin/oozied.sh start
```
**要启动Oozie作为前台进程运行**：
```shell
$ bin/oozied.sh run
```
检查Oozie日志文件 `logs/oozie.log`以确保Oozie正常启动。

**使用Oozie命令行工具检查Oozie的状态**：
```shell
$ bin/oozie admin -oozie http://localhost:11000/oozie -status
```
使用浏览器转到Oozie Web控制台，Oozie状态应为NORMAL。

## 3.客户端安装

### 3.1.系统要求
+ Unix机箱（在Mac OS X和Linux上测试）
+ Java JDK 1.8+

Java 1.8+ bin目录应位于命令路径中。

### 3.2.客户端安装
复制并解压与发行版捆绑在一起的 **oozie-client TAR.GZ文件**。将`bin/`目录添加到PATH。

**注意**：Oozie server安装包括Oozie客户端。Oozie客户端应仅安装在远程计算机上。

## 4.Oozie Share Lib安装
Oozie共享库已由前面部分中解释的`oozie-setup.sh` create命令安装。