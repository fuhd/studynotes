安装Kafka
===================================================================================
## 1.准备

### 1.1.选择操作系统
主要在Linux上使用。

### 1.2.安装Java
略

### 1.3.安装Zookeeper
**Kafka使用Zookeeper保存集群的元数据信息和消费者信息**。Kafka发行版自带了Zookeeper，可以直接从
脚本启动。

#### 1.3.1.单机服务
安装目录为`/usr/local/zookeeper`，数据目录为`/var/lib/zookeeper`。
```shell
tar -zxf zookeeper-3.4.6.tar.gz
mv zookeeper-3.4.6 /usr/local/zookeeper 
mkdir -p /var/lib/zookeeper
cat > /usr/local/zookeeper/conf/zoo.cfg << EOF
```
```
> tickTime=2000
> dataDir=/var/lib/zookeeper
> clientPort=2181
> EOF
```
```shell
export JAVA_HOME=/usr/java/jdk1.8.0_51
/usr/local/zookeeper/bin/zkServer.sh start 
```
现在可以连到 **Zookeeper端口** 上，通过发送命令 **srvr** 来验证Zookeeper是否安装正确。
```shell
telnet localhost 2181
```
```
Trying ::1...
Connected to localhost.
Escape character is '^]'.

srvr 
Zookeeper version: 3.4.6-1569965, built on 02/20/2014 09:09 GMT
Latency min/avg/max: 0/0/0
Received: 1
Sent: 0
......
```

#### 1.3.2.Zookeeper群组
**Zookeeper集群被称为群组**。Zookeeper使用的是一致性协议，所以建议每个群组里应该包含 **奇数** 个
节点（**比如3个、5个等，不过也不建议一个群组包含超过7个节点**。因为Zookeeper使用了一致性协议，节
点过多会降低整个群组的性能）。

群主需要有一些 **公共配置**，并且每个服务器还要在 **数据目录** 中创建一个 **myid文件**，用于指明自己
的ID。示例：
```ini
tickTime=2000
dataDir=/var/lib/zookeeper 
clientPort=2181
initLimit=20
syncLimit=5
server.1=zoo1.example.com:2888:3888
server.2=zoo2.example.com:2888:3888
server.3=zoo3.example.com:2888:3888
```
在这个配置中，`initLimit`表示用于在从节点与主节点之间建立初始化连接的时间上限，`syncLimit`表示允许
从节点与主节点处于不同步状态的时间上限。这两个值都是`tichTime`的倍数。服务器地址遵循：
`server.X=hostname:peerPort:leaderPort`格式，说明如下：
+ **X：服务器ID，它必须是一个整数，不过不一定要从0开始，也不要求是连续的**；X与myid文件中的值一致。
+ **hostname：服务器的机器名或IP地址**；
+ **peerPort：用于节点间通信的TCP端口**；
+ **leaderPort：用于首领选举的TCP端口**；

客户端只需要通过`clientPort`就能连接到群组，而群组节点的通信则需要同时用到这 **3个端口（`peerPort`、
`leaderPort`、`clientPort`）**。

## 2.安装Kafka Broker
下面的示例将Kafka安装在`/usr/local/kafka`目录下，使用之前配置好的Zookeeper，并把消息日志保存在
`/tmp/kafka-logs`目录下。
```shell
tar -zxf kafka_2.11-0.9.0.1.tgz
mv kafka_2.11-0.9.0.1 /usr/local/kafka
mkdir /tmp/kafka-logs
export JAVA_HOME=/usr/java/jdk1.8.0_51
/usr/local/kafka/bin/kafka-server-start.sh -daemon
```
**验证是否安装正确**，比如创建一个测试主题，发布一些消息，然后读取它们。

**创建并验证主题**：
```shell
#创建
/usr/local/kafka/bin/kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test
#展示
/usr/local/kafka/bin/kafka-topics.sh --zookeeper localhost:2181 --describe --topic test 
```

**往测试主题上发布消息**：
```shell
/usr/local/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 --topic test

Test Message 1
Test Message 2
^D
```

**从测试主题上读取消息**：
```shell
/usr/local/kafka/bin/kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning 

Test Message 1
Test Message 2
^C
```

## 3.broker配置
Kafka发行包里 **自带的配置样本** 可以用来安装 **单机服务**，但并不能满足大多数安装场景的需求。

### 3.1.常规配置
有一些配置选项，在单机安装时可以直接使用默认值，部署到其他环境时要小心，**其中的大部分需要修改后才
能使用**。

#### broker.id
broker的标识符，这个值在整个Kafka集群里 **必须是唯一** 的，这个值可以任意选定。

#### port
用 **配置样本** 来启动Kafka，它会监听 **9092** 端口，可以是任意端口。要注意，如果使用1024以下的端口，
需要使用root权限启动Kafka，不建议这样做。

#### zookeeper.connect 
