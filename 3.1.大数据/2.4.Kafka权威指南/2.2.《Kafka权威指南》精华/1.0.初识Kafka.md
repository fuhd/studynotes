初识Kafka
===================================================================================
## 1.发布与订阅消息系统
发布与订阅系统一般会有一个 **broker**，也就是发布消息的中心点。

## 2.Kafka登场
Kafka是一款基于发布与订阅的消息系统。它一般被称为“**分布式提交日志**”或者“**分布式流平台**”。

### 2.1.消息和批次
Kafka的数据单元被称为 **消息**，消息由 **字节数组** 组成。消息可以有一个 **可选的元数据**，也就是 
**键**。键也是一个 **字节数组**。

当消息以一种可控的方式 **写入不同的分区时，会用到键**。最简单的例子就是为键生成一个 **一致性散列值**，
然后 **使用散列值对主题分区数进行取模，为消息选择分区**。

为了 **提高效率**，消息被 **分批次** 写入Kafka，批次就是一组消息。把消息分成批次传输可以 **减少网络
开销**。不过，这要在时间延迟和吞吐量之间作出权衡，**批次越大，单位时间内处理的消息就越多，单个消息
的传输时间就越长**。批次数据会被 **压缩**，这样可以提升数据的传输和存储能力，**但要做更多计算处理**。

### 2.2.模式
Kafka的许多开发者喜欢使用 **Apache Avro**，它最初是为Hadoop开发的一款 **序列化框架**。Avro提供了
一种紧凑的序列化格式，**模式和消息体是分开的**，当模式发生变化时，不需要重新生成代码。它还 **支持强
类型和模式进化**，其版本既向前兼容，也向后兼容。

### 2.3.主题和分区
主题可以被分为若干个分区，**一个分区就是一个提交日志**。消息以 **追加的方式** 写入分区，然后以 **先入
先出** 的顺序读取。要注意，由于一个主题一般包含几个分区，因此 **无法在整个主题范围内保证消息的顺序，
但可以保证消息在单个分区内的顺序**。**一个主题可以横跨多个服务器**，以此来提供比单个服务器更强大的
性能。

### 2.4.生产者和消费者
生产者创建消息。生产者在默认情况下把消息均衡地分布到主题的所有分区上，而并不关心特定消息会被写到哪
个分区。生产者也可以使用 **自定义的分区器**，根据 **不同的业务规则** 将消息映射到分区。

消费者读取消息。**消费者订阅一个或多个主题**，并按照消息生成的顺序读取它们。消费者通过 **检查消息的
偏移量** 来区分已经读取的消息。**偏移量是另一种元数据**。

在给定的分区里，每个消息的偏移量都是唯一的。**消费者把每个分区最后读取的消息偏移量保存在ZooKeep或
Kafka上，如果消费者关闭或重启，它的读取状态不会丢失**。

消费者是 **消费者群组** 的一部分，也就是说，**会有一个或多个消费者共同读取一个主题。群组保证每个分区
只能被一个消费者使用**。

### 2.5.broker和集群
**一个独立的Kafka服务器被称为broker**。单个broker可以轻松处理 **数千个分区** 以及 **每秒百万级** 的
消息量。

broker是集群的组成部分。**每个集群都有一个broker同时充当集群控制器的角色**（自动从集群的活跃成员中
选举出来）。




