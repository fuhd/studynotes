安装与配置Spark集群
================================================================================
## 1.下载Spark安装包
本书将使用Spark官方编译好的软件包进行安装。**在少数情况下，才会自行编译Spark源码或在编译之前根
据具体业务修改部分源码**。
+ 进入版本选择页面后，选择2.3.1版本，并单击“spark-2.3.1-bin-hadoop2.7.tgz”链接。
+ 将下载好的Spark压缩包上传至第1台虚拟机的“home/admin/softwares/installations”目录下。

## 2.检查与准备集群环境 

### 2.1.虚拟机的配置项
下表列出了三台虚拟机的核心配置项：
> 三台虚拟机的系统均为CentOS6.8版本，其与CentOS7.x系列版本的使用方式大同小异。

| 配置项 | linux01 | linux02 | linux03 |
|:------|:--------|:--------|:--------|
| 内存 | 4GB | 2GB | 2GB |
| CPU内核数 | 2 | 1 | 1 |
| 硬盘 | 50GB（单分区）| 50GB（单分区）|50GB（单分区）|
| 网络适配器 | NAT | NAT | NAT |

### 2.2.配置虚拟机系统
在部署Spark集群之前，需要确保三台虚拟机的软件环境一致的。

#### 2.2.1.禁用SELinux
分布式框架在进行端口通信时，**SELinux有可能阻塞其中的通信，因此暂且将其禁用**。在CentOS6.8中，
使用如下命令编辑SELinux配置文件：
```shell
vi /etc/sysconfig/selinux00000
```
并将SELINUX选项改为：
```ini
SELINUX:disable
```

#### 2.2.2.关闭防火墙
防火墙也可以导致分布式框架之间的通信被拒绝，因此暂且关闭防火墙。**在CentOS6.8系统中**，使用如下
命令关闭iptables防火墙。
```shell
service iptables stop
chkconfig iptables off
```
**在CentOS7.X系统中**，用firewalld替代了iptables。关闭防火墙的命令如下：
```shell
systemctl stop firewalld.service
systemctl disable firewalld.service 
```

#### 2.2.3.配置网卡文件
在CentOS6.8中编辑网卡配置文件的命令如下：
```shell
vi /etc/sysconfig/network-scripts/ifcfg-eth0
```
编辑内容如下：
```ini
#当前机器的IP地址
IPADDR=192.168.216.20
#固定的子网掩码地址
NETMASK=255.255.255.0
#网关地址
GATEWAY=192.168.216.2
#首选DNS，设置为网关的IP地址即可
DNS1=192.168.216.2
#备选DNS，设置为如下即可
DNS2=8.8.8.8
#设置为静态配置IP地址模式 
BOOTPROTO=static
#是否开机自动启动网卡
ONBOOT=yes
```
编辑完后，重启网卡：
```shell
service network restart
```
其余两台虚拟机网卡配置过程与上述过程基本一致。

#### 2.2.4.修改IP地址与主机名的映射关系 
```shell
vi /etc/hosts
```
将其修改为如下内容：
```ini
192.16.216.20 linux01
192.16.216.21 linux02
192.16.216.22 linux03
```

#### 2.2.5.实现3台虚拟机之间的无秘钥访问 
以其中一台虚拟机上的操作为例，首先，执行以下命令生成秘钥：
```shell
ssh-keygen -t rsa
```
然后，分发公钥至3台虚拟机，命令如下：
```shell
ssh-copy-id linux01;
ssh-copy-id linux02;
ssh-copy-id linux03;
```
