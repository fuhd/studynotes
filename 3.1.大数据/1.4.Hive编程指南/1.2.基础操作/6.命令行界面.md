命令行界面
=================================================================================
**命令行界面，也就是CLI，是和Hive交互的最常用的方式**。使用CLI，用户可以创建表，检查模式以及查询表，
等等。

### CLI选项
下面这个命令显示了CLI所提供的选项列表。
```shell
$ hive --service cli --help

SLF4J: Class path contains multiple SLF4J bindings.
SLF4J: Found binding in [jar:file:/opt/apache-hive-2.3.2/lib/log4j-slf4j-impl-2.6.2.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: Found binding in [jar:file:/opt/hadoop-2.9.0/share/hadoop/common/lib/slf4j-log4j12-1.7.25.jar!/org/slf4j/impl/StaticLoggerBinder.class]
SLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]
usage: hive
 -d,--define <key=value>          Variable substitution to apply to Hive
                                  commands. e.g. -d A=B or --define A=B
    --database <databasename>     Specify the database to use
 -e <quoted-query-string>         SQL from command line
 -f <filename>                    SQL from files
 -H,--help                        Print help information
    --hiveconf <property=value>   Use value for given property
    --hivevar <key=value>         Variable substitution to apply to Hive
                                  commands. e.g. --hivevar A=B
 -i <filename>                    Initialization SQL file
 -S,--silent                      Silent mode in interactive shell
 -v,--verbose                     Verbose mode (echo executed SQL to the
                                  console)
```

### 变量和属性
**--define key=value实际上和--hivevar key=value是等价的。二者都可以让用户在命令行定义用户自定
义变量以便在Hive脚本中引用，来满足不同情况的执行**。
```shell
$ hive --define aaa=bbb

hive> set aaa;
aaa=bbb
```

**当用户使用这个功能时，Hive会将这些键值对放到hivevar命令空间。这样可以和其他3种内置命名空间（也就
是hiveconf、system和env），进行区分**。

下表描述了命名空间选项：

| 命名空间 | 使用权限 | 描述 |
| :-----  | :----- | :----|
| **hivevar** | 可读/可写 | 用户自定义变量 |
| **hiveconf** | 可读/可写 | Hive相关的配置属性 |
| **system** | 可读/可写 | Java定义的配置属性 |
| **env** | 只可读 | Shell环境（例如：bash）定义的环境变量 |

Hive变量内部是以Java字符串的方式存储的。**用户可以在查询中引用变量。Hive会先使用变量值替换掉查询的变
量引用，然后才会将查询语句提交给查询处理器**。

**在CLI中，可以使用SET命令显示或者修改变量值**。例如，下面这个会话先显示一个变量的值，然后再显示env命令
空间中定义的所有变量！
```shell
$ hive

hive> set env:HOME;
env:HOME=/home/fuhd

hive> set;
_hive.hdfs.session.path=/tmp/hive/fuhd/69e0a060-5355-4492-bb1d-64cbe13dca2e
_hive.local.session.path=/opt/apache-hive-2.3.2/tmp/fuhd/69e0a060-5355-4492-bb1d-64cbe13dca2e
_hive.tmp_table_space=/tmp/hive/fuhd/69e0a060-5355-4492-bb1d-64cbe13dca2e/_tmp_space.db
datanode.https.port=50475
datanucleus.cache.level2=false
......略

hive> set -v;
_hive.hdfs.session.path=/tmp/hive/fuhd/7032fc51-affe-4897-bdd6-ffd16f37d667
_hive.local.session.path=/opt/apache-hive-2.3.2/tmp/fuhd/7032fc51-affe-4897-bdd6-ffd16f37d667
_hive.tmp_table_space=/tmp/hive/fuhd/7032fc51-affe-4897-bdd6-ffd16f37d667/_tmp_space.db
adl.feature.ownerandgroup.enableupn=false
datanode.https.port=50475
datanucleus.cache.level2=false
......略
```
**如果不加-v标记，set命令会打印出命名空间：hivevar、hiveconf、system和env中所有的变量。使用-v标记，
则还会打印Hadoop中所定义的所有属性，例如控制HDFS和MapReduce的属性**。

**set命令还可用于给变量赋新的值**。我们特别看下hivevar命名空间以及如何通过命令行定义一个变量：
```shell
$ hive --define foo=bar

hive> set foo;
foo=bar

hive> set hivevar:foo;
hivevar:foo=bar

hive> set hivevar:foo=bar2;

hive> set foo;
foo=bar2

hive> set hivevar:foo;
hivevar:foo=bar2
```
我们可以看到，**前缀hivevar:是可选的。--hivevar标记和--define标记是相同的**。

**在CLI中查询语句中的变量引用会先被替换掉然后才会提交给查询处理器**。思考如下这个CLI会话：
```shell
# 接上面定义的foo=bar2
hive> create table tossl(i int, ${hivevar:foo} string);
OK
Time taken: 4.207 seconds

hive> describe tossl;
OK
i                   	int                 	                    
bar2                	string              	                    
Time taken: 0.375 seconds, Fetched: 2 row(s)

hive> create table toss2(i2 int, ${foo} string);
OK
Time taken: 0.072 seconds

hive> describe toss2;
OK
i2                  	int                 	                    
bar2                	string              	                    
Time taken: 0.033 seconds, Fetched: 2 row(s)

hive> drop table tossl;
OK
Time taken: 1.463 seconds

hive> drop table toss2;
OK
Time taken: 0.094 seconds
```
我们来看看 **--hiveconf选项，其用于配置Hive行为的所有属性**。我们用它来指定 **hive.cli.print.current.db
属性。开启这个属性可以在CLI提示符前打印出当前所在的数据库名，默认的数据库名为default。这个属性的
默认值是false**。
```shell
$ hive --hiveconf hive.cli.print.current.db=true
hive (default)> set hive.cli.print.current.db;
hive.cli.print.current.db=true

hive (default)> set hiveconf:hive.cli.print.current.db;
hiveconf:hive.cli.print.current.db=true

hive (default)> set hiveconf:hive.cli.print.current.db=false;
hive>
```
我们甚至 **可以增加新的hiveconf属性**：
```shell
$ hive --hiveconf y=5
hive> set y;
y=5

hive> CREATE TABLE whatsit(i int);
OK
Time taken: 4.307 seconds

hive> SELECT * FROM whatsit WHERE i = ${hiveconf:y};
OK
Time taken: 3.672 seconds
```
我们还有必要了解一下 **system命名空间，Java系统属性对这个命名空间内容具有可读可写权利；而env命名
空间，对于环境变量只提供可读权限**。
```shell
hive> set system:user.name;
system:user.name=fuhd

hive> set system:user.name=fuhaidong;

hive> set system:user.name;
system:user.name=fuhaidong

hive> set env:HOME;
env:HOME=/home/fuhd
```
**和hivevar变量不同，用户必须使用system:或者env:前缀来指定系统属性和环境变量**。

**env命名空间可作为向Hive传递变量的一个可选方式**，如下示例：
```shell
$ YEAR=2012 hive -e "SELECT *　FROM mytable WHERE year = ${env:YEAR}";
```
**查询处理器会在WHERE子句中相看到实际的变量值2012**；
```
提示：
Hive中所有的内置属性都在$HIVE_HOME/conf/hive-default.xml.template中列举出来了，这是个“样例”配置文件。配置文件中还说明
这些属性的默认值。
```










































ddd
