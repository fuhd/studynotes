分区表、管理表
=================================================================================
数据分区的一般概念存在已久。其可以有多种形式，但是 **通常使用分区来水平分散压力**。

**Hive中有分区表的概念**。我们可以看到 **分区表具有重要的性能优势**，而且分区表还可以将数据以一种
符合逻辑的方式进行组织，比如分层存储。

我们首先讨论一下 **分区管理表**。重新来看之前的那张emplyees表，并假设我们在一个非常大的跨国公司
工作。我们的HR人员 **经常会执行一些带WHERE语句的查询**，这样可以将结果限制在某个特定的国家或者某个
特定的第一级细分（为简单起见我们将只使用到state（州））。那么，**让我们先按照country（国家）再按
照state（州）来对数据进行分区吧**：
```sql
CREATE TABLE employees (
    name            STRING,
    salary          FLOAT,
    subordinates    ARRAY<STRING>,
    deductions      MAP<STRING, FLOAT>,
    address         STRUCT<street:STRING, city:STRING, state:STRING, zip:INT>)
PARTITIONED BY (country STRING, state STRING);
```
**分区表改变了Hive对数据存储的组织方式**。如果我们是在mydb数据库中创建的这个表，那么对于这个表只
会有一个employees目录与之对应：
```
hdfs://master_server/user/hive/warehouse/mydb.db/employees
```
但是，**Hive现在将会创建好可以反映分区结构的子目录**。例如：
```
...
.../employees/country=CA/state=AB
.../employees/country=CA/state=BC
...
.../employees/country=US/state=AL
.../employees/country=US/state=AK
...
```
是的，**那些是实际的目录名称**。州目录下将会包含有零个文件或者多个文件，这些文件中存放着那些州的雇
员信息。

**分区字段**（这个例子中就是country和state）一旦创建好，表现得就得变通的字段一样。事实上，**除非
需要优化查询性能**，否则使用这些表的用户不需要关心这些“字段”是否是分区字段。

例如，下面这个查询语句将会查找出在美国伊利诺斯州的所有雇员：
```sql
SELECT * FROM employees WHERE country = 'US' AND state = '1L';
```
需要注意的是，**因为country和state的值已经包含在文件目录名称中了，所以也就没有必要将这些值存放到
它们目录下的文件中了**。事实上，数据只能从这些文件中获得，因此用户需要在表的模式中说明这点，而且这
个数据浪费空间。

**对数据进行分区，也许最重要的原因就是为了更快地查询**。在前面那个将结果范围限制在伊利诺斯州的雇员
的查询中，**仅仅需要扫描一个目录下的内容即可**。即使我们有成千上万个国家和州目录，除了一个目录其他
的都可以忽略不计。对于非常大的数据集，分区可以显著地搞高查询性能，除非对分区进行常见的范围筛选（例如，
按照地理位置范围或按照时间范围等）。










































ddd
