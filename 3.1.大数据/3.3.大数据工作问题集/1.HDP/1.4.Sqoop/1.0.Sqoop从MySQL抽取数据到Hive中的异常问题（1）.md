Sqoop从MySQL抽取数据到Hive中的异常问题（1）
=================================================================================
## 1.问题描述
环境为HDP3.1，预装的Hive为3.1版本。任务为：从MySQL的某一张表中抽取数据到已经预先创建的Hive表
（内部表）。在hive用户下执行命令：
```shell
sqoop import --connect jdbc:mysql://xxx.xxx.xxx.xxx:3306/road_monitor --username root --password 123 --table accident_info --hive-import --hive-overwrite --hive-database road_monitor --hive-table ods_road_monitor_accident_info_1 -m 1
```
执行过程中抛出异常：
```
19/07/13 14:32:10 INFO hive.HiveImport: Error: Error while compiling statement: FAILED: SemanticException Unable to load data to destination table. Error: The file that you are trying to load does not match the file format of the destination table. (state=42000,code=40000)
19/07/13 14:32:10 INFO hive.HiveImport: Closing: 0: jdbc:hive2://server02.zjimee.com:2181,server01.zjimee.com:2181,server03.zjimee.com:2181/default;password=hive;serviceDiscoveryMode=zooKeeper;user=hive;zooKeeperNamespace=hiveserver2
19/07/13 14:32:10 ERROR tool.ImportTool: Import failed: java.io.IOException: Hive exited with status 2
        at org.apache.sqoop.hive.HiveImport.executeExternalHiveScript(HiveImport.java:299)
        at org.apache.sqoop.hive.HiveImport.importTable(HiveImport.java:234)
        at org.apache.sqoop.tool.ImportTool.importTable(ImportTool.java:558)
        at org.apache.sqoop.tool.ImportTool.run(ImportTool.java:656)
        at org.apache.sqoop.Sqoop.run(Sqoop.java:150)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:76)
        at org.apache.sqoop.Sqoop.runSqoop(Sqoop.java:186)
        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:240)
        at org.apache.sqoop.Sqoop.runTool(Sqoop.java:249)
        at org.apache.sqoop.Sqoop.main(Sqoop.java:258)
```

## 2.原因
Sqoop导入的文件格式与预先创建的Hive表数据格式不匹配。查看表信息：
```sql
describe formatted ods_road_monitor_accident_info_1;
```
显示：
```
...
SerDe Library:      	org.apache.hadoop.hive.ql.io.orc.OrcSerde	
InputFormat:        	org.apache.hadoop.hive.ql.io.orc.OrcInputFormat	
OutputFormat:       	org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat	
...
```
也就是说默认格式为：**orc**。

## 3.解决
修改Sqoop命令，加入 **--as-orcfile**参数：
```shell
sqoop import --connect jdbc:mysql://119.23.213.192:3306/road_monitor --username root --password 123 --table accident_info --hive-import --hive-overwrite --hive-database road_monitor --hive-table ods_road_monitor_accident_info_1 --as-orcfile -m 1
```