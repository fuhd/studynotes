Cloudera Manager API
================================================================================
Cloudera Manager API提供配置和服务生命周期管理，服务健康信息和指标，并允许您自行配置Cloudera Manager。
该API与Cloudera Manager管理控制台在相同的主机和端口上提供，并且不需要额外的进程或额外的配置。该API支持
HTTP基本身份验证，接受与Cloudera Manager管理控制台相同的用户和凭据。

## 1.资源
+ [快速开始](http://cloudera.github.io/cm_api/docs/quick-start/)
+ [Cloudera Manager API教程](http://cloudera.github.io/cm_api/apidocs/v19/tutorial.html)
+ [Cloudera Manager API文档](http://cloudera.github.io/cm_api/apidocs/v19/)
+ [Python客户端](http://cloudera.github.io/cm_api/docs/python-client/)
+ [使用Cloudera Manager API进行群集自动化](https://www.cloudera.com/documentation/enterprise/latest/topics/cm_intro_automation_api.html#xd_583c10bfdbd326ba--7f25092b-13fba2465e5--7f17)

## 2.获取配置文件
1. 获取服务角色的列表：
```
http://cm_server_host:7180/api/v19/clusters/clusterName/services/serviceName/roles
```
2. 获取进程正在使用的配置文件的列表：
```
http://cm_server_host:7180/api/v19/clusters/clusterName/services/serviceName/roles/roleName/process
```
3. 获取任何特定文件的内容：
```
http://cm_server_host:7180/api/v19/clusters/clusterName/services/serviceName/roles/roleName/process/configFiles/configFileName
```
例如：
```
http://cm_server_host:7180/api/v19/clusters/Cluster%201/services/OOZIE-1/roles/OOZIE-1-OOZIE_SERVER-e121641328fcb107999f2b5fd856880d/process/configFiles/oozie-site.xml
```

## 3.检索服务和主机属性
要使用Cloudera Manager API更新服务属性，您需要知道属性的名称，而不仅仅是显示名称。如果您知道属性的显示名称，
但不知道属性名称，请通过向URL中添加查询字符串 view=FULL 请求任何配置对象来检索文档。例如：
```
http://cm_server_host:7180/api/v19/clusters/Cluster%201/services/service_name/config?view=FULL
```
搜索结果以获取所需属性的显示名称。例如，搜索显示名称HDFS服务环境高级配置代码段（安全阀），显示相应的属性名称为
hdfs_service_env_safety_valve：
```json
{
   "name" : "hdfs_service_env_safety_valve",
   "require" : false,
   "displayName" : "HDFS Service Environment Advanced Configuration Snippet (Safety Valve)",
   "description" : "For advanced use onlyu, key/value pairs (one on each line) to be inserted into a roles
   environment. Applies to configurations of all roles in this service except client configuration.",
   "relatedName" : "",
   "validationState" : "OK"
}
```
与查找服务属性类似，您也可以查找主机属性。首先，获取具有以下URL的群集的主机ID：
```
http://cm_server_host:7180/api/v19/hosts
```
这应该返回表单的主机对象：
```
{
   "hostId" : "2c2e951c-aaf2-4780-a69f-0382181f1821",
   "ipAddress" : "10.30.195.116",
   "hostname" : "cm_server_host",
   "rackId" : "/default",
   "hostUrl" : "http://cm_server_host:7180/cmf/hostRedirect/2c2e951c-adf2-4780-a69f-0382181f1821",
   "maintenanceMode" : false,
   "maintenanceOwners" : [ ],
   "commissionState" : "COMMISSIONED",
   "numCores" : 4,
   "totalPhysMemBytes" : 10371174400
}
```
然后通过在URL中包含返回的主机ID之一来获取主机属性：
```
http://cm_server_host:7180/api/v19/hosts/2c2e951c-adf2-4780-a69f-0382181f1821?view=FULL
```

## 4.备份和恢复Cloudera Manager配置
您可以使用Cloudera Manager REST API来导出和导入其所有配置数据。API将导出一个包含Cloudera Manager
实例的配置数据的JSON文档。您可以使用此JSON文档来备份和恢复Cloudera Manager部署。

最低要求的角色：群集管理员（也由完全管理员提供）。

### 4.1.导出Cloudera Manager配置
1. 以root用户身份登录到Cloudera Manager服务器主机。
2. 运行以下命令：
    ```
    # curl -u admin_uname:admin_pass "http://cm_server_host:7180/api/v19/cm/deployment" > path_to_file/cm-deployment.json
    ```


































ddd
