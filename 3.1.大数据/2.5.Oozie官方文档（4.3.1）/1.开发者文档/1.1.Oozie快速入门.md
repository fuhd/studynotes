Oozie快速入门
================================================================================
这些说明使用嵌入式Tomcat服务器和嵌入式Derby数据库安装和运行Oozie。有关详细的安装和配置说明，请
参阅[Oozie Install](http://oozie.apache.org/docs/4.3.1/AG_Install.html)。

## 1.构建Oozie

### 1.1.系统要求
+ Unix box (tested on Mac OS X and Linux)
+ Java JDK 1.7+
+ Maven 3.0.1+
+ Hadoop 0.20.2+
+ Pig 0.7+

JDK命令（`java`，`javac`）必须位于命令路径中。

Maven命令（`mvn`）必须位于命令路径中。

### 1.2.构建Oozie
从[Oozie站点](http://oozie.apache.org/)的“Releases”下拉菜单下载Oozie的源代码。

解压源代码分发包`tar.gz`并将进入到解压目录中。

构建Oozie的最简单方法是运行`mkdistro.sh`脚本：
```shell
$ bin/mkdistro.sh
```
有关构建Oozie的更多详细信息，请参阅[Building Oozie](http://oozie.apache.org/docs/4.3.1/ENG_Building.html)
页面。

## 2.服务端安装

### 2.1.系统要求
+ Unix (tested in Linux and Mac OS X)
+ Java 1.7+
+ Hadoop
    - Apache Hadoop (tested with 1.2.1 & 2.4.0+)
+ ExtJS库（可选，启用Oozie webconsole）
    - [ExtJS 2.2](http://archive.cloudera.com/gplextras/misc/ext-2.2.zip)

Java 1.7+ `bin`目录应位于命令路径中。

### 2.2.服务端安装
**重要提示**：Oozie忽略`OOZIE_HOME`的任何设定值，Oozie自动计算其home。
+ 构建Oozie二进制分发版；
+ 下载Hadoop二进制发行版；
+ 下载ExtJS库（必须是2.2版）；

**注意**：ExtJS库未与Oozie捆绑在一起，因为它使用不同的许可证。

**注意**：Oozie UI浏览器兼容性Chrome（全部），Firefox（3.5），Internet Explorer（8.0），
Opera（10.5）。

**注意**：建议将Oozie Unix用户用于Oozie服务。

解压Oozie发行版tar.gz。

解压Hadoop发行版tar.gz（作为Oozie Unix用户）。

**注意**：为Oozie进程配置带有proxyuser的Hadoop集群。

Hadoop `core-site.xml`中需要以下两个属性：
```xml
<!-- OOZIE -->
<property>
    <name>hadoop.proxyuser.[OOZIE_SERVER_USER].hosts</name>
    <value>[OOZIE_SERVER_HOSTNAME]</value>
</property>
<property>
    <name>hadoop.proxyuser.[OOZIE_SERVER_USER].groups</name>
    <value>[USER_GROUPS_THAT_ALLOW_IMPERSONATION]</value>
</property>
```
用特定值替换大写字母部分，然后重新启动Hadoop。

ExtJS库是可选的（只有Oozie Web控制台才能工作）。

**重要提示**：所有Oozie服务器脚本（`oozie-setup.sh`，`oozied.sh`，`oozie-start.sh`，
`oozie-run.sh`和`oozie-stop.sh`）仅在拥有Oozie安装目录的Unix用户下运行，如果需要，在调用脚
本时使用`sudo -u OOZIE_USER`。

从`Oozie 3.3.2`开始，不推荐使用`oozie-start.sh`，`oozie-run.sh`和`oozie-stop.sh`，并
会打印警告。应该使用`oozied.sh`脚本; 将其作为参数传递，`start`，`run`或`stop`将分别执行
`oozie-start.sh`，`oozie-run.sh`和`oozie-stop.sh`的行为。

在扩展Oozie的目录中创建一个`libext/`目录。

如果使用ExtJS库将ZIP文件复制到`libext/`目录。如果var中尚未包含hadoop和hcatalog库，请将相应
的库添加到`libext/`目录中。

运行`oozie-setup.sh`以将新的`sharelib`上传到hdfs时，“`sharelib create -fs fs_default_name [-locallib sharelib]`”
命令可用，其中第一个参数是默认的fs名称，第二个参数是要安装的Oozie sharelib，它 可以是tarball
或它的扩展版本。如果省略第二个参数，将使用Oozie安装目录中的Oozie sharelib tarball。不推荐使
用升级命令，应该使用create命令创建新版本的sharelib。Sharelib文件被复制到新的lib目录。在开始
时，服务器从最新的时间戳目录中选择sharelib。启动服务器时还清除sharelib目录，该目录早于sharelib
保留天数（定义为`oozie.service.ShareLibService.temp.sharelib.retention.days`，默认为
**7天**）。

“`prepare-war [-d directory]`”命令用于为oozie创建war文件，并使用除libext之外的可选替代目
录。

`db create|upgrade|postupgrade -run [-sqlfile]`命令用于创建，升级或postupgrade oozie
db，带有可选的sql文件。

运行`oozie-setup.sh`脚本以配置添加到`libext/`目录的Oozie的所有组件。
```shell
$ bin/oozie-setup.sh prepare-war [-d directory] [-secure]
                     sharelib create -fs <FS_URI> [-locallib <PATH>]
                     sharelib upgrade -fs <FS_URI> [-locallib <PATH>]
                     db create|upgrade|postupgrade -run [-sqlfile <FILE>]
```
`-secure`选项将配置Oozie使用HTTP（SSL）;有关更多详细信息，请参阅 [使用HTTPS（SSL）设置Oozie](http://oozie.apache.org/docs/4.3.1/AG_Install.html#Setting_Up_Oozie_with_HTTPS_SSL)。

使用`ooziedb.sh`命令行工具创建Oozie DB：
```shell
$ bin/ooziedb.sh create -sqlfile oozie.sql -runValidate DB Connection.
DONE
Check DB schema does not exist
DONE
Check OOZIE_SYS table does not exist
DONE
Create SQL schema
DONE
DONE
Create OOZIE_SYS table
DONE
Oozie DB has been created for Oozie version '3.2.0'
$
```
启动Oozie作为守护进程运行：
```shell
$ bin/oozied.sh start
```
要启动Oozie作为前台进程运行：
```shell
$ bin/oozied.sh run
```
检查Oozie日志文件`logs/oozie.log`以确保Oozie正常启动。

使用Oozie命令行工具检查Oozie的状态：
```shell
$ bin/oozie admin -oozie http://localhost:11000/oozie -status
```
使用浏览器转到Oozie Web控制台，Oozie状态应为 **NORMAL**。

有关[运行示例](http://oozie.apache.org/docs/4.3.1/DG_Examples.html)的详细信息，请参阅
运行示例文档。

## 3.客户端安装

### 3.1.系统要求
+ Unix (tested in Linux and Mac OS X)
+ Java 1.7+

Java 1.7+ `bin`目录应位于命令路径中。

### 3.2.客户端安装
复制并解压与发行版捆绑在一起的`oozie-client`TAR.GZ文件。将`bin/`目录添加到`PATH`。

有关`oozie`命令行工具的完整参考，请参阅 [命令行界面实用程序文档](http://oozie.apache.org/docs/4.3.1/DG_CommandLineTool.html)。

**注意**：Oozie服务端安装包括Oozie客户端。Oozie客户端应仅安装在远程计算机上。

## 4.Oozie Share Lib安装
Oozie共享库已由前面部分中解释的`oozie-setup.sh` `create`命令安装。

有关Oozie ShareLib的更多信息，请参阅[工作流功能规范](http://oozie.apache.org/docs/4.3.1/WorkflowFunctionalSpec.html#ShareLib)和[安装](http://oozie.apache.org/docs/4.3.1/AG_Install.html#Oozie_Share_Lib)。

