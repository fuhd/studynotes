Oozie工作流功能规范
================================================================================
本文档的目标是定义一个专门用于协调Hadoop Map/Reduce和Pig作业执行的工作流引擎系统。

## 1.定义
+ **Action**：执行/计算任务（Map-Reduce作业，Pig作业，shell命令）。它也可以称为任务或“动作
节点”。
+ **Workflow**：在控件依赖关系DAG（有向无环图）中排列的动作集合。从一个动作到另一个动作的“控制
依赖性”意味着第二个动作在第一个动作完成之前无法运行。
+ **Workflow定义**：可以执行的工作流的编程描述。
+ **Workflow定义语言**：用于定义工作流定义的语言。
+ **Workflow作业**：工作流定义的可执行实例。
+ **Workflow引擎**：执行Workflow作业的系统。它也可以称为DAG引擎。

## 2.规格要点
Workflow应用程序是DAG，它协调以下类型的操作：Hadoop，Pig和子Workflow。

可以使用`decision`，`fork`和`join`节点完成Workflow应用程序中的流控制操作。不支持Workflow中
的循环。

可以使用Job属性，Action输出（即Hadoop计数器）和文件信息（文件存在，文件大小等）来参数化Action
和decision。正式参数在Workflow定义中表示为`${VAR}`变量。

Workflow应用程序是一个ZIP文件，其中包含Workflow定义（XML文件），运行所有Actions所需的所有文
件：Map/Reduce作业的JAR文件，流Map/Reduce作业的shell，本地库，Pig脚本和其他资源文件。

在运行Workflow作业之前，必须在Oozie中部署相应的Workflow应用程序。

部署Workflow应用程序和运行Workflow作业可以通过命令行工具，WS API和Java API完成。

可以通过Web控制台，命令行工具，WS API和Java API来监视系统和Workflow作业。

提交Workflow作业时，必须提供一组解析工作流定义中所有形式参数的属性。这组属性是Hadoop配置。

Workflow作业的可能状态包括：`PREP`，`RUNNING`，`SUSPENDED`，`SUCCEEDED`，`KILLED`和`FAILED`。

如果Workflow作业中的操作启动失败，则根据失败的类型，Oozie将尝试自动重试，它将请求手动重试，否则
将使工作流作业失败。

Oozie可以在Action `start`/`end`/`failure`事件和工作流`end`/'failure'事件上发出HTTP回调
通知。

在Workflow作业失败的情况下，可以重新提交工作流作业，跳过以前完成的操作。在重新提交之前，可以使用
修补程序更新Workflow应用程序，以修复Workflow应用程序代码中的问题。

## 3.Workflow定义
Workflow定义是具有 **控制流节点**（`start`，`end`，`decision`，`fork`，`join`，`kill`）
或 **动作节点**（`map-reduce`，`pig`等）的DAG，节点通过转换箭头连接。

Workflow定义语言是基于XML的，它被称为 **hPDL**（Hadoop流程定义语言）。

有关[Oozie Workflow Definition XML Schema](http://oozie.apache.org/docs/4.3.1/WorkflowFunctionalSpec.html#OozieWFSchema)的信息，请参阅附录A. 附录B包含
[工作流程定义示例](http://oozie.apache.org/docs/4.3.1/WorkflowFunctionalSpec.html#OozieWFExamples)。

### 3.1.Workflow定义中的循环
Oozie不支持Workflow定义中的循环，Workflow定义必须是严格的DAG。

在Workflow应用程序部署时，如果Oozie在Workflow定义中检测到循环，则必须使部署失败。

## 4.Workflow节点
Workflow节点分为控制流节点和操作节点：
+ **控制流节点**：控制Workflow和Workflow作业执行路径的开始和结束的节点。
+ **操作节点**：触发执行计算/处理任务的节点。

节点名称和转换必须符合以下模式`[a-zA-Z][\_-a-zA-Z0-0]`，最多20个字符。

### 4.1.控制流节点
控制流节点定义Workflow的开始和结束（`start`，`end`和`kill`节点），并提供控制工作流执行路径
（`decision`，`fork`和`join`节点）的机制。

#### 4.1.1.启动控制节点
`start`节点是Workflow作业的入口点，它指示Workflow作业必须转换到的第一个工作流节点。

Workflow启动时，它会自动转换到`start`指定的节点。工作流定义必须具有一个`start`节点。

语法：
```xml
<workflow-app name="[WF-DEF-NAME]" xmlns="uri:oozie:workflow:0.1">
  ...
  <start to="[NODE-NAME]"/>
  ...
</workflow-app>
```
`to`属性是要执行的第一个工作流节点的名称。

示例：
```xml
<workflow-app name="foo-wf" xmlns="uri:oozie:workflow:0.1">
    ...
    <start to="firstHadoopJob"/>
    ...
</workflow-app>
```

#### 4.1.2.结束控制节点
`end`节点是Workflow作业的结束，它表示Workflow作业已成功完成。

当Workflow作业到达`end`时，它成功完成（SUCCEEDED）。


