Oozie示例
================================================================================
## 1.命令行示例

### 1.1.设置示例
Oozie示例捆绑在oozie-examples.tar.gz文件中的Oozie发行版中。解压此文件将在本地文件系统中创建
examples目录。**必须将examples目录复制到HDFS中的用户HOME目录**：
```shell 
$ hadoop fs -put examples examples
```
**注意**：如果HDFS中已存在examples目录，则必须先将其删除，然后再将其复制。否则可能无法复制文件。

### 1.2.运行示例
对于Streaming和Pig示例，[Oozie共享库](http://oozie.apache.org/docs/4.3.1/DG_QuickStart.html#OozieShareLib)
必须安装在HDFS中。

将Oozie `bin/`添加到环境PATH。

示例假设JobTracker是`localhost：8021`，NameNode是`hdfs://localhost:8020`。如果实际值不
同，则必须将examples目录中的 **作业属性文件** 编辑为正确的值。

示例应用程序位于`examples/app`目录下，每个示例一个目录。该目录包含应用程序 **XML文件**（工作
流，工作流和协调程序），用于提交作业的 **job.properties文件** 以及示例可能 **需要的任何JAR
文件**。

所有示例的输入都在 **examples/input-data/** 目录中。

这些示例在 **examples/output-data/${EXAMPLE_NAME}** 目录下创建输出。

**注意**：job.properties文件在提交期间需要是本地文件，而不是HDFS路径。

**如何运行示例应用程序**：
```shell
$ oozie job -oozie http://localhost:11000/oozie -config examples/apps/map-reduce/job.properties -run
.
job: 14-20090525161321-oozie-tucu
```
**检查工作流作业状态**：
```shell
$ oozie job -oozie http://localhost:11000/oozie -info 14-20090525161321-oozie-tucu
.
.----------------------------------------------------------------------------------------------------------------------------------------------------------------
Workflow Name :  map-reduce-wf
App Path      :  hdfs://localhost:8020/user/tucu/examples/apps/map-reduce
Status        :  SUCCEEDED
Run           :  0
User          :  tucu
Group         :  users
Created       :  2009-05-26 05:01 +0000
Started       :  2009-05-26 05:01 +0000
Ended         :  2009-05-26 05:01 +0000
Actions
.----------------------------------------------------------------------------------------------------------------------------------------------------------------
Action Name             Type        Status     Transition  External Id            External Status  Error Code    Start Time              End Time
.----------------------------------------------------------------------------------------------------------------------------------------------------------------
mr-node                 map-reduce  OK         end         job_200904281535_0254  SUCCEEDED        -             2009-05-26 05:01 +0000  2009-05-26 05:01 +0000
.----------------------------------------------------------------------------------------------------------------------------------------------------------------
```
要通过`Oozie Web`控制台检查工作流作业状态，请使用浏览器访问：`http://localhost:11000/oozie`。

为避免必须在每个`oozie`命令中使用Oozie URL提供`-oozie`选项，请将`OOZIE_URL`env变量设置为
shell环境中的Oozie URL。例如：
```shell
$ export OOZIE_URL="http://localhost:11000/oozie"
$
$ oozie job -info 14-20090525161321-oozie-tucu
```

## 2.Java API示例
Oozie提供了一个Java客户端API，简化了Oozie与Java应用程序的集成。此Java客户端API是与Oozie Web
服务API交互的便捷API。

以下代码段显示了如何使用Java Client API提交Oozie作业：
```java
import org.apache.oozie.client.OozieClient;
import org.apache.oozie.client.WorkflowJob;

import java.util.Properties;
.
    ...
.
    // get a OozieClient for local Oozie
    OozieClient wc = new OozieClient("http://bar:11000/oozie");
.
    // create a workflow job configuration and set the workflow application path
    Properties conf = wc.createConfiguration();
    conf.setProperty(OozieClient.APP_PATH, "hdfs://foo:8020/usr/tucu/my-wf-app");
.
    // setting workflow parameters
    conf.setProperty("jobTracker", "foo:8021");
    conf.setProperty("inputDir", "/usr/tucu/inputdir");
    conf.setProperty("outputDir", "/usr/tucu/outputdir");
    ...
.
    // submit and start the workflow job
    String jobId = wc.run(conf);
    System.out.println("Workflow job submitted");
.
    // wait until the workflow job finishes printing the status every 10 seconds
    while (wc.getJobInfo(jobId).getStatus() == Workflow.Status.RUNNING) {
        System.out.println("Workflow job running ...");
        Thread.sleep(10 * 1000);
    }
.
    // print the final status of the workflow job
    System.out.println("Workflow job completed ...");
    System.out.println(wf.getJobInfo(jobId));
    ...

```

## 3.本地Oozie示例
Oozie提供了一个嵌入式Oozie实现 **LocalOozie**，它可以方便IDE在工作流应用程序的开发，调试和测
试中使用。

下面的代码显示了LocalOozie类的用法。与Oozie的所有交互都是使用Oozie **OozieClient** Java 
API完成的，如上一节所示。

与Oozie捆绑在一起的示例包括完整且正在运行的类，**LocalOozieExample** 来自此。
```java
import org.apache.oozie.local.LocalOozie;
import org.apache.oozie.client.OozieClient;
import org.apache.oozie.client.WorkflowJob;
.
import java.util.Properties;
.
    ...
    // start local Oozie
    LocalOozie.start();
.
    // get a OozieClient for local Oozie
    OozieClient wc = LocalOozie.getClient();
.
    // create a workflow job configuration and set the workflow application path
    Properties conf = wc.createConfiguration();
    conf.setProperty(OozieClient.APP_PATH, "hdfs://foo:8020/usr/tucu/my-wf-app");
.
    // setting workflow parameters
    conf.setProperty("jobTracker", "foo:8021");
    conf.setProperty("inputDir", "/usr/tucu/inputdir");
    conf.setProperty("outputDir", "/usr/tucu/outputdir");
    ...
.
    // submit and start the workflow job
    String jobId = wc.run(conf);
    System.out.println("Workflow job submitted");
.
    // wait until the workflow job finishes printing the status every 10 seconds
    while (wc.getJobInfo(jobId).getStatus() == Workflow.Status.RUNNING) {
        System.out.println("Workflow job running ...");
        Thread.sleep(10 * 1000);
    }
.
    // print the final status of the workflow job
    System.out.println("Workflow job completed ...");
    System.out.println(wf.getJobInfo(jobId));
.
    // stop local Oozie
    LocalOozie.stop();
    ...
```
