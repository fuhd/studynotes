HDFS的概念
========================================================================
### 数据块
每个磁盘都有默认的数据块大小，这是磁盘进行数据读/写的最小单位。构建于单个磁盘之上的文件系统通过
磁盘块来管理该文件系统中的块，该文件系统块的大小可以是磁盘块的整数倍。**文件系统块一般为几千字节，
而磁盘块一般为`512`字节**。

**`HDFS`同样也有块（`block`）的概念，但是大得多，默认为`128MB`**。与单一磁盘上的文件系统相似，
**`HDFS`上的文件也被划分为块大小的多个分块（`chunk`），作为独立的存储单元**。但与面向单一磁盘的文件
系统不同的是，**`HDFS`中小于一个块大小的文件不会占据整个块的空间**（例如，当一个`1MB`的文件存储在
一个`128MB`的块中时，文件只使用`1MB`的磁盘空间，而不是`128MB`）。
```
HDFS中的块为什么这么大？
HDFS的块比磁盘的块大，其目的是为了最小化寻址开销。如果块足够大，从磁盘传输数据的时间会明显大于定位这个块开始位置所需的
时间。因而，传输一个由多个块组成的大文件的时间取决于磁盘传输速率。

我们来做一个速算，如果寻址时间约为10ms，传输速率为100MB/s，为了使寻址时间仅占传输时间的1%，我们要将块大小设置约为
100MB。默认的块大小实际为128MB，但是很多情况下HDFS安装时使用更大的块。以后随着新一代磁盘驱动器传输速率的提升，块的
大小会被设计得更大。

但是这个参数也不会设置得过大。MapReduce中的map任务通常一次只处理一个块中的数据，因此如果任务数太少（少于集群中的节
点数量），作业的运行速度就会比较慢。
```
对分布式文件系统中的块进行抽象会带来很多好处。第一个最明显的好处是，**一个文件的大小可以大于网络中
任意一个磁盘的容量**。文件的所有块并不需要存储在同一个磁盘上，因此它们可以利用集群上的任意一个磁盘
进行存储。

第二个好处是，**使用抽象块而不是整个文件作为存储单元，大大简化了存储子系统的设计**。简化是所有系
统的目标，但是这对于故障各类繁多的分布式系统来说尤为重要。将存储子系统的对象设置成块，可简化存储
管理（**由于块的大小是固定的，因此计算单个磁盘能存储多少个块就相对容易**）。同时也消除了对元数据
的顾虑（**块只是要存储的大块数据，而文件的元数据，如权限信息，并不需要与块一同存储，这样一来，其他
系统就可以单独管理这些元数据**）。

不仅如此，**块还非常适合用于数据备份** 进而提供数据容错能力和提高可用性。将每个块复制到少数几个物理
上相互独立的机器上（**默认为`3`个**），可以确保在块、磁盘或机器发生故障后数据不会丢失。如果发现
一个块不可用，系统会从其它地方读取另一个复本，而这个过程对用户是透明的。**一个因损坏或机器故障而丢失
的块可以从其他候选地点复制到另一台可以正常运行的机器上，以保证复本的数量回到正常水平**。

与磁盘文件系统相似，**`HDFS`中`fsck`指令可以显示块信息**。例如，执行以下命令将列出文件系统中各个文件
由哪些块构成。
```shell
$ hdfs fsck / -files -blocks
```

### namenode和datanode
`HDFS`集群有 **两类节点** 以管理节点/工作节点模型运行，**即一个`namenode`（管理节点）和多个`datanode`
（工作节点）。`namenode`管理文件系统的命名空间。它维护着文件系统树及整棵树内所有的文件和目录**。
这些信息以 **两个文件** 形式永久保存在 **本地磁盘** 上：**命名空间镜像文件和编辑日志文件**。
`namenode`也记录着每个文件中各个块所在的数据节点信息，但它并不永久保存块的位置信息，因为这些信息
会在系统启动时根据数据节点信息重建。

客户端（`client`）代表用户通过与`namenode`和`datanode`交互来访问整个文件系统。客户端提供一个
类似于`POSIX`（可移植操作系统界面）的文件系统接口，因此用户在编程时无需知道`namenode`和`datanode`
也可实现其功能。

**`datanode`是文件系统的工作节点。它们根据需要存储并检索数据块（受客户端或`namenode`调度），并且
定期向`namenode`发送它们所存储的块的列表**。

**没有`namenode`，文件系统将无法使用。事实上，如果运行`namenode`服务的机器毁坏，文件系统上所有的
文件将会丢失，因为我们不知道如果根据`datanode`的块重建文件**。因此，对`namenode`实现容错非常重要，
`Hadoop`为此提供两种机制。





































w
