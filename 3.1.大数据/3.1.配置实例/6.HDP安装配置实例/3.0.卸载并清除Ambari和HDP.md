卸载并清除Ambari和HDP
================================================================================
## 1.停止在Ambari中的所有服务

![停止在Ambari中的所有服务](img/31.png)

## 2.停止Ambari Server与Ambari Agent
在`server01.tythin.com`上执行：
```shell
ambari-server stop
```
在 **所有节点上** 执行：
```shell
ambari-agent stop
```

## 3.卸载Ambari Server与Ambari Agent
在`server01.tythin.com`上执行：
```shell
yum remove ambari-server -y
```
在 **所有节点上** 执行：
```shell
yum remove ambari-agent -y
```

## 4.删除已安装的服务组件

### 4.1.卸载安装的软件
在 **所有节点** 上执行：
```shell
yum remove hadoop_3* hdp-select* ranger_3* zookeeper_* bigtop* atlas-metadata* ambari* postgresql* spark2*  slider* storm* snappy*
```

### 4.2.再检查已安装服务（可能有没卸载的软件）
在 **所有节点** 上执行：
```shell
yum list installed | grep ambari  

#示例结果：
ambari-agent.x86_64                   2.7.3.0-139                @ambari-2.7.3.0
ambari-infra-solr.noarch              2.7.3.0-139                @ambari-2.7.3.0
ambari-infra-solr-client.noarch       2.7.3.0-139                @ambari-2.7.3.0
ambari-metrics-grafana.x86_64         2.7.3.0-139                @ambari-2.7.3.0
ambari-metrics-hadoop-sink.x86_64     2.7.3.0-139                @ambari-2.7.3.0
ambari-metrics-monitor.x86_64         2.7.3.0-139                @ambari-2.7.3.0
smartsense-hst.x86_64                 1.5.1.2.7.3.0-139          @ambari-2.7.3.0
```
```shell
yum list installed | grep HDP 

#示例结果：
                                      1.1.0.3.1.0.0-78           @HDP-3.1-repo-1
                                      1.1.0.3.1.0.0-78           @HDP-3.1-repo-1
bigtop-jsvc.x86_64                    1.0.15-78                  @HDP-3.1-repo-1
hadoop_3_1_0_0_78.x86_64              3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-client.x86_64       3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-hdfs.x86_64         3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-libhdfs.x86_64      3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-mapreduce.x86_64    3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-yarn.x86_64         3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hbase_3_1_0_0_78.noarch               2.0.2.3.1.0.0-78           @HDP-3.1-repo-1
hdp-select.noarch                     3.1.0.0-78.el7             @HDP-3.1-repo-1
hive_3_1_0_0_78.noarch                3.1.0.3.1.0.0-78           @HDP-3.1-repo-1
hive_3_1_0_0_78-hcatalog.noarch       3.1.0.3.1.0.0-78           @HDP-3.1-repo-1
hive_3_1_0_0_78-jdbc.noarch           3.1.0.3.1.0.0-78           @HDP-3.1-repo-1
                                      1.0.0.3.1.0.0-78           @HDP-3.1-repo-1
kafka_3_1_0_0_78.noarch               2.0.0.3.1.0.0-78           @HDP-3.1-repo-1
livy2_3_1_0_0_78.noarch               0.5.0.3.1.0.0-78           @HDP-3.1-repo-1
phoenix_3_1_0_0_78.noarch             5.0.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-hbase-plugin.x86_64 1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-hdfs-plugin.x86_64  1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-hive-plugin.x86_64  1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-kafka-plugin.x86_64 1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-yarn-plugin.x86_64  1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
snappy-devel.x86_64                   1.1.0-3.el7                @HDP-UTILS-1.1.0.22-repo-1
spark2_3_1_0_0_78.noarch              2.3.2.3.1.0.0-78           @HDP-3.1-repo-1
spark2_3_1_0_0_78-python.noarch       2.3.2.3.1.0.0-78           @HDP-3.1-repo-1
spark2_3_1_0_0_78-yarn-shuffle.noarch 2.3.2.3.1.0.0-78           @HDP-3.1-repo-1
tez_3_1_0_0_78.noarch                 0.9.1.3.1.0.0-78           @HDP-3.1-repo-1
zookeeper_3_1_0_0_78.noarch           3.4.6.3.1.0.0-78           @HDP-3.1-repo-1
zookeeper_3_1_0_0_78-server.noarch    3.4.6.3.1.0.0-78           @HDP-3.1-repo-1
```

### 4.3.根据检查出的服务进行卸载
在 **所有节点** 上执行：
```shell
#示例：
yum remove ambari* -y
yum remove smartsense-hst* -y
#
yum remove hadoop* -y
yum remove bigtop-jsvc* -y
yum remove hbase* -y
yum remove hdp-select* -y
yum remove hive* -y
yum remove kafka* -y
yum remove livy2* -y
yum remove phoenix* -y
yum remove ranger* -y
yum remove snappy-devel* -y
yum remove spark2* -y
yum remove tez* -y
yum remove zookeeper* -y
```

## 5.删除postgresql的数据
在`10.10.26.31`（server01.tythin.com）上执行：
```shell
rm -rf /var/lib/pgsql
```

## 6.删除用户
在 **所有节点** 上执行：
```shell
userdel oozie  
userdel hive  
userdel ambari-qa  
userdel flume    
userdel hdfs    
userdel knox    
userdel storm    
userdel mapred  
userdel hbase    
userdel tez    
userdel zookeeper  
userdel kafka    
userdel falcon  
userdel sqoop    
userdel yarn    
userdel hcat  
userdel atlas  
userdel spark  
userdel ams
userdel kms
userdel activity_analyzer
userdel infra-solr
userdel livy
userdel ranger
userdel yarn-ats
userdel mahout
userdel accumulo
```
```shell
rm -rf /home/atlas  
rm -rf /home/accumulo  
rm -rf /home/hbase  
rm -rf /home/hive  
rm -rf /home/oozie  
rm -rf /home/storm  
rm -rf /home/yarn  
rm -rf /home/ambari-qa  
rm -rf /home/falcon  
rm -rf /home/hcat  
rm -rf /home/kafka  
rm -rf /home/mahout  
rm -rf /home/spark  
rm -rf /home/tez  
rm -rf /home/zookeeper  
rm -rf /home/flume  
rm -rf /home/hdfs  
rm -rf /home/knox  
rm -rf /home/mapred  
rm -rf /home/sqoop  
rm -rf /home/kms
rm -rf /home/activity_analyzer
rm -rf /home/ams
rm -rf /home/infra-solr
rm -rf /home/livy
rm -rf /home/ranger
rm -rf /home/yarn-ats
```

## 7.删除ambari遗留数据
在 **所有节点** 上执行：
```shell
rm -rf /var/lib/ambari*  
rm -rf /usr/lib/python2.6/site-packages/ambari_*  
rm -rf /usr/lib/python2.6/site-packages/resource_management  
rm -rf /usr/lib/ambri-* 
```

## 8.删除其他hadoop组件遗留数据
在 **所有节点** 上执行：
```shell
rm -rf /etc/falcon 
rm -rf /etc/knox 
rm -rf /etc/hive-webhcat 
rm -rf /etc/kafka 
rm -rf /etc/slider 
rm -rf /etc/storm-slider-client 
rm -rf /etc/spark 
rm -rf /var/run/spark 
rm -rf /var/run/hadoop 
rm -rf /var/run/hbase 
rm -rf /var/run/zookeeper 
rm -rf /var/run/flume 
rm -rf /var/run/storm 
rm -rf /var/run/webhcat 
rm -rf /var/run/hadoop-yarn 
rm -rf /var/run/hadoop-mapreduce 
rm -rf /var/run/kafka 
rm -rf /var/log/hadoop 
rm -rf /var/log/hbase 
rm -rf /var/log/flume 
rm -rf /var/log/storm 
rm -rf /var/log/hadoop-yarn 
rm -rf /var/log/hadoop-mapreduce 
rm -rf /var/log/knox 
rm -rf /usr/lib/flume 
rm -rf /usr/lib/storm 
rm -rf /var/lib/hive 
rm -rf /var/lib/oozie 
rm -rf /var/lib/flume 
rm -rf /var/lib/hadoop-hdfs 
rm -rf /var/lib/knox 
rm -rf /var/log/hive 
rm -rf /var/log/oozie 
rm -rf /var/log/zookeeper 
rm -rf /var/log/falcon 
rm -rf /var/log/webhcat 
rm -rf /var/log/spark 
rm -rf /var/tmp/oozie 
rm -rf /tmp/ambari-qa 
rm -rf /var/hadoop 
rm -rf /hadoop/falcon 
rm -rf /tmp/hadoop 
rm -rf /tmp/hadoop-hdfs 
rm -rf /usr/hdp 
rm -rf /usr/hadoop 
rm -rf /opt/hadoop 
rm -rf /opt/hadoop2
rm -rf /tmp/hadoop 
rm -rf /var/hadoop 
rm -rf /hadoop 
rm -rf /etc/ambari-metrics-collector
rm -rf /etc/ambari-metrics-monitor
rm -rf /var/run/ambari-metrics-collector
rm -rf /var/run/ambari-metrics-monitor
rm -rf /var/log/ambari-metrics-collector
rm -rf /var/log/ambari-metrics-monitor
rm -rf /var/lib/hadoop-yarn
rm -rf /var/lib/hadoop-mapreduce
```

## 9.清理yum数据源
在 **所有节点** 上执行：
```shell
yum clean all 
```