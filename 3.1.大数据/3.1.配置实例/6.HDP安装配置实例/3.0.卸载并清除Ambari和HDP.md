卸载并清除Ambari和HDP
================================================================================
## 1.停止在Ambari中的所有服务

![停止在Ambari中的所有服务](img/31.png)

## 2.停止Ambari Server与Ambari Agent
在`server01.tythin.com`上执行：
```shell
ambari-server stop
```
在 **所有节点上** 执行：
```shell
ambari-agent stop
```

## 3.卸载Ambari Server与Ambari Agent
在`server01.tythin.com`上执行：
```shell
yum remove ambari-server -y
yum remove postgresql* -y
```
在 **所有节点上** 执行：
```shell
yum remove ambari-agent -y
```

## 4.删除已安装的服务组件

## 4.1.检查已安装服务
在 **所有节点** 上执行：
```shell
yum list installed | grep ambari  

#示例结果：
ambari-agent.x86_64                   2.7.3.0-139                @ambari-2.7.3.0
ambari-infra-solr.noarch              2.7.3.0-139                @ambari-2.7.3.0
ambari-infra-solr-client.noarch       2.7.3.0-139                @ambari-2.7.3.0
ambari-metrics-grafana.x86_64         2.7.3.0-139                @ambari-2.7.3.0
ambari-metrics-hadoop-sink.x86_64     2.7.3.0-139                @ambari-2.7.3.0
ambari-metrics-monitor.x86_64         2.7.3.0-139                @ambari-2.7.3.0
smartsense-hst.x86_64                 1.5.1.2.7.3.0-139          @ambari-2.7.3.0
```
```shell
yum list installed | grep HDP 

#示例结果：
                                      1.1.0.3.1.0.0-78           @HDP-3.1-repo-1
                                      1.1.0.3.1.0.0-78           @HDP-3.1-repo-1
bigtop-jsvc.x86_64                    1.0.15-78                  @HDP-3.1-repo-1
hadoop_3_1_0_0_78.x86_64              3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-client.x86_64       3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-hdfs.x86_64         3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-libhdfs.x86_64      3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-mapreduce.x86_64    3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hadoop_3_1_0_0_78-yarn.x86_64         3.1.1.3.1.0.0-78           @HDP-3.1-repo-1
hbase_3_1_0_0_78.noarch               2.0.2.3.1.0.0-78           @HDP-3.1-repo-1
hdp-select.noarch                     3.1.0.0-78.el7             @HDP-3.1-repo-1
hive_3_1_0_0_78.noarch                3.1.0.3.1.0.0-78           @HDP-3.1-repo-1
hive_3_1_0_0_78-hcatalog.noarch       3.1.0.3.1.0.0-78           @HDP-3.1-repo-1
hive_3_1_0_0_78-jdbc.noarch           3.1.0.3.1.0.0-78           @HDP-3.1-repo-1
                                      1.0.0.3.1.0.0-78           @HDP-3.1-repo-1
kafka_3_1_0_0_78.noarch               2.0.0.3.1.0.0-78           @HDP-3.1-repo-1
livy2_3_1_0_0_78.noarch               0.5.0.3.1.0.0-78           @HDP-3.1-repo-1
phoenix_3_1_0_0_78.noarch             5.0.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-hbase-plugin.x86_64 1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-hdfs-plugin.x86_64  1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-hive-plugin.x86_64  1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-kafka-plugin.x86_64 1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
ranger_3_1_0_0_78-yarn-plugin.x86_64  1.2.0.3.1.0.0-78           @HDP-3.1-repo-1
snappy-devel.x86_64                   1.1.0-3.el7                @HDP-UTILS-1.1.0.22-repo-1
spark2_3_1_0_0_78.noarch              2.3.2.3.1.0.0-78           @HDP-3.1-repo-1
spark2_3_1_0_0_78-python.noarch       2.3.2.3.1.0.0-78           @HDP-3.1-repo-1
spark2_3_1_0_0_78-yarn-shuffle.noarch 2.3.2.3.1.0.0-78           @HDP-3.1-repo-1
tez_3_1_0_0_78.noarch                 0.9.1.3.1.0.0-78           @HDP-3.1-repo-1
zookeeper_3_1_0_0_78.noarch           3.4.6.3.1.0.0-78           @HDP-3.1-repo-1
zookeeper_3_1_0_0_78-server.noarch    3.4.6.3.1.0.0-78           @HDP-3.1-repo-1
```

## 4.2.根据检查出的服务进行卸载
在 **所有节点** 上执行：
```shell
#示例：
yum remove ambari* -y
yum remove smartsense-hst* -y

yum remove hadoop* -y
yum remove bigtop-jsvc* -y
yum remove hbase* -y
yum remove hdp-select* -y
yum remove hive* -y
yum remove kafka* -y
yum remove livy2* -y
yum remove phoenix* -y
yum remove ranger* -y
yum remove snappy-devel* -y
yum remove spark2* -y
yum remove tez* -y
yum remove zookeeper* -y
```

## 5.删除用户
在 **所有节点** 上执行：
```shell
userdel nagios   
userdel hive   
userdel ambari-qa   
userdel hbase   
userdel oozie   
userdel hcat   
userdel mapred   
userdel hdfs   
userdel rrdcached   
userdel zookeeper   
userdel mysql   
userdel sqoop  
userdel puppet  
userdel yarn  
userdel tez  
userdel hadoop  
userdel knox  
userdel storm  
userdel falcon  
userdel flume  
userdel nagios  
userdel admin  
userdel postgres  
userdel  hdfs  
userdel  zookeeper  
userdel hbase  
userdel ams       
userdel spark     
userdel kafka     
userdel ranger    
userdel kms       
userdel zookeeper     
userdel ambari-qa     
userdel hdfs      
userdel yarn      
userdel mapred  
```

## 6.删除文件
在 **所有节点** 上执行：
```shell
rm -rf /hadoop/*  
rm -rf /etc/ambari*  
rm -rf /etc/zookeeper/  
rm -rf /etc/ranger*  
rm -rf /etc/rc.d/init.d/ranger*  
rm -rf /etc/hadoop/  
rm -rf /etc/hadoop/  
rm -rf /etc/hbase/  
rm -rf /etc/hive  
rm -rf /usr/hdp/  
rm -rf /etc/zookeeper/  
rm -rf /tmp/ambari-qa  
rm -rf /tmp/sqoop-ambari-qa/  
rm -rf /kafka-logs/  
rm -rf /var/lib/ambari*  
rm -rf /var/lib/hive2*  
rm -rf /var/run/kafka/  
rm -rf /etc/flume     
rm -rf /etc/hive-hcatalog     
rm -rf /etc/hive-webhcat      
rm -rf /etc/phoenix       
rm -rf /etc/ambari-metrics-collector      
rm -rf /etc/ambari-metrics-monitor    
rm -rf /tmp/hdfs      
rm -rf /tmp/hcat      
rm -rf /etc/kafka  
rm -rf /etc/oozie     
rm -rf /etc/storm     
rm -rf /etc/tez       
rm -rf /etc/falcon    
rm -rf /etc/slider    
rm -rf /etc/pig       
rm -rf /etc/ranger    
rm -rf /var/log/hadoop    
rm -rf /var/log/hbase     
rm -rf /var/log/hive      
rm -rf /var/log/oozie     
rm -rf /var/log/sqoop     
rm -rf /var/log/zookeeper     
rm -rf /var/log/flume     
rm -rf /var/log/storm     
rm -rf /var/log/hive-hcatalog     
rm -rf /var/log/falcon    
rm -rf /var/log/webhcat       
rm -rf /var/log/hadoop-hdfs       
rm -rf /var/log/hadoop-yarn       
rm -rf /var/log/hadoop-mapreduce      
rm -rf /var/log/spark     
rm -rf /var/log/ranger    
rm -rf /usr/lib/flume     
rm -rf /usr/lib/storm     
rm -rf /var/lib/hive      
rm -rf /var/lib/oozie     
rm -rf /var/lib/zookeeper     
rm -rf /var/lib/flume     
rm -rf /var/lib/hadoop-hdfs       
rm -rf /var/lib/slider    
rm -rf /var/lib/ranger    
rm -rf /var/tmp/oozie     
rm -rf /var/tmp/sqoop     
rm -rf /tmp/hive      
rm -rf /tmp/hadoop-hdfs       
rm -rf /etc/sqoop     
rm -rf /var/log/ambari-metrics-collector      
rm -rf /var/log/ambari-metrics-monitor    
rm -rf /usr/lib/ambari-metrics-collector      
rm -rf /var/lib/hadoop-yarn       
rm -rf /var/lib/hadoop-mapreduce      
rm -rf /var/lib/ambari-metrics-collector      
rm -rf /var/log/kafka     
rm -rf /tmp/hadoop-yarn       
rm -rf /hadoop/zookeeper      
rm -rf /hadoop/hdfs       
rm -rf /kafka-logs    
rm -rf /etc/storm-slider-client  
```

## 7.重启服务器
在 **所有节点** 上执行：
```shell
systemctl reboot
```