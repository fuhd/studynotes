Azkaban安装配置
================================================================================
## 1.下载Azkaban源代码
从 [azkaban的github](https://github.com/azkaban/azkaban) 下载源代码。这里最新稳定版本
为：**azkaban-3.57.0.tar.gz**

## 2.解压缩Azkaban源代码包
```shell
tar -xzvf azkaban-3.57.0.tar.gz
```

## 3.从源构建
**前提条件：你已经安装了java与gradle，目前我已经在自己的Ubuntu上安装了Java与Gradle**。
```shell
# 清理并编译
./gradlew clean build -x test
# 安装发行版
./gradlew installDist
```
```
编译出错的问题

如果在编译过程中出现：Could not find Linker 'g++' in system path，请执行如下命令：
sudo apt install g++ -y
```

## 4.将其中三个tar.gz包复制到目标主机 
```
注意：目标主机都要安装JAVA
```
3个生成的压缩包分别放在如下位置：
```
./azkaban-web-server/build/distributions/azkaban-web-server-0.1.0-SNAPSHOT.tar.gz
./azkaban-db/build/distributions/azkaban-db-0.1.0-SNAPSHOT.tar.gz
./azkaban-exec-server/build/distributions/azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz
```
把它们copy出来，放到目标主机上（比如：`server[01-04].tythin.com`）。`server01.tythin.com`
用来旋置`azkaban-web-server-0.1.0-SNAPSHOT.tar.gz`；`server02.tythin.com`放置
`azkaban-db-0.1.0-SNAPSHOT.tar.gz`（因为mysql数据库在该主机上）、
`azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz`；`server[03-04].tythin.com`用来放置`azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz`。

## 5.解压缩3个构建文件
```shell
tar -xzvf azkaban-web-server-0.1.0-SNAPSHOT.tar.gz -C /opt
tar -xzvf azkaban-db-0.1.0-SNAPSHOT.tar.gz -C /opt
tar -xzvf azkaban-exec-server-0.1.0-SNAPSHOT.tar.gz -C /opt
```

## 6.安装MySQL数据库
略

## 6.创建MySQL数据库

### 6.1.创建库与用户
使用管理员帐号登录到MySQL。
```sql
--创建数据库
CREATE DATABASE azkaban;
--创建用户并授权（azkaban/MyPass99@）
CREATE USER 'azkaban'@'%' IDENTIFIED BY 'MyPass99@';
GRANT SELECT,INSERT,UPDATE,DELETE ON azkaban.* to 'azkaban'@'%' WITH GRANT OPTION;
```
### 6.2.配置MySQL
停止MySQL服务：
```shell
systemctl stop mysqld
```
修改`/etc/my.cnf`配置文件，添加以下内容： 
```ini
[mysqld]
...
max_allowed_packet=1024M
```
重启MySQL服务：
```shell
systemctl start mysqld
```

## 7.创建Azkaban的数据库表
使用管理员帐号登录到MySQL，执行如下命令：
```sql 
use azkaban;
source /opt/azkaban-db-0.1.0-SNAPSHOT/create-all-sql-0.1.0-SNAPSHOT.sql;
```

## 8.编辑Azkaban Executor Server的配置
在`server[02-04].tythin.com`的`/opt/azkaban-exec-server-0.1.0-SNAPSHOT/conf`目录下
修改`azkaban.properties`配置文件：
```ini
azkaban.name=Tx01
azkaban.label=Tythin
azkaban.webserver.url=http://server01.tythin.com:8081

mysql.host=server02.tythin.com
mysql.database=azkaban
mysql.user=azkaban
mysql.password=MyPass99@
```

## 9.运行并激活azkaban-exec-server
在`server[02-04].tythin.com`的`/opt/azkaban-exec-server-0.1.0-SNAPSHOT`目录下
执行：
```shell
./bin/start-exec.sh
```
然后激活：
```shell
# 注意：每次启动azkaban-exec-server服务后，都要执行激活命令
curl -G "localhost:$(<./executor.port)/executor?action=activate" && echo
```

## 10.配置Azkaban Web服务器
在`server01.tythin.com`主机上，进入：
```shell
cd /opt/azkaban-web-server-0.1.0-SNAPSHOT/conf
```
修改配置文件：`zkaban.properties`：
```ini
azkaban.name=Tx01
azkaban.label=Tythin

mysql.host=server02.tythin.com
mysql.database=azkaban
mysql.user=azkaban
mysql.password=MyPass99@
```

## 11.运行Azkaban Web服务器
在`server01.tythin.com`主机上，进入：
```shell
cd /opt/azkaban-web-server-0.1.0-SNAPSHOT
```
运行命令：
```shell
./bin/start-web.sh
```

## 12.登录Azkaban
http://10.10.26.31:8081/ 
```
10.10.26.31是server01.tythin.com
默认登录帐号：azkaban/azkaban
```


