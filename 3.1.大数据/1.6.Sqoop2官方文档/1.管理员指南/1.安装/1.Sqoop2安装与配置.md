Sqoop2安装与配置
=================================================================================
Sqoop安装包包含两部分：**client**与 **server**。
+ **Server**：你需要在Hadoop集群的单个节点上安装服务端，此节点将作为所有Sqoop客户端的入口。
+ **Client**：客户端可以安装在任意数量的机器上。

### 服务端配置
将Sqoop安装包复制到你想要运行Sqoop服务器的机器上。**Sqoop服务器作为Hadoop客户端，因此Hadoop库（
Yarn，MapReduce和HDFS jar文件）和配置文件（core-site.xml，mapred-site.xml，...）必须在此
节点上可用**。

你应该确认Hadoop可用：
```shell
su - hadoop
$ hadoop fs -ls /
```

#### 1.Hadoop依赖
**Sqoop服务器** 需要以下 **环境变量** 指向Hadoop库———— **$HADOOP_COMMON_HOME，$HADOOP_HDFS_HOME，
$HADOOP_MAPRED_HOME和$HADOOP_YARN_HOME**，你要确保这些变量已定义并指向有效的Hadoop安装。如果
找不到Hadoop库,Sqoop服务端将无法启动。

Sqoop服务器使用环境变量来查找Hadoop库。**如果设置了环境变量$HADOOP_HOME**，Sqoop将在以下位置查找jar：
**$HADOOP_HOME/share/hadoop/common，$HADOOP_HOME/share/hadoop/hdfs，$HADOOP_HOME/share/hadoop/mapreduce
和$HADOOP_HOME/share/hadoop/yarn**。你可以指定Sqoop服务器在$HADOOP_COMMON_HOME，$HADOOP_HDFS_HOME，
$HADOOP_MAPRED_HOME和$HADOOP_YARN_HOME环境变量中查找common、hdfs、mapreduce和yarn的jar包。
```shell
# 设置A
export HADOOP_HOME=/...

# 设置B，与A二选一
export HADOOP_COMMON_HOME=/...
export HADOOP_HDFS_HOME=/...
export HADOOP_MAPRED_HOME=/...
export HADOOP_YARN_HOME=/...
```
```
注意：
如果设置了环境变量$HADOOP_HOME，Sqoop将使用以下位置：
  $HADOOP_HOME/share/hadoop/common
  $HADOOP_HOME/share/hadoop/hdfs
  $HADOOP_HOME/share/hadoop/mapreduce
  $HADOOP_HOME/share/Hadoop/yarn
```

#### 2.Hadoop配置
Sqoop服务器将需要 **模拟用户访问集群内外的HDFS和其他资源**，而不是作为开始交付作业的用户，也不是运
行服务器的用户。你需要将Hadoop配置为 **可通过代理用户** 访问系统。你需要在 **core-site.xml** 文件
中创建两个属性——**hadoop.proxyuser.$SERVER_USER.hosts** 和 **hadoop.proxyuser.$SERVER_USER.groups**，
其中 **$SERVER_USER是将运行Sqoop2服务的用户**。在大多数情况下，配置 **＊** 就足够了。

示例，在 **sqoop2用户** 下运行服务器，需要在core-site.xml中配置：
```xml
<property>
    <name>hadoop.proxyuser.sqoop2.hosts</name>
    <value>*</value>
</property>
<property>
    <name>hadoop.proxyuser.sqoop2.groups</name>
    <value>*</value>
</property>
```
**如果你在一个系统用户下运行Sqoop2服务器（默认情况下ID小于min.user.id - 1000的用户），那么YARN将默认
拒绝运行Sqoop2作业。你需要将运行Sqoop2服务端的用户名（很有可能就是sqoop2用户）添加到container-executor.cfg
的allowed.system.users属性中**。

示例，在sqoop2用户下运行服务器，需要在container-executor.cfg文件中添加如下：
```ini
allowed.system.users=sqoop2
```

#### 3.第三方jar包
要将任何第三方jar文件加入到Sqoop服务器类路径中，请在文件系统上的任意位置创建一个目录，并将其位置
export到 **$SQOOP_SERVER_EXTRA_LIB** 变量中。
```shell
# Create directory for extra jars
$ mkdir -p /var/lib/sqoop2/

# Copy all your JDBC drivers to this directory
$ cp mysql-jdbc*.jar /var/lib/sqoop2/
$ cp postgresql-jdbc*.jar /var/lib/sqoop2/
```
**配置环境变量**：
```shell
# And finally export this directory to SQOOP_SERVER_EXTRA_LIB
export SQOOP_SERVER_EXTRA_LIB=/var/lib/sqoop2/
```
```
注意：
因为licenses不兼容的原因，Sqoop不附带任何JDBC驱动程序，你将需要使用上述机制自己添加JDBC驱动程序。
```

#### 4.配置PATH
面向所有用户和管理员的 **shell命令** 都存储在 **$SQOOP_HOME/bin** 目录中，建议将此目录添加到$PATH中，
以便于执行。例如：
```
import PATH=$PATH:$SQOOP_HOME/bin
```

#### 5.配置服务端
**服务器配置文件存储在conf目录中**。文件 **sqoop_bootstrap.properties** 指定应该使用哪个配置提供
程序来为Sqoop服务器的其余部分加载配置。**默认值为：PropertiesConfigurationProvider** 应该足够了。

第二个名为 **sqoop.properties** 的配置文件包含可能影响Sqoop服务器的其余配置属性。在大多数情况下，
默认或者很少的调整就足够了。

#### 6.存储库初始化
首次启动Sqoop2服务器之前，需要 **初始化元数据存储库**。使用Upgrade工具初始化存储库：
```shell
$ sqoop2-tool upgrade
```
你可以使用Verify工具 **验证是否所有内容都已正确配置**：
```shell
$ sqoop2-tool verify
```

#### 7.服务生命周期
安装并配置后，你可以使用下面命令 **启动Sqoop服务器**：
```shell
$ sqoop2-server start
```
**注：为什么我启动命令必须在$SQOOP_HOME/server/lib目录执行，通过sqoop2-shell客户端才能正确把mysql数据导入hdfs????**

你可以使用下面的命令 **停止服务器**：
```shell
$ sqoop2-server stop
```
**默认情况下，Sqoop服务守护进程使用端口12000**。你可以在配置文件 **conf/sqoop.properties** 中设置
**org.apache.sqoop.jetty.port** 以使用不同的端口。


### 客户端配置
只需要将Sqoop发布包复制到目标机器上，然后将其解压到所需的位置即可。你可以使用以下命令启动客户端：
```shell
$ sqoop2-shell
```
```
注意：
Sqoop客户端不是一个Hadoop客户端，因此你不需要在具有Hadoop库和配置文件的节点上进行安装。
```
