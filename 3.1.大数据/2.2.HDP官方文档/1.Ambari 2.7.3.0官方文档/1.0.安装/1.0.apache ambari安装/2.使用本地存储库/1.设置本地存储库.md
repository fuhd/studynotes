设置本地存储库
================================================================================
根据您的Internet访问权限，选择以下选项之一：
+ **不能访问网络**：此选项涉及下载存储库tarball，将tarball移动到集群中的选定镜像服务器，以及
解压缩tarball以创建
存储库。
+ **临时上网**：此选项涉及使用临时Internet访问将软件包同步（使用重新同步）到所选镜像服务器以创
建存储库。

两种选择都以类似，直接的方式进行。为每个选项设置会产生一些关键差异，如以下部分所述：
+ 准备设置本地存储库；
+ 设置无Internet访问的本地存储库；
+ 使用临时Internet访问设置本地存储库；

## 1.准备设置本地存储库
在设置本地存储库之前，您必须满足某些要求：
+ 选择运行支持的操作系统的群集中可访问的现有服务器；
+ 启用从群集中的所有主机到镜像服务器的网络访问；
+ 确保镜像服务器安装了包管理器，例如yum（用于RHEL、CentOS、Oracle或Amazon Linux），zypper
（用于SLES）或apt-get（用于Debian和Ubuntu）。
+ **可选**：如果您的存储库具有临时Internet访问权限，并且您使用的是RHEL、CentOS、Oracle或
Amazon Linux作为您的操作系统，安装了yum实用程序：
    ```shell
    yum install yum-utils createrepo
    ```

满足这些要求后，您可以采取措施准备设置本地库。

### 第一步
1. 创建HTTP服务器
    + 在镜像服务器上，使用安装HTTP服务器（例如Apache httpd），Apache社区网站上提供有说明。
    + 启动服务器。
    + 确保所有防火墙设置都允许从群集节点到镜像服务器的入站HTTP访问。
        ```
        提示

        如果您使用的是Amazon EC2，请确保已禁用SELinux。
        ```
2. 在镜像服务器上，为Web服务器创建一个目录。
    + 例如，从shell窗口中键入（**RHEL/CentOS/Oracle/Amazon Linux**）：
        ```shell
        mkdir -p /var/www/html/
        ```
    + 如果您使用的是符号链接，请在Web服务器上启用followymlinks。

### 下一步
接下来，您必须设置本地存储库，无论是无Internet访问还是临时Internet访问。

## 2.使用临时Internet访问设置本地存储库

### 先决条件
您必须已完成“设置本地存储库”过程。

### 步骤
要完成本地存储库的设置，请完成以下操作：
1. 在主机上安装Ambari和Stack的存储库配置文件。
2. 确认存储库可用性（**RHEL、CentOS、Oracle、Amazon Linux**）
    ```shell
    yum repolist
    ```
3. 将存储库内容同步到镜像服务器：
    + 浏览到Web服务器目录（**RHEL、CentOS、Oracle、Amazon Linux**）：
        ```shell
        cd /var/www/html
        ```
    + 对于Ambari，创建ambari目录并重新同步：
        ```shell
        mkdir -p ambari/<OS>
        cd ambari/<OS>
        reposync -r Updates-Ambari-2.7.3.0
        ```
        在此语法中，<OS>的值为amazonlinux2、centos7、sles12、ubuntu14、ubuntu16、ubuntu18
        或debian9。
        ```
        重要

        由于Debian 9 reposync版本1.1.31-2中的已知问题，我们在Debian 9主机上工作时，建议使用reposync版本11.3.1-3
        或更高版本。
        ```
    + 对于Hortonworks Data Platform（HDP）堆栈存储库，请创建hdp目录并重新同步：
        ```shell
        mkdir -p hdp/<OS>
        cd hdp/<OS>
        reposync -r HDP-<latest.version>
        reposync -r HDP-UTILS-<version>
        ```
    + 对于HDF堆栈存储库，请创建hdf目录并重新同步：
        ```shell
        mkdir -p hdf/<OS>
        cd hdf/<OS>
        reposync -r HDF-<latest.version>
        ```
4. 生成存储库元数据：
    + 对于Ambari：
        ```shell
        createrepo <web.server.directory>/ambari/<OS>/Updates-Ambari-2.7.3.0
        ```
    + 对于HDP堆栈存储库：
        ```shell
        createrepo <web.server.directory>/hdp/<OS>/HDP-<latest.version>
        ```
    + 对于HDF堆栈存储库：
        ```shell
        createrepo <web.server.directory>/hdf/<OS>/HDF-<latest.version>
        ```
5. 确认您可以浏览到新创建的存储库：
    + **Ambari Base URL**：`http://<web.server>/ambari/<OS>/Updates-Ambari-2.7.3.0`
    + **HDF Base URL**：`http://<web.server>/hdf/<OS>/HDF-<latest.version>`
    + **HDP Base URL**： `http://<web.server>/hdp/<OS>/HDP-<latest.version>`
    + **HDP-UTILS Base URL**：` http://<web.server>/hdp/<OS>/HDP-UTILS-<version>`

**哪里**：
+ `<web.server>`：Web服务器主机的FQDN
+ `<version>`：Hortonworks堆栈版本号
+ `<OS>`：centos7、sles12、ubuntu14、ubuntu16、ubuntu18、debian9
    ```
    重要

    请务必记录这些基本URL。安装Ambari和Cluster时，您将需要它们。
    ```
6. **可选的**。如果在您的环境中配置了多个存储库，请在群集中的所有节点上部署以下插件。
    + 安装插件（**RHEL/CentOS/Oracle7/**）：
        ```shell
        yum install yum-plugin-priorities
        ```
    + 编辑`/etc/yum/pluginconf.d/priorities.conf`文件以添加以下内容：
        ```ini
        [main]
        enabled=1
        gpgcheck=0
        ```

## 3.设置无Internet访问的本地存储库

### 先决条件
您必须已完成“设置本地存储库”过程。

### 步骤
要完成本地存储库的设置，请完成以下操作：
1. 获取要创建的存储库的压缩存档文件（tarball）。
2. 将存储库tarball复制到Web服务器目录并解压缩档案：
    + 浏览到您创建的Web服务器目录（**RHEL/CentOS/Oracle/Amazon Linux**）：
        ```shell
        cd /var/www/html/
        ```
    + 解压缩存储库tarball并将文件移动到以下位置，其中`<web.server>`、`<web.server.directory>`、
    `<OS>`、`<version>`和`<latest.version>`表示名称、主目录、操作系统类型、版本和最新发行
    版本分别为：
        - Ambari存储库：在`<web.server.directory>`下解压缩。
        - HDF堆栈存储库：创建一个目录并在`<web.server.directory>/hdf`下解压缩。
        - HDP堆栈存储库：创建一个目录并在`<web.server.directory>/hdp`下解压缩。
3. 确认您可以浏览到新创建的本地存储库，其中`<web.server>`、`<web.server.directory>`、`<OS>`、
`<version>`和`<latest.version>`表示名称、主目录、操作系统型、版本和最新发行版本分别为：
    + Ambari Base URL：`http://<web.server>/Ambari-2.7.3.0/<OS>`
    + HDF Base URL：`http://<web.server>/hdf/HDF/<OS>/3.x/updates/<latest.version>`
    + HDP Base URL：`http://<web.server>/hdp/HDP/<OS>/3.x/updates/<latest.version>`
    + HDP-UTILS Base URL：`http://<web.server>/hdp/HDP-UTILS-<version>/repos/<OS>`
    ```
    重要

    请务必记录这些基本URL。安装时你会需要它们Ambari和集群。
    ```




































dd
