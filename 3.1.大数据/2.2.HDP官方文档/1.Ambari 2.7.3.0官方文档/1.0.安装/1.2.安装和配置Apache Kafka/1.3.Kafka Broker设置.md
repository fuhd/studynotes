Kafka Broker设置
================================================================================
以下小节介绍了影响Kafka brokers性能的配置设置。

## 1.连接设置
查看高级kafka-broker类别中的以下连接设置，并根据需要进行修改：

| 属性 | 描述 |
| :------------- | :------------- |
| zookeeper.session.timeout.ms | 指定ZooKeeper会话超时，以毫秒为单位。默认值为30000毫秒；如果服务器在这段时间内未能向ZooKeeper发出心跳信号，则认为该服务器已经死机。如果将此值设置得太低，则可能会错误地将服务器视为已死，如果你设置得太高，可能需要很长时间才能识别真正死机的服务器；如果您发现频繁断开与ZooKeeper服务器的连接，请查看此设置。如果长时间的垃圾收集暂停导致Kafka丢失其ZooKeeper会话，则可能需要配置更长的超时值。|
| advertised.listeners | 如果已手动将侦听器设置为`advertised.listeners = PLAINTEXT://$HOSTNAME:$PORT`，则在启用Kerberos后，将侦听器配置更改为`advertised.listeners = SASL_PLAINTEXT://$HOSTNAME:$PORT`。 |

```
重要：

请勿更改以下连接设置.
zookeeper.connect : 逗号分隔的ZooKeeper <主机名:端口>对列表。Ambari设定了这个值。请勿更改此设置。
```

## 2.Topic设置
对于每个主题，Kafka都维护一个带有一个或多个分区的结构化提交日志。这些主题分区构成了Kafka的基本
并行单元。通常，Kafka群集中的分区越多，可以添加的并行消费者越多，从而导致更高的吞吐量。

您可以根据吞吐量要求计算分区数。如果从生产者到单个分区的吞吐量为`P`，并且从单个分区到使用者的吞吐
量为`C`，并且如果目标吞吐量为`T`，则所需分区的最小数量为：
```
max(T/P,T/C)
```
另请注意，**更多分区可能会增加延迟**：
+ Kafka中的端到端延迟定义为从生成器发布消息到消费者读取消息的时间差。
+ 将消息复制到所有同步副本后，Kafka只有在消费者提交后才向消费者公开消息。
+ 从一个broker到另一个broker的一千个分区的复制可能需要20ms。这对于某些实时应用来说太长了。
+ 在新的Kafka生产者中，消息在生产者一方积累；生产者缓冲每个分区的消息。此方法允许用户设置用于缓
冲传入消息的内存量的上限。累积足够的数据或经过足够的时间后，累积的消息将被删除并发送给broker。如
果定义了更多分区，则会在生产者端为更多分区累积消息。
+ 类似地，消费者每个分区获取批量消息。消费者内存要求与消费者订阅的分区数成正比。

**重要Topic题属性**

查看高级`kafka-broker`类别中的以下设置，并根据需要进行修改：

| 属性 | 描述 |
| :------------- | :------------- |
| auto.create.topics.enable | 启用在服务器上自动创建主题。如果此属性设置为true，则尝试生成，使用或获取不存在主题的元数据会自动创建具有默认复制因子和分区数的主题。默认设置已启用。 |
| default.replication.factor | 指定自动创建的主题的默认复制因子。对于高可用性生产系统，应将此值设置为至少3。|
| num.partitions | 为自动创建的主题指定每个主题的默认日志分区数。默认值为1。根据与主题和分区设计相关的要求更改此设置。 |
| delete.topic.enable | 允许用户使用管理工具从Kafka中删除`Kafka 0.9`及更高版本的主题。果关闭此设置，则通过管理工具删除主题将不起作用。默认情况下，此功能处于关闭状态（设置为false）。|

## 3.日志设置
查看Kafka Broker类别中的以下设置，并根据需要进行修改：

| 属性 | 描述 |
| :------------- | :------------- |
| log.roll.hours | 推出新日志段之前的最长时间（以小时为单位）。默认值为168小时（七天）。此设置控制Kafka强制日志滚动的时间段，即使段文件未满。这可确保保留过程能够删除或压缩旧数据。|
| log.retention.hours | 在删除日志文件之前保留日志文件的小时数。默认值为168小时（七天）。设置此值时，请考虑您的磁盘空间以及您希望消息可用的时间。活跃的消费者可以快速阅读并将消息传递到目的地。保留设置越高，数据保留的时间越长。较高的设置会生成较大的日志文件，因此增加此设置可能会降低整体存储容量。|
| log.dirs | 以逗号分隔的目录列表，其中保存了日志数据。如果您有多个磁盘，请列出每个磁盘下的所有目录。|





































dd
