为LDAP/AD设置Hadoop组映射
================================================================================
要确保在Hadoop中强制执行LDAP/AD组级别授权，您应该为LDAP/AD设置Hadoop组映射。

## 在你开始之前
您必须有权访问LDAP和连接详细信息。请注意，LDAP设置可能会有所不同，具体取决于您使用的LDAP实现。

## 关于这个任务
有三种方法可以设置Hadoop组映射：
+ 使用SSSD（推荐）
+ 在Linux环境中手动创建用户和组
+ 在core-site.xml中

## 步骤
+ 使用SSSD（推荐）

  组映射的推荐方法是使用SSSD或以下服务之一将Linux OS与LDAP连接：
  - Centrify
  - NSLCD
  - Winbind
  - SAMBA

  请注意，大多数这些服务不仅允许您查找用户并枚举其组，还允许您在主机上执行其他操作。Hadoop上的
  LDAP组映射不需要这些功能 - 所需要的只是在LDAP中查找（或“验证”）用户并枚举其组的能力。因此，
  在评估这些服务时，请花些时间了解NSS模块（执行用户/组解析）和PAM模块（执行用户身份验证）之间的
  区别。NSS是必需的。PAM不是必需的，可能代表安全风险。

+ 在Linux环境中手动创建用户和组：在Linux环境中手动创建用户和组（请参阅下面的链接）。
+ 在core-site.xml中，配置要使用的Hadoop基于LDAP的组映射：
    1. 将以下示例中显示的属性添加到core-site.xml文件中。您需要提供绑定用户的值，绑定密码以及
    特定于LDAP实例的其他属性，并确保对象类，用户和组筛选器与LDAP实例中指定的值匹配。
        ```xml
        <property>
            <name>hadoop.security.group.mapping</name>
            <value>org.apache.hadoop.security.LdapGroupsMapping</value>
        </property>
        <property>
            <name>hadoop.security.group.mapping.ldap.bind.user</name>
            <value>cn=Manager,dc=hadoop,dc=apache,dc=org</value>
        </property>
        <!–
        <property>
            <name>hadoop.security.group.mapping.ldap.bind.password.file</name>
            <value>/etc/hadoop/conf/ldap-conn-pass.txt</value>
        </property>
        –>
        <property>
            <name>hadoop.security.group.mapping.ldap.bind.password</name>
            <value>hadoop</value>
        </property>
        <property>
            <name>hadoop.security.group.mapping.ldap.url</name>
            <value>ldap://localhost:389/</value>
        </property>
        <property>
            <name>hadoop.security.group.mapping.ldap.base</name>
            <value></value>
        </property>
        <property>
            <name>hadoop.security.group.mapping.ldap.search.filter.user</name>
            <value>(&amp;(|(objectclass=person)(objectclass=applicationProcess))(cn={0}))</value>
        </property>
        <property>
            <name>hadoop.security.group.mapping.ldap.search.filter.group</name>
            <value>(objectclass=groupOfNames)</value>
        </property>
        <property>
            <name>hadoop.security.group.mapping.ldap.search.attr.member</name>
            <value>member</value>
        </property>
        <property>
            <name>hadoop.security.group.mapping.ldap.search.attr.group.name</name>
            <value>cn</value>
        </property>
        ```
    2. 根据您的配置，您可以使用以下HDFS和YARN命令刷新用户和组映射：
        ```shell
        hdfs dfsadmin -refreshUserToGroupsMappings
        yarn rmadmin -refreshUserToGroupsMappings
        ```
    3. 通过运行`hdfs groups`命令验证LDAP组映射。此命令将从LDAP获取当前用户的组。请注意，配置
    LDAP组映射后，HDFS权限可以利用LDAP中定义的组进行访问控制。

## 相关信息
+ [手动创建用户和组](https://www.linode.com/docs/tools-reference/linux-users-and-groups/)
+ [SSSD](https://fedoraproject.org/wiki/Features/SSSD)
