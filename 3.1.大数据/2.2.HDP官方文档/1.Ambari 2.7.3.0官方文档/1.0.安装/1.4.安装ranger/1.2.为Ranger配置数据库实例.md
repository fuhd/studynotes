为Ranger配置数据库实例
================================================================================
数据库实例必须正在运行并且可供Ranger使用。您可以为此配置MySQL，Oracle，PostgreSQL或Amazon RDS。
+ MySQL，Oracle，PostgreSQL或Amazon RDS数据库实例必须正在运行并且可供Ranger使用。Ranger
安装将创建两个新用户（默认名称：rangeradmin和rangerlogger）和两个新数据库（默认名称：ranger
和ranger_audit）。
+ 对于Ranger支持的一些数据库，以下部分介绍了Ranger的数据库实例的配置。
    - MySQL
    - PostgreSQL
    - Oracle
    - AmazonRDS
+ 如果您选择不向Ambari Ranger安装程序提供系统数据库管理员（DBA）帐户详细信息，则可以使用
`dba_script.py`Python脚本创建Ranger DB数据库用户，而不会将DBA帐户信息暴露给Ambari Ranger
安装程序。然后，您可以运行正常的Ambari Ranger安装，而无需指定DBA用户名和密码。有关详细信息，请
参阅“在不共享DBA凭据的情况下设置数据库用户”。

## 配置Ranger DB：MySQL/MariaDB
如何为Ranger配置MySQL数据库实例。

### 在你开始之前
MySQL/Oracle/PostgreSQL/Amazon RDS数据库实例必须正在运行并且可供Ranger使用。

使用MySQL时，用于Ranger管理策略存储表的存储引擎必须支持事务。**InnoDB是支持事务的引擎示例**。
不支持事务的存储引擎不适合作为策略存储。

如果您使用的是Amazon RDS，请参阅“为Ranger配置Amazon RDS数据库实例：先决条件”。

### 步骤
1. 应使用MySQL数据库管理员创建Ranger数据库。以下一系列命令可用于创建密码为：*rangerdba* 的
**rangerdba** 用户。
    1. 以root用户身份登录，然后使用以下命令创建rangerdba用户并授予其足够的权限。
        ```sql
        CREATE USER 'rangerdba'@'localhost' IDENTIFIED BY 'rangerdba';
        GRANT ALL PRIVILEGES ON *.* TO 'rangerdba'@'localhost';
        CREATE USER 'rangerdba'@'%' IDENTIFIED BY 'rangerdba';
        GRANT ALL PRIVILEGES ON *.* TO 'rangerdba'@'%';
        GRANT ALL PRIVILEGES ON *.* TO 'rangerdba'@'localhost' WITH GRANT OPTION;
        GRANT ALL PRIVILEGES ON *.* TO 'rangerdba'@'%' WITH GRANT OPTION;
        FLUSH PRIVILEGES;
        ```
2. 使用exit命令退出MySQL。
3. 您现在应该能够使用以下命令以rangerdba重新连接到数据库：`mysql -u rangerdba -prangerdba`。
4. 测试rangerdba登录后，使用exit命令退出MySQL。
5. 确认`mysql-connector-java.jar`文件位于Java共享目录中。必须在安装Ambari服务器的服务器上
运行此命令：`ls /usr/share/java/mysql-connector-java.jar`。如果文件不在Java共享目录中，
请使用以下命令安装MySQL连接器`.jar`文件：
    ```shell
    #RHEL/CentOS/Oracle Linux
    yum install mysql-connector-java*
    ```
6. 根据MySQL JDBC驱动程序`.jar`文件的位置设置jdbc/driver/path。必须在安装Ambari服务器的服
务器上运行此命令：
    ```shell
    ambari-server setup --jdbc-db = {database-type} --jdbc-driver = {/jdbc/driver/path}
    ```
