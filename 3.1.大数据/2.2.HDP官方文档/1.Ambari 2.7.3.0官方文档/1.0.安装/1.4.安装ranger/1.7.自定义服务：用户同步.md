自定义服务：用户同步
================================================================================
如何在通过Ambari安装Ranger时为UNIX或LDAP/AD自定义Ranger用户同步。

## 关于这个任务
您可以为Unix或LDAP/AD自定义用户同步。

## 在你开始之前
测试运行用户同步。在提交用户同步更改之前，建议您测试运行正在检索的用户和组如预期。

在提交更改之前，测试运行将用户和组数据加载到Ranger：
1. 设置`ranger.usersync.policymanager.mockrun=true`。此参数可在 *Ambari > Ranger > 
Configs > Advanced > Advanced ranger-ugsync-site* 中找到。
2. 查看将加载到Ranger的用户和组：`tail -f /var/log/ranger/usersync/usersync.log`。
3. 确认按预期检索用户和组后，设置`ranger.usersync.policymanager.mockrun=false`并重新启动
Ranger Usersync。这会将usersync日志中显示的用户同步到Ranger数据库。

## 步骤
+ 自定义UNIX的用户同步：
    1. 在“自定义服务”页面上，选择“Ranger用户信息”选项卡。
    2. 单击启用用户同步下的“是”。
    3. 使用“同步源”下拉列表选择“UNIX”，然后设置以下属性。

        表6：UNIX用户同步属性：

        | 属性 | 描述 | 默认值 |
        |:----- | :----- | :----- |
        | Sync Source | 仅同步超过此用户ID的用户。 | 500 |
        | Password File | 密码文件在Linux服务器上的位置。| /etc/passwd |
        | Group File | 组文件在Linux服务器上的位置。| /etc/group |

        ![unix用户同步属性](img/13.png)
    
    4. `/etc/shadow`的权限必须设置为444。

+ 自定义LDAP/AD的用户同步：
    1. 在“自定义服务”页面上，选择“Ranger用户信息”选项卡。
    2. 单击启用用户同步下的“是”。
    3. 使用“同步源”下拉列表选择“LDAP/AD”。
    4. 在Common Configs选项卡上设置以下属性。

        表7：LDAP/AD公共配置：

        | 属性 | 描述 | 默认值 | 样本值 |
        |:----- |:----- |:----- |:----- |
        | LDAP/AD URL | 根据LDAP/AD同步源添加URL | ldap://{host}:{port} | ldap://ldap.example.com:389 |


