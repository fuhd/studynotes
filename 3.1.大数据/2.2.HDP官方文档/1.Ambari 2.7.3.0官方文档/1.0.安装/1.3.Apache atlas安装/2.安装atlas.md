安装atlas
================================================================================
您可以使用Apache Atlas通过一组可扩展的核心 **数据治理服务** 有效地满足您的合规性要求。

在你开始之前：
+ `Ambari Infra`（包括内部`HDP Solr Cloud`实例）或外部管理的`Solr Cloud`实例
+ `Apache HBase`（用作Atlas Metastore）
+ `Apache Kafka`（提供持久的消息传递总线）

## 1.开始安装
使用以下步骤启动Apache Atlas安装。

### 1.1.步骤
1. 在Ambari仪表板上，单击“操作”，然后选择“添加服务”。

    ![添加服务](img/1.png)

2. 在“选择服务”页面上，选择“Atlas”，然后单击“下一步”。

    ![选择服务](img/2.png)

3. 将显示“Assign Master”页面。为`Atlas Metadata Server`指定主机，然后单击“下一步”。

    ![Atlas Metadata Server](img/3.png)

4. 将显示“Assign Slaves和客户端”页面，其中选择了客户端（Atlas元数据客户端）。 单击“下一步”
继续。

    ![Atlas元数据客户端](img/4.png)

5. 将出现“自定义服务”页面。这些设置将在下一节中介绍。

## 2.自定义服务
安装过程的下一步是在“自定义服务”页面上指定Atlas身份验证和授权设置。

### 2.1.验证设置
您可以将身份验证类型设置为文件，LDAP或AD。

#### 2.1.1.基于文件的身份验证
选择基于文件的身份验证时，`atlas.authentication.method.file.filename`属性将自动设置为
`{{conf_dir}}/users-credentials.properties`。

![基于文件的身份验证](img/5.png)

`users-credentials.properties`文件应具有以下格式：
```
username=group::sha256password
admin=ADMIN::e7cf3ef4f17c3999a94f2c6f612e8a888e5b1026878e4e19398b23bd38ec221a
```
用户组可以是`ADMIN`，`DATA_STEWARD`或`DATA_SCIENTIST`。

密码使用sha256编码方法编码，可以使用UNIX工具生成：
```shell
echo -n "Password" | sha256sum
e7cf3ef4f17c3999a94f2c6f612e8a888e5b1026878e4e19398b23bd38ec221a -
```
```
提示  

您还可以使用Ambari UI设置管理员密码：选择 `高级 > 高级atlas-env`，然后使用管理员密码和管理员用户名框设置管理员用户名
和密码。在安装后更新这些设置时，单击“保存”，然后重新启动Atlas以及需要重新启动的所有其他组件。
```

#### 2.1.2.LDAP身份验证
要启用LDAP身份验证，请选择LDAP，然后设置以下配置属性。

表1：Apache Atlas LDAP配置设置：

| 属性 | 示例值 |
| :------------- | :------------- |
| atlas.authentication.method.ldap.url | ldap://127.0.0.1:389 |
| atlas.authentication.method.ldap.userDNpattern | uid={0],ou=users,dc=example,dc=com |
| atlas.authentication.method.ldap.groupSearchBase | dc=example,dc=com |
| atlas.authentication.method.ldap.groupSearchFilter | (member=cn={0},ou=users,dc=example,dc=com |
| atlas.authentication.method.ldap.groupRoleAttribute | cn |
| atlas.authentication.method.ldap.base.dn | dc=example,dc=com |
| atlas.authentication.method.ldap.bind.dn | cn=Manager,dc=example,dc=com |
| atlas.authentication.method.ldap.bind.password | PassW0rd |
| atlas.authentication.method.ldap.referral | ignore |
| atlas.authentication.method.ldap.user.searchfilter | (uid={0}) |
| atlas.authentication.method.ldap.default.role | ROLE_USER |

![LDAP身份验证](img/6.png)

#### 2.1.3.AD身份验证
要启用AD身份验证，请选择AD，然后设置以下配置属性：

| 属性 | 示例值 |
| :------------- | :------------- |
| atlas.authentication.method.ldap.ad.url | ldap://127.0.0.1:389 |
| Domain Name (Only for AD) | example.com |
| atlas.authentication.method.ldap.ad.base.dn | DC=example,DC=com |
| atlas.authentication.method.ldap.ad.bind.dn | CN=Administrator,CN=Users,DC=example,DC=com |
| atlas.authentication.method.ldap.ad.bind.password | PassW0rd |
| atlas.authentication.method.ldap.ad.referral | ignore |
| atlas.authentication.method.ldap.ad.user.searchfilter | (sAMAccountName={0}) |
| atlas.authentication.method.ldap.ad.default.role | ROLE_USER |

![AD身份验证](img/7.png)

### 2.2.授权设置
Atlas有两种授权方法：**Simple** 和 **Ranger**。

#### 2.2.1.Simple授权
默认设置为“Simple”，并在“高级”选项卡上的“高级应用程序属性”下自动设置以下属性。

表3：Apache Atlas简单授权

| 属性 | 值 |
| :------------- | :------------- |
| atlas.authorizer.impl | simple |
| atlas.auth.policy.file | {{conf_dir}}/policy-store.txt |

![简单授权](img/8.png)

`policy-store.txt`文件具有以下格式：
```
Policy_Name;;User_Name:Operations_Allowed;;Group_Name:Operations_Allowed;;Resource_Type
```
例如：
```
adminPolicy;;admin:rwud;;ROLE_ADMIN:rwud;;type:*,entity:*,operation:*,taxonomy:*,term:*
userReadPolicy;;readUser1:r,readUser2:r;;DATA_SCIENTIST:r;;type:*,entity:*,operation:*,t
userWritePolicy;;writeUser1:rwu,writeUser2:rwu;;BUSINESS_GROUP:rwu,DATA_STEWARD:rwud;;ty
```
在此示例中，readUser1，readUser2，writeUser1和writeUser2是用户ID，每个用户ID都具有相应的
访问权限。User_Name，Group_Name和Operations_Allowed是以逗号分隔的列表。

授权者资源类型：
+ Operation
+ Type
+ Entity
+ Taxonomy
+ Term
+ Unknown

Operations_Allowed是`r = read`，`w = write`，`u = update`，`d = delete`

#### 2.2.2.Ranger授权
通过在Ambari中启用Ranger Atlas插件来激活Ranger授权。

启用Atlas Ranger插件:
[启用Atlas Ranger插件](https://docs.hortonworks.com/HDPDocuments/HDP3/HDP-3.1.0/installing-ranger/content/ranger_install_ranger_plugin_settings.html)



























dd
