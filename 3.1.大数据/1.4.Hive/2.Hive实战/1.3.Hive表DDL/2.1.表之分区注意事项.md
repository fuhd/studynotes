表之分区注意事项
===================================================================================
**Hive分区对于非常特别的查询子集而言可以改进其性能，可以对不需要检索查询结果的分区进行剪枝**。
这个过程叫作 **分区消除**。分区也是一种支持用户 **在HDFS上以更加分片化的方式组织数据的方式**，
这样可以 **改进可维护性**。如果数据被分割存放在若干子目录下，你既可以将各分区指向各子目录，
也可以采用 **递归分区** 使一个表访问所有子目录。如果你的子目录无法满足这两个选项中的任何一个，
那么就会出现错误或者对Hive表的查询返回空数据集。

和关系数据库一样，如果使用不正确，分区也会导致性能下降。**Hive分区很重要的一点是不要过度分区。
分区会增加数据加载和数据检索的开销**。如果你创建了很多分区且每个分区中都含有很多小数据块，那
么你的文件就很可能会比较小。**在Hadoop上存放大量小文件要比存放相对较少且体量较大的文件慢得多**。
在对Hive中的表进行分区时，应遵循下面这些最佳实践：
+ 挑选一列作为分区键，其唯一值的个数应在较低值到中间值之间；
+ 避免分区小于1GB（越大越好）；
+ 当分区数量较多时，调整HiveServer2和Hive Metastore的内存；
+ 当使用多列作为分区键时，对于每一个分区键列的组合都要创建一个子目录的嵌套树。应该避免深入嵌套，
因为这会导致太多的分区，进而使创建的文件非常小；
+ 当使用Hive流处理插入数据时，如果多个会话向相同的分区写入数据，那么就会导致锁闭；
+ 你可以修改某一分区表的模式。然而，一旦结构发生改变，你就无法在已有分区中修改数据了。
+ 如果你要将数据并行插入到多个分区，应该将`hive.optimize.sort.dynamic.partition`设置
为true。


