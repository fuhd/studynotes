表之分桶的注意事项
===================================================================================
对于高效抽样和改进某些查询的性能来说，分桶是一种很好的特性；然而，它也有自己的一些限制。非对称
是真实数据最常见的问题之一，如果不能正确处理，会对分桶造成很大影响。为分桶选择正确的链也是非常
重要的。

下面是在Hive中使用分桶时应该遵循的一些最佳实践：
+ 选择唯一值的个数较多的桶键。这样会减小出现倾斜的可能性。
+ 采用质数作为桶的编号。
+ 如果桶键中的数据是倾斜的，为倾斜的值单独创建桶。这可以通过列表分桶来实现。
+ 分桶对于通常连接在一起的事实表来说非常有用。
+ 需要连接在一起的表。其桶的数目必须相同，或者一个表的桶数是另一个表的桶数的因子。
+ 要仔细选择桶的数目。一个CPU核只会对一个桶进行写入操作，因此对于一个大型集群而言，如果桶的数目
很小，则集群的利用严重不足。
+ 一旦表建好，桶的数目就不能改变了。
+ 仔细选择进行分桶的列，因为散列函数会引发倾斜。字符串散列更有这种倾向，因为通常使用的字符串子集
很小。例如，如果桶键含有`ABC789`、`ABC567`和`ABC123`三个值，但是散列算法在计算候选桶时仅仅用到
了前三个字符（`ABC`），那么最后这三个值都会在同一个桶中。
+ 你应该考虑到获取的桶文件大小至少是1GB。
+ 通过设置`hive.enforce.bucketing=TRUE`实现强制分桶。
+ 对于Map端连接，分桶表要比非分桶表的速度更快。在Map端连接中，映射器处理左侧表的某个桶时，知道右
侧表中相匹配的行在其对应的桶中，因此只需要检索该桶即可，这只是右侧表中存储的全部数据中的一小部分。
+ 分桶也允许你按照一列或多列对每个桶中的数据进行排序。这样就可以把Map端连接转换成排序-合并连接，
使速度更快。

