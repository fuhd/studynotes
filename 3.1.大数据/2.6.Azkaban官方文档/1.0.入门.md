入门
================================================================================
在`3.0`版之后，我们提供两种模式：独立“Solo服务”模式和分布式多执行器模式。以下描述了两种模式之
间的差异。

**在Solo服务模式下，数据库嵌入H2**，并且Web服务器和执行程序服务器都在同一进程中运行。如果只是
想尝试一下，这应该是有用的。它也可以用于小规模的用例。

**多执行器模式适用于最严肃的生产环境。它的DB应该由具有主从设置的MySQL实例支持。理想情况下，Web
服务器和执行程序服务器应在不同的主机中运行，以便升级和维护不应影响用户**。这种多主机设置为Azkaban
带来了强大且可扩展的方面。

+ 设置数据库
+ 配置数据库以使用多个执行程序
+ 为在数据库中配置的每个执行程序下载并安装Executor Server
+ 安装Azkaban插件
+ 安装Web服务器

以下是如何设置Azkaban的说明。

## 1.从源构建
Azkaban构建使用Gradle（使用gradlew运行时自动下载，这是Gradle包装器）并且需要 **Java8或更高
版本**。

以下命令在`Linux`，`OS X`等`* nix`平台上运行。
```shell
# Build Azkaban
./gradlew build

# Clean the build
./gradlew clean

# Build and install distributions
./gradlew installDist

# Run tests
./gradlew test

# Build without running tests
./gradlew build -x test
```
Gradle在项目目录中创建`.tar.gz`文件。例如：
`./azkaban-solo-server/build/distributions/azkaban-solo-server-0.1.0-SNAPSHOT.tar.gz`。
使用`tar -xvzf path/to/azkaban-*.tar.gz`解压缩。

## 2.Solo Server入门
Solo服务是Azkaban的独立实例，也是最简单的入门实例。Solo服务具有以下优点。
+ **易于安装** - 无需MySQL实例。它将H2打包为主要的持久存储。
+ **易于启动** - Web服务器和执行程序服务器都在同一个进程中运行。
+ **全功能** - 它包含所有Azkaban功能。您可以以正常方式使用它并为其安装插件。

### 2.1.安装
1. clone
    ```shell
    git clone https://github.com/azkaban/azkaban.git 
    ```
2. 构建Azkaban并创建安装包
    ```shell
    cd azkaban; 
    ./gradlew build installDist
    ```
3. 启动Solo服务
    ```shell
    cd azkaban-solo-server/build/install/azkaban-solo-server
    bin/start-solo.sh
    ```
    Azkaban solo服务应该全部设置，通过 **8081默认监听端口** 接受传入的网络请求。所以，打开一
    个Web浏览器并查看 http://localhost:8081/
4. 停止服务
    ```shell
    bin/shutdown-solo.sh
    ```

Solo服务安装应包含以下目录：

| 文件夹 | 描述 |
|:------ |:------ |
| bin | 启动/停止Azkaban solo服务的脚本 |
| conf | Azkaban solo服务的配置文件 |
| lib | Azkaban的jar依赖项 |
| extlib | 添加到extlib的其他jar将添加到Azkaban的类路径中 |
| plugins | 可以安装插件的目录 |
| web | Azkaban Web服务的Web（css，javascript，image）文件 |

在`conf`目录中，应该有三个文件：
+ **azkaban.private.properties** - 由Azkaban用于存储Mysql密码等
+ **azkaban.properties** - Azkaban用于运行时参数
+ **global.properties** - 作为共享属性传递给每个工作流和作业的全局静态属性。
+ **azkaban-users.xml** - 用于添加用户和角色以进行身份​​验证。如果`XmLUserManager`未设置为
使用它，则不使用此文件。

`azkaban.properties`是主配置文件。

### 2.2.配置HTTPS服务器（可选）
**默认情况下，Azkaban solo服务不使用SSL**。但您可以在独立的Web服务器中以相同的方式设置它。方
法如下：

**Azkaban Web服务支持SSL套接字连接器，这意味着密钥库必须可用**。您可以按照步骤生成
[此处](https://wiki.eclipse.org/Jetty/Howto/Configure_SSL)提供的有效jetty密钥库。创建
密钥库文件后，必须为Azkaban提供其位置和密码。**`azkaban.properties`或`azkaban.private.properties`**
（推荐），下面的属性应该被覆盖：
```ini
jetty.keystore=keystore
jetty.password=password
jetty.keypassword=password
jetty.truststore=keystore
jetty.trustpassword=password
```
**并在`azkaban.properties`中配置ssl端口**：
```ini
jetty.ssl.port=8443
```

## 3.Multi Executor Server入门

### 3.1.数据库设置
**我们建议用户选择Mysql作为Azkaban数据库**，因为我们建立了一些Mysql连接增强功能，以方便AZ设
置，并增强服务可靠性：
+ 安装Mysql
+ 设置Mysql
    - 为Azkaban创建数据库：
        ```sql
        mysql> CREATE DATABASE azkaban;
        ```
    - 为Azkaban创建一个mysql用户。例如：
        ```sql
        mysql> CREATE USER 'username'@'%' IDENTIFIED BY 'password';
        mysql> GRANT SELECT,INSERT,UPDATE,DELETE ON azkaban.* to '<username>'@'%' WITH GRANT OPTION;
        ```
    - 可能需要重新配置Mysql数据包大小。默认情况下，MySQL可能具有可笑的低允许数据包大小。要增加
    它，您需要将属性 **max_allowed_pa​​cket** 设置为更高的数字，比如 **1024M**。要在linux中
    配置它，请打开`/etc/my.cnf`。在 **mysqld之后** 的某处，添加以下内容：
        ```ini
        [mysqld]
        ...
        max_allowed_packet=1024M
        ```
        要重新启动MySQL，您可以运行：
        ```shell
        $ sudo /sbin/service mysqld restart
        ```
+ 创建Azkaban表
    从MySQL实例上的
    [最新表语句](https://github.com/azkaban/azkaban/tree/master/azkaban-db/src/main/sql)
    运行单个表创建脚本以创建表。或者，运行构建过程生成的`create-all-sql-<version>.sql`。
    `/Users/latang/LNKDRepos/azkaban/azkaban-db/build/distributions/azkaban-db-<version>`
    在您构建azkaban-db模块之后，该位置是文件所在：
    ```shell
    cd azkaban-db; ../gradlew build installDist
    ```
