维度表
================================================================================
在维度建模中，**将度量称为“事实”，将环境描述为“维度”**。维度是用于分析事实需要的多样环境。维度
所包含的表示维度的列，称为维度属性。**维度属性是查询约束条件、分组和报表标签生成的基本来源**，是
数据易用性的关键。

**维度使用主键标识其唯一性**，主键也是确保与之相连的任何事实表之间存在引用完整性的基础。主键有两
种：**代理键和自然键。代理键不具有业务含义的键，一般用于处理缓慢变化维**。自然键是具有业务含义的
键。

## 维度的基本设计方法
维度的设计过程就是确定维度性的过程。
＋ **第一步：选择维度或新建维度**。在企业级数据仓库中必须保证维度的唯一性。
＋ **第二步：确定主维表**。主维表一般是ODS表，直接与业务系统同步。
＋ **第三步：确定相关维表**。根据对业务的梳理，确定哪些表和主维表存在关联关系，并选择其中的某些
表用于生成维度属性。
＋ **第四步：确定维度属性**。本步骤主要包括两个阶段，其中第一个阶段是从主维表中选择维度属性或生
成新的维度属性；第二阶段是从相关维表中选择维度属性或生成新的维度属性。

### 确定维度属性的几点提示
1. **尽可能生成丰富的维度属性**。
2. **尽可能多地给出包括一些富有意义的文字性描述**。属性不应该是编码，而应该是真正的文字。**一般
是编码和文字同时存在**。比如商品维度中的商品ID和商品标题，ID一般用于不同表之间的关联，而名称一般
用于报表标签。
3. **区别数值型属性和事实**。数值型字段是作为事实还是维度属性，可以参考字段的一般用途。**如果通
常用于查询约束条件或分组统计，则是作为维度属性，如果通常用于参与度量的计算，则是作为事实**。
4. **尽量沉淀出通用的维度属性**。有些维度属性获取需要进行比较复杂的逻辑处理，有些需要通过多表关
联得到，或者通过单表的不同字段混合处理得到，或者通过对单表的某个字段进行解析得到。此时，需要将尽
可能多的通用的维度属性进行沉淀。一方面，可以提高下游使用的方便性，减少复杂度；另一方面可以避免下
游解析时由于各自逻辑不同而导致口径不一致。

## 维度的层次结构
**维度中的一些描述属性以层次方式或一对多的方式相互关联，可以被理解为包含连续主从关系的属性层次**。
层次的最底层代表维度中描述最低级别的详细信息，最高层代表最高级别的概要信息。维度常常有多个这样的嵌
入式层次结构。比如淘宝商品维度，有卖家、类目、品牌等。商品属于类目，类目属于行业，其中类目的最低
级别是叶子类目、叶子类目属于二级类目，二级类目属于一级类目。**在属性的层次结构中进行钻取是数据钻
取的方法之一**。类目、行业、品牌等属性层次是被实例化为多个维度，还是作为维度属性存在于商品维度中？
如何设计，我们在后面详细讨论。 

## 规范化和反规范化
**当属性层次被实例化为一系列维度，而不是单一维度时，被称为雪花模式**。大多数联机事务处理系统
（OLTP）的底层数据结构在设计时采用此种规范化技术。这种方法用在OLTP系统中可以有效避免数据冗余导
致的不一致性。比如在OLTP系统中，存在商品表和类目表，且商品表中有冗余的类目表的属性字段，假设对某
类目进行更新，则必须更新商品表和类目表，且由于商品和类目是一对多的关系，商品表可能每次需要更新几
十万甚至上百万条记录，这是不合理的。**而对于联机分析处理（OLAP）来说，数据是稳定的，不存在OLTP
系统中所存在的问题**。

**将维度的属性层次合并到单个维度中的操作称为反规范化**。分析系统的主要目的是用于数据分析和统计，
如何更方便用户进行统计分析决定了分析系统的优劣。采用雪花模式，用户在统计分析的过程中需要太量的关
联操作，使用复杂度高，同时查询性能很差；**而采用反规范化处理，则方便、易用且性能好**。

**维表一般是很不规范的。在实际应用中，几乎总是使用维表的空间来换取简明性和查询性能**。

## 一致性维度和交叉探查










