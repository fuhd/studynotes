第5步：设置Cloudera Manager数据库
================================================================================
Cloudera Manager Server包含一个脚本，可以为自己创建和配置数据库。该脚本可以：
+ 创建Cloudera Manager Server数据库配置文件。
+ （MariaDB，MySQL和PostgreSQL）创建并配置Cloudera Manager Server使用的数据库。
+ （MariaDB，MySQL和PostgreSQL）为Cloudera Manager Server创建和配置用户帐户。

虽然脚本可以创建数据库，但以下过程 **假定您已经按照步骤4：安装和配置数据库** 中所述创建了数据库。

## scm_prepare_database.sh的语法
scm_prepare_database.sh脚本的语法如下所示：
```shell
$ /opt/cloudera/cm/schema/scm_prepare_database.sh [options] <databaseType> <databaseName> <databaseUser>
      <password>
```
```
注意：您也可以运行scm_prepare_database.sh而不使用选项来查看语法。
```
要创建新的数据库，您必须为有权创建数据库的用户指定 **-u** 和 **-p** 参数。如果您已经按照 **步骤4：
安装和配置数据库** 中的说明创建了数据库，**请不要指定这些选项**。

以下表格描述了scm_prepare_database.sh脚本的参数和选项：

| 叁数 | 描述 |
| :------------- | :------------- |
| **`<databaseType>`** | 其中一种受支持的数据库类型：1.MariaDB: `mysql`；2.MySQL: `mysql`；3.Oracle: `oracle`；4.PostgreSQL: `postgresql`； |
| **`<databaseName>`** | 要使用的Cloudera Manager Server数据库的名称。对于MySQL，MariaDB和PostgreSQL数据库，如果您使用具有创建数据库和授予权限的用户凭据指定 **-u** 和 **-p** 选项，则该脚本可以创建指定的数据库。Cloudera Manager配置设置中提供的默认数据库名称是 **scm**，但您不需要使用它。 |
| **`<databaseUser>`** | 用于创建或使用Cloudera Manager Server数据库的用户名。Cloudera Manager配置设置中提供的默认用户名是 **scm**，但您不需要使用它。 |
| **`<password>`** | `<databaseUser>`创建或使用的密码。如果您不希望密码在屏幕上显示或存储在命令历史记录中，请不要指定密码，并提示您输入密码，如下所示：`Enter SCM password:` |

| 选项 | 描述 |
| :------------- | :------------- |
| **`-?｜--help`** | 显示帮助。 |
| **`--config-path`** | Cloudera Manager Server配置文件的路径。默认是 **/etc/cloudera-scm-server**。|
| **`-f｜--force`** | 如果指定，如果发生错误，脚本不会停止。 |
| **`-h｜--host`** | 安装数据库的主机的IP地址或主机名。默认是使用localhost。|
| **`-p｜--password`** | 数据库应用程序的管理员密码。与-u选项一起使用。默认值是无密码。**请勿在-p和密码之间放置空格**（例如-phunter2）。如果您不希望密码在屏幕上显示或存储在命令历史记录中，请在不指定密码的情况下使用-p选项，并提示您按如下方式输入密码：`Enter database password:`。**如果您已经创建了数据库，请不要使用此选项**。 |
| **`-P｜--port`** | 用于连接到数据库的端口号。MariaDB的缺省端口为3306，MySQL的缺省端口为3306，PostgreSQL为5432，Oracle为1521。该选项仅用于远程连接。 |
| **`--scm-host`** | 安装Cloudera Manager Server的主机名。**如果Cloudera Manager Server和数据库安装在同一主机上，请勿使用此选项或-h选项**。 |
| **`--scm-password-script`** | 执行其stdout为用户SCM（针对数据库）提供密码的脚本。 |
| **`-u｜--user`** | 数据库应用程序的管理员用户名。与-p选项一起使用。**请勿在-u和用户名（例如-uroot）之间留出空格**。如果提供此选项，该脚本将为Cloudera Manager Server创建用户和数据库。**如果您已经创建了数据库，请不要使用此选项**。 |

## 准备Cloudera Manager服务器数据库
1. 使用在 **步骤4：安装和配置数据库** 中创建的 **数据库名称，用户名和密码**，在Cloudera Manager
服务器主机上运行 **scm_prepare_database.sh** 脚本：
    ```shell
    $ sudo /opt/cloudera/cm/schema/scm_prepare_database.sh <databaseType> <databaseName> <databaseUser>
    ```
  出现提示时，输入密码。

2. 如果存在，请 **删除嵌入的PostgreSQL属性文件**：
    ```shell
    $ sudo rm /etc/cloudera-scm-server/db.mgmt.properties
    ```










































ddd
