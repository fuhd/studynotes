第6步：安装CDH和其他软件
================================================================================
设置Cloudera Manager数据库后，启动Cloudera Manager Server，然后登录到Cloudera Manager管理
控制台：
1. 启动Cloudera Manager Server：
    + **兼容RHEL7**
        ```shell
        $ sudo systemctl start cloudera-scm-server
        ```
    + **兼容RHEL6**
        ```shell
        $ sudo service cloudera-scm-server start
        ```
2. 等待几分钟以等待Cloudera Manager Server启动。要观察启动过程，请在Cloudera Manager Server主
机上运行以下命令：
    ```shell
    $ sudo tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log
    ```
    当您看到此日志条目时，Cloudera Manager管理控制台已准备就绪：
    ```
    INFO WebServerImpl:com.cloudera.server.cmf.WebServerImpl: Started Jetty server.
    ```
    如果Cloudera Manager Server无法启动，请参阅 [解决安装问题](https://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_troubleshooting.html#cmig_topic_19)。
3. 在Web浏览器中，转到 **`http//<server_host>7180`**，其中`<server_host>`是运行Cloudera Manager
服务器的主机的FQDN或IP地址。
4. 登录到Cloudera Manager管理控制台。 默认凭证是：**username** : `admin`，**password** : `admin`
    ```
    注意：Cloudera Manager不支持更改已安装帐户的管理员用户名。运行安装向导后，可以使用Cloudera Manager更改密码。
    尽管您无法更改管理员用户名，但可以添加新用户，为新用户分配管理权限，然后删除默认管理员帐户。
    ```
5. 登录后，将显示最终用户许可条款和条件页面。阅读条款和条件，然后选中标有“是”的框，我接受最终用户许可条款
和条件以接受它们。点击继续，然后启动安装向导。

## 1.选择Cloudera Manager版本
从欢迎使用Cloudera Manager页面，您可以选择要安装的Cloudera Manager版本，并可以选择安装许可证：
1. 选择要安装的 [版本](https://www.cloudera.com/content/dam/www/marketing/resources/datasheets/cloudera-enterprise-datasheet.pdf.landing.html#cmfeig_topic_5_1)：
    + Cloudera Express不需要许可证，但提供了一组有限的功能。
    + Cloudera Enterprise企业数据中心试用版，不需要许可证，但在60天后过期并且无法续订。
    + 具有以下许可类型之一的Cloudera Enterprise：
      - 基础版
      - Flex版
      - 企业数据中心版
  如果您选择Cloudera Express或Cloudera Enterprise企业数据中心试用版，则可以稍后升级许可证。请参阅 [管理许可证](https://www.cloudera.com/documentation/enterprise/latest/topics/cm_ag_licenses.html#cmug_topic_13_7)。
2. 如果您选择Cloudera Enterprise，请安装许可证：
    1. 点击上传许可证。
    2. 单击选择许可证文件文本字段左侧的文档图标。
    3. 转到许可证文件的位置，单击该文件，然后单击打开。
    4. 点击上传。
3. 显示指示CDH安装包含的信息。此时，您可以单击支持下拉菜单访问联机帮助或支持门户。
4. 点击继续继续安装。

## 2.欢迎
欢迎页面列出了将要安装的软件。点击继续继续安装。

## 3.选择Cloudera Manager主机
选择哪些主机将运行CDH和托管服务
1. 根据您是否使用Cloudera Manager安装软件，执行以下操作之一：
    + 如果您使用Cloudera Manager安装软件，请搜索并选择主机：
        - 要使Cloudera Manager能够自动发现安装CDH和托管服务的主机，请输入群集主机名或IP地址。
        您还可以指定主机名和IP地址范围。例如：

          | 范围定义 | 匹配主机 |
          | :------------- | :------------- |
          | 10.1.1.[1-4] | 10.1.1.1, 10.1.1.2, 10.1.1.3, 10.1.1.4 |
          | host[1-3].company.com | host1.company.com, host2.company.com, host3.company.com |
          | host[07-10].company.com | host07.company.com, host08.company.com, host09.company.com, host10.company.com |

          您可以指定多个地址和地址范围，方法是用逗号，分号，制表符或空格分隔它们，或将它们放在不同的行上。
          使用此技术进行更具体的搜索，而不是搜索过宽的范围。扫描结果将包括扫描的所有地址，但默认情况下，
          只有扫描到达运行SSH的主机才会被选中以包含在群集中。如果您不知道所有主机的IP地址，则可以输入跨
          越未使用地址的地址范围，然后在此过程的稍后清除不存在（并且未发现）的主机。但是，请记住，较宽的范
          围需要更多的时间进行扫描。
        - 点击搜索。Cloudera Manager可识别群集中的主机以允许您配置它们的服务。如果群集中有大量主机，请稍
        等片刻，以便在向导中发现并显示它们。如果搜索时间过长，则可以通过单击中止扫描来停止扫描。要查找其他主
        机，请单击新建搜索，添加主机名或IP地址，然后再次单击搜索。Cloudera Manager通过检查网络连接来扫描主
        机。如果有一些主机要安装列表中未显示的服务，请确保您在Cloudera Manager Server主机与这些主机之间具
        有网络连接。**连接丢失的常见原因是防火墙和SELinux的干扰**。
        - 验证显示的主机数量是否与要安装服务的主机数量相匹配。清除不存在的主机条目并清除不想安装服务的主机。
2. 点击继续
显示 **集群安装选择存储库** 屏幕。

## 4.选择软件安装方法并安装软件
```
重要提示：无法在同一群集中同时使用parcels和packages安装软件。
```
1. 选择用于安装的存储库类型。在 **选择方法** 部分中，选择以下选项之一：
    + 使用Parcels：
        - 选择要安装的parcels。您看到的选择取决于您选择的存储库 - 存储库可能包含多个parcels。
        默认情况下只配置最近支持的服务版本的parcels。您可以通过指定自定义存储库为以前的版本添加
        其他parcels。例如，您可以在 https://archive.cloudera.com/cdh4/parcels/ 找到以前
        的CDH4 parcels的位置。或者，如果您要安装CDH4.3并希望使用策略文件授权，则可以使用此机制
        添加Sentry parcels。
            + 要指定 **Parcel目录** 或 **本地Parcel存储库路径**，添加Parcel存储库或指定通过
            其下载parcels的代理服务器的属性，请单击 **更多选项** 按钮并执行以下一项或多项操作：
                - **Parcel目录和本地Parcel存储库路径** - 指定集群主机和Cloudera Manager服
                务器主机上的Parcels位置。
                - **Parcel储存库** - 在 **远程Parcel储存库URL** 字段中，单击 ![加号](img/1.png)
                按钮并输入储存库的URL。将您指定的URL添加到“[配置Cloudera Manager服务器Parcel设置](https://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_parcels.html#cmug_topic_7_11_5__section_sd4_bzx_bm)”
                页面中列出的存储库列表中，并将parcel添加到“选择存储库”页面上的parcel列表中。
                如果您配置了多个存储库，则会看到所有存储库中包含的所有唯一parcels。
                - **代理服务器** - 指定代理服务器的属性。
            + **点击确定**。可从配置的远程Parcels存储库URL中获得的Parcels显示在Parcels列表中。
            如果您指定的Parcels版本的URL太新以至于无法被Cloudera Manager版本支持，则Parcels不
            会显示在Parcels列表中。
    + 使用Packages：
      - 选择CDH的主要版本进行安装。
      - 选择要安装的CDH的特定版本。您可以选择最新版本，特定版本或使用自定义存储库。如果您为CDH版本
      指定了一个新的Cloudera Manager版本无法支持的自定义存储库，则Cloudera Manager将安装这些软
      件包，但您将无法使用这些软件包创建服务，并且必须手动卸载这些软件包并手动重新安装支持CDH版本的
      软件包。
      - 选择要安装的其他服务的特定版本。您可以选择最新版本或使用自定义存储库。如果您不想安装该服务，
      请选择无。
2. 如果您使用Cloudera Manager来安装软件，请选择Cloudera Manager Agent的版本。您可以选择与您当前
使用的Cloudera Manager Server相匹配的版本，也可以在自定义存储库中指定版本。如果您选择使用安装文件的
自定义存储库，则可以提供适用于所有存储库的GPG密钥URL。
3. 点击 **继续**。
显示 **集群安装JDK安装选项** 屏幕。
4. 选择 **安装Oracle Java SE开发工具包（JDK）** 以允许Cloudera Manager在每个群集主机上安装JDK。
**如果您已经安装了JDK，请不要选择此选项**。如果您的本地法律允许您部署无限强度加密，并且您正在运行安全
集群，请选中 **安装Java Unlimited Strength Encryption Policy Files** 复选框。
    ```
    注意：如果您已经在每个群集主机上手动安装了JDK，则不会显示此安装JDK的选项。
    ```
5. 点击 **继续**。
6. （可选）选择 **单用户模式** 将Cloudera Manager Agent和所有服务进程配置为以同一用户身份运行。
此模式需要 [额外的配置步骤](https://www.cloudera.com/documentation/enterprise/latest/topics/install_singleuser_reqts.html#concept_xc5_lng_2v)，必须在群集中的所有主机上手动完成。如果您尚未执行这些步骤，则安装向导中的目
录创建将失败。在大多数情况下，您可以创建目录，但安装向导执行的步骤可能必须手动继续。点击 **继续**。
7. 指定主机安装属性：
    + 选择root或输入具有无密码sudo权限的帐户的用户名。
    + 选择一种认证方法：
        - 如果您选择密码认证，请输入并确认密码。
        - 如果您选择公钥认证，请提供所需密钥文件的密码和路径。
    + 您可以指定一个备用SSH端口。默认值是22。
    + 您可以指定一次运行的主机安装的最大数量。**默认值是10**。
8. 点击 **继续**。Cloudera Manager执行以下操作：
    + **Parcels** - 安装Oracle JDK和Cloudera Manager Agent软件包并启动代理。在Parcels安装过程
    中，会在单独的进度栏中指示Parcels安装过程的各个阶段的进度。如果您要安装多个Parcels，则会看到每个
    Parcels的进度条。当屏幕底部的 **继续** 按钮变为蓝色时，安装过程完成。
    + Packages - 配置package存储库，安装Oracle JDK，CDH和托管服务以及Cloudera Manager Agent包，
    并启动代理。当屏幕底部的继续按钮变为蓝色时，安装过程完成。如果某些主机上的安装已成功完成，但在其他主
    机上失败，则可以单击“继续”，以便在故障主机上跳过安装并继续到下一个屏幕以开始在成功主机上配置服务。

    在安装软件包时，会显示每台主机上的安装状态。如果任何主机上的安装失败，请单击详细信息链接以查看单个主机
    的详细信息，以查看安装和错误消息。如果单击“中止安装”按钮，它将暂停任何挂起或正在进行的安装，并回滚任何
    正在进行的安装。中止安装按钮不会影响已成功完成或已经失败的主机安装。
9. 点击 **继续**。
主机检查器运行以验证安装并提供结果摘要，包括已安装组件的所有版本。如果验证成功，请单击 **完成**。

## 5.接受JDK许可证
```
注意：Cloudera，Inc.根据Oracle二进制代码许可协议购买了Oracle JDK软件。根据Oracle二进制代码许可协议的补充许可条款
项目D（v）（a），使用JDK软件受Oracle二进制代码许可协议条款的约束。通过安装JDK软件，您同意遵守这些条款。如果您不希望
受这些条款的约束，请不要安装Oracle JDK。
```
要允许Cloudera Manager在集群主机上自动安装Oracle JDK，请阅读JDK许可证，并选中标有安装Oracle
Java SE开发工具包（JDK）的复选框（如果您接受这些条款）。**如果您在步骤2：安装Java Development Kit
中安装了自己的Oracle JDK版本，请不要选中该框**。

如果您允许Cloudera Manager安装JDK，则会显示另一个复选框，标记为安装Java Unlimited Strength
Encryption Policy Files。这些策略文件需要在JDK版本低于1.8u161时启用AES-256加密。**JDK1.8u161
及更高版本默认启用无限强度加密，并且不需要策略文件**。

阅读许可条款并检查适用框后，点击继续。显示 **单用户模式** 页面。

## 6.单用户模式
单用户模式页面允许您启用单用户模式。**单用户模式不推荐用于大多数环境**。如果您需要启用单用户模式，请选中
标记为启用单用户模式的框。否则，请不要选中它，然后单击继续。显示输入登录凭证页面。

## 7.输入登录凭证
1. 为root帐户选择root，或者选择另一个用户并输入具有无密码sudo权限的帐户的用户名。
2. 选择一种认证方法：
    + 如果您选择密码认证，请输入并确认密码。
    + 如果您选择公钥认证，请提供所需密钥文件的密码和路径。
    如有必要，您可以修改默认的SSH端口。
    




































333
