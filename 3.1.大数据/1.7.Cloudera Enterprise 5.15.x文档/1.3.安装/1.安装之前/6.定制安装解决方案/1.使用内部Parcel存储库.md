使用内部Parcel存储库
================================================================================
您可以通过 **托管内部存储库** 或 **手动将存储库文件复制到Cloudera Manager主机** 来创建Cloudera
Manager的parcel存储库。

## 1.托管内部Parcel库
要托管内部存储库，您必须在 **可由Cloudera Manager主机访问的内部主机上** 安装或使用现有的Web服务器，
然后将存储库文件下载到Web服务器主机。

### 1.1.安装Web服务器
存储库通常在网络内的主机上 **使用HTTP进行托管**。如果您的组织中已有Web服务器，则可跳至 **下载并发布
ParcelRepository**。

一个易于安装的Web服务器是Apache HTTP服务器。

#### 1.1.1.安装Apache HTTP Server
您可能需要回复一些提示以确认您要完成安装。
+ **兼容RHEL**
    ```shell
    $ sudo yum install httpd
    ```

#### 1.1.2.启动Apache HTTPD
+ **兼容RHEL**
    ```shell
    $ sudo service httpd start
    ```

### 1.2.下载并发布Parcel存储库
1. 从以下位置为您的操作系统发行版下载parcel和manifest.json文件：
    + **CDH5**：Impala，Kudu，Spark1和Search包含在CDH parcel中。
        - **CDH** - https://archive.cloudera.com/cdh5/parcels/  
        - **Accumulo** - https://archive.cloudera.com/accumulo-c5/parcels/
        - **GPL Extras** - https://archive.cloudera.com/gplextras5/parcels/
    + **用于CDH5的Apache Spark2的Cloudera发布**：
        - 确切的parcel名称取决于操作系统。您可以在:
        https://archive.cloudera.com/spark2/parcels/ 找到所有parcels。
    + Cloudera Navigator Key Trustee服务器：
        - 转到Key Trustee Server [下载页面](https://www.cloudera.com/downloads/navigator/key-trustee-server/5-15-0.html)。
        从Parcels或packages下拉菜单中选择Parcels，然后点击立即下载。这将Key Trustee Server
        parcels和manifest.json文件下载到.tar.gz文件中。用 **tar xvfz filename.tar.gz命令**
        解压文件。
    + Cloudera Navigator Key Trustee KMS和HSM KMS :(Cloudera Navigator HSM KMS包含在
      Key Trustee KMS parcel中）。
        - 转到Key Trustee KMS [下载页面](https://www.cloudera.com/downloads/navigator/key-trustee-kms/5-15-0.html)。
        从Package或Parcel下拉菜单中选择Parcel，然后点击立即下载。这将Key Trustee KMS parcels
        和manifest.json文件下载到.tar.gz文件中。用 **tar xvfz filename.tar.gz命令** 解压文件。
    + Sqoop连接器：
        - https://archive.cloudera.com/sqoop-connectors/parcels/
2. 将.parcel，.sha1和manifest.json文件移动到Web服务器目录，并修改文件权限。例如：
    ```shell
    $ sudo mkdir -p /var/www/html/cloudera-parcels/cdh5/<cdh5_version>/
    $ sudo mv *.parcel* /var/www/html/cloudera-parcels/cdh5/<cdh5_version>/
    $ sudo mv manifest.json /var/www/html/cloudera-parcels/cdh5/
    $ sudo chmod -R ugo+rX /var/www/html/cloudera-parcels/cdh5/<cdh5_version>/
    ```
    用您的CDH版本替换`<cdh5_version>`（例如，5.14.0）。移动文件并更改权限后，请访问
    `http://<web_server>/cloudera-parcels/cdh5/<cdh5_version>` 以验证您是否可以访问该parcel。
    **如果您没有看到任何内容，您的Web服务器可能已被配置为不显示索引**。

## 2.配置Cloudera Manager服务器以将Parcel URL用于托管存储库
1. 使用以下方法之一打开Parcel设置页面：
    + 导航栏
        1. 点击顶部导航栏上的 ![2](img/2.png) 或点击 **主机**，然后点击 **Parcels** 标签。
        2. 点击 **配置** 按钮。
    + 菜单
        1. 选择 **管理** > **设置**。
        2. 选择 **类别** > **Parcels**。
2. 在“远程Parcel存储库URL”列表中，单击添加符号以打开其他行。
3. 输入parcel的路径。例如：`http://<web_server>/cdh5/<cdh5_version>`。
4. 点击 **保存更改** 以提交更改。

## 3.使用本地Parcel存储库
要使用本地Parcel存储库，请完成以下步骤：
1. 打开Cloudera Manager Web UI并导航至Parcels页面。
2. 选择配置并确认您有本地Parcel存储库路径集。**默认情况下，该目录是/opt/cloudera/parcel-repo**。
3. 删除所有未使用的远程Parcel存储库URL，包括指向Cloudera档案的URL。
4. 将要使用的Parcel添加到您指定的本地Parcel存储库目录中。
5. 在命令行中，导航到本地Parcel存储库目录。
6. 为您添加的Parcel创建一个SHA1散列，并将其保存到名为`<parcel_name>.parcel.sha1`的文件中。
例如，以下命令为宗地CDH-5.14.0-1.cdh5.14.0.p0.24-el7.parcel生成SHA1散列：
    ```shell
    $ sha1sum CDH-5.14.0-1.cdh5.14.0.p0.24-el7.parcel | awk '{ print $1 }' > CDH-5.14.0-1.cdh5.14.0.p0.24-el7.parcel.sha1
    ```
7. 将Parcel和散列文件的所有权更改为 **cloudera-scm**：
    ```shell
    $ sudo chown cloudera-scm:cloudera-scm *.parcel.*
    ```
8. 在Cloudera Manager Web UI中，导航至Parcels页面。
9. 点击检查新Parcels。
10. 当新Parcels出现时，下载，分发和激活Parcels。
