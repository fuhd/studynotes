Cloudera Manager的存储空间规划
================================================================================
**最低要求的角色：完全管理员**

Cloudera Manager在许多后台进程中跟踪服务，作业和应用程序的度量。所有这些指标都需要存储。根据组织的规模，
此存储可以是本地或远程的，基于磁盘的或存储在数据库中，由您或另一个位置的其他团队管理。

大多数系统管理员都知道像 /var/log/ 这样的常见位置，并且需要这些位置有足够的空间。**本主题可帮助您规划
Cloudera Manager Server和Cloudera Management Service用于存储指标和数据的存储需求和数据存储位置**。

无法规划Cloudera Manager Server和Cloudera Management Service的所有组件的存储需求可能会以下列方式
对您的群集产生负面影响：
+ 集群可能无法保留历史运营数据以满足内部要求。
+ 群集可能会错过未收集或保留所需时间长度的关键审计信息。
+ 管理员可能无法研究过去的事件或健康状况。
+ 当以后需要引用或报告时，管理员可能没有历史MR1，YARN或Impala使用数据。
+ 指标收集和图表可能存在差距。
+ 由于将存储位置填充到容量的100％，群集可能会遇到数据丢失。 这种事件的影响可能会影响许多其他组件。

**这里的主要主题是您必须提前完善您的数据存储需求。您必须通知您的运营人员有关每台主机的关键数据存储位置，
以便他们可以充分配置您的基础架构并进行适当备份。确保在内部构建文档和运行书中记录发现的需求**。

本主题介绍 **本地磁盘存储和RDBMS存储**。这种区别既可用于存储规划，也可用于通知角色从一台主机迁移到
另一台主机，准备备份和其他生命周期管理事件。

**下表提供了有关每个Cloudera管理服务的详细信息，以便Cloudera Manager管理员能够制定适当的存储和生命
周期规划决策**。

## 1.Cloudera Manager Server

| 配置主题 | Cloudera Manager服务器配置 |
| :------------- | :------------- |
| 默认存储位置 | **RDBMS**：任何支持的RDBMS。有关更多信息，请参阅CDH和Cloudera Manager支持的数据库。**磁盘**：Cloudera Manager Server本地数据存储目录（command_storage_path）配置为运行Cloudera Manager Server的主机。Cloudera Manager使用此本地路径来存储数据，包括命令结果文件。关键配置不存储在此位置。**默认设置：/var/lib/cloudera-scm-server/** |
| 存储配置 **默认值，最小值或最大值** | 没有与此实体相关的直接存储默认值。 |
| 何处控制数据保留或大小 | Cloudera Manager Server数据库的大小取决于托管主机的数量以及群集中运行的离散命令的数量。要在Cloudera Manager管理控制台中配置保留的命令的大小，请选择 **Administration> Settings** 并编辑以下属性：**Command Eviction Age**，非活动命令从数据库中逐出的时间长度。默认是两年。 |
| 规模，规划和最佳实践 | Cloudera Manager Server数据库是Cloudera Manager部署中最重要的配置存储。此数据库保存用于定义Cloudera Manager及其托管主机的部署的群集，服务，角色和其他必要信息的配置。确保您执行Cloudera Manager Server数据库的定期，经过验证的远程存储备份。 |

## 2.Cloudera Management Service

### 2.1.Cloudera管理服务 - 活动监视器配置

| 配置主题 | 活动监视器 |
| :------------- | :------------- |
| 默认存储位置 | 任何支持的RDBMS。有关更多信息，请参阅CDH和Cloudera Manager支持的数据库。 |
| 存储配置 **默认值/最小值/最大值** | 默认值：14天的MapReduce（MRv1）作业/任务 |
| 何处控制数据保留或大小 | 您可以通过配置要保留的数据天数或小时数来控制活动监视器的存储使用情况。旧数据已清除。要在Cloudera Manager管理控制台中配置数据保留，请执行以下操作：1.转到Cloudera管理服务。2.单击 **配置** 选项卡。3.选择作用域`>`活动监视器或Cloudera管理服务（服务范围）。4.选择 **类别>主**。5.找到以下属性或通过在搜索框中键入属性名称来搜索它们：**Purge Activities Data at This Age(清除活动数据)** - 在活动监视器中，清除有关MapReduce作业的数据，并在数据达到此时间后以小时为单位汇总活动。 默认情况下，活动监视器将有关活动的数据保留336小时（14天）。**Purge Attempts Data at This Age(清除尝试数据)** - 在活动监视器中，当数据达到这个年龄时，清除有关MapReduce的数据尝试。 由于尝试数据可能消耗大量数据库空间，因此您可能希望比活动数据更频繁地清除它。 默认情况下，活动监视器保留关于尝试336小时（14天）的数据。**Purge MapReduce Service Data at This Age(清除MapReduce服务数据)** - 要保留在活动监视器数据库中的过去服务级别数据的小时数，例如运行的总插槽数。 默认设置是保持336小时（14天）的数据。6.点击 **保存更改** 以提交更改。 |
| 规模，规划和最佳实践 | 活动监视器只监视MapReduce作业，不监视YARN应用程序。如果您不再在群集中使用MapReduce（MRv1），则Cloudera Manager5（或更高版本）或CDH5（或更高版本）不需要活动监视器。为期14天的MapReduce活动所需的存储空间量可能会有很大差异，并且直接取决于群集大小以及使用MapReduce的活动级别。在确定群集中MapReduce活动的“稳定状态”和“突发状态”时，可能需要调整和重新调整存储量。例如，请考虑以下测试集群和用法：1.一个模拟的1000个主机群集，每个主机都有32个插槽；2.每个活动（作业）有200次尝试（任务）的MapReduce作业调整此集群的观察值；3.每次尝试需要10分钟才能完成。4.这种用法每天导致约2万个工作，总共尝试约500万次。5.对于7天的保留期限，此活动监视器数据库需要200 GB。 |

### 2.2.Cloudera管理服务 - 服务监视器配置

| 配置主题 | 服务监视器配置 |
| :------------- | :------------- |
| 默认存储位置 | **/var/lib/cloudera-service-monitor/** 位于配置Service Monitor角色运行的主机上。 |
| 存储配置 **默认值/最小值/最大值** | 1.10GiB服务时间序列存储；1GiB Impala查询存储；1GiB YARN应用程序存储；总计：〜12GiB最小值（无最大值） |
| 何处控制数据保留或大小 | Service Monitor数据增长是通过配置它可以使用的最大存储空间量来控制的。在Cloudera Manager管理控制台中配置数据保留：1.转到Cloudera管理服务。2.单击 **配置** 选项卡。3.选择 **作用域>服务监视器或Cloudera管理服务（服务范围）**。 4.选择 **类别>主**。5.找到 **propertyName** 属性或通过在搜索框中输入名称来搜索它。**时间序列存储：** 用于存储时间序列和健康数据的大致磁盘空间量。当存储达到其最大尺寸时，它将删除较旧的数据以为更新的数据腾出空间。磁盘使用率是近似值，因为存储只有在达到限制时才开始删除数据。请注意，Cloudera Manager以多种不同的数据粒度存储时间序列数据，并且这些粒度具有不同的有效保留期。服务监视器不仅将度量数据存储为原始数据点，还将其存储为十分钟，每小时，每六小时，每日和每周的摘要数据点。原始数据占用大部分分配的存储空间，每周总结消耗最少。原始数据保留最短时间，而每周汇总点不可能被删除。请参阅Cloudera Manager中的 **Cloudera管理服务>图表库** 选项卡，了解有关在服务监视器中如何消耗空间的信息。这些预建图表还显示有关每个数据粒度所保留的数据量和时间窗口的信息。**Impala存储：** 大约专用于存储Impala查询数据的磁盘空间量。当存储达到其最大尺寸时，它会删除较旧的数据以为较新的查询腾出空间。磁盘使用率是近似值，因为存储只有在达到限制时才开始删除数据。**YARN存储：** 用于存储YARN应用程序数据的大致磁盘空间量。当存储达到最大尺寸时，它会删除较旧的数据以为新应用程序腾出空间。磁盘使用率是近似值，因为Cloudera Manager只有在达到限制时才开始删除数据。6.点击 **保存更改** 以提交更改。 |
| 规模，规划和最佳实践 | 服务监视器收集有关群集中配置的角色和服务的度量标准，并且还运行活动的运行状况测试。无论闲置和使用期限如何，这些健康测试都会运行，因为它们总是相关的。 服务监视器收集指标和运行状况测试结果，而不管集群中活动的级别如何。 即使在空闲的群集中，这些数据也在不断增长。 |

### 2.3.Cloudera管理服务 - 主机监视器

| 配置主题 | 服务监视器配置 |
| :------------- | :------------- |
| 默认存储位置 | **/var/lib/cloudera-host-monitor/** 在运行Host Monitor角色的主机上。 |
| 存储配置 **默认值/最小值/最大值** | 默认（和最小）：10GiB主机时间序列存储 |
| 何处控制数据保留或大小 | 主机监视器数据增长是通过配置它可以使用的最大存储空间量来控制的。请参阅监控数据的数据存储。要在Cloudera Manager管理控制台中配置这些数据保留配置属性，请执行以下操作：1.转到Cloudera管理服务。2.单击 **配置** 选项卡。3.选择 **Scope > 主机监视器或Cloudera管理服务(服务范围)**。4.选择 **类别>主**。5.找到每个属性或通过在“搜索”框中键入其名称来搜索它。6.**时间序列存储：** 用于存储时间序列和健康数据的大致磁盘空间量。当存储达到其最大尺寸时，它将删除较旧的数据以为较新的数据腾出空间。磁盘使用率是近似值，因为存储只有在达到限制时才开始删除数据。请注意，Cloudera Manager以多种不同的数据粒度存储时间序列数据，并且这些粒度具有不同的有效保留期。主机监视器不仅将度量数据存储为原始数据点，而且还将其作为10分钟，1小时，6小时，1天和1周增量的摘要。原始数据占用大部分分配的存储空间，每周总结消耗最少。原始数据保留最短时间，而每周汇总点不可能被删除。请参阅Cloudera Manager中的 **“Cloudera管理服务”>“图表库”** 选项卡，了解有关主机监视器中消耗空间的信息。这些预建的图表还显示有关保留的数据量和每个数据粒度覆盖的时间窗口的信息。6.点击 **保存更改** 以提交更改。 |
| 规模调整，规划和最佳实践 | 主机监视器收集有关主机级别项目的指标（例如：磁盘空间使用情况，RAM，CPU使用情况，交换等），并通知主机运行状况测试。 无论群集中的活动级别如何，主机监视器都会收集度量标准和运行状况测试结果。 即使在闲置的群集中，这些数据仍然保持线性增长。 |

### 2.4.Cloudera管理服务 - 事件服务器

| 配置主题 | 服务监视器配置 |
| :------------- | :------------- |
| 默认存储位置 | **/var/lib/cloudera-scm-eventserver/** 配置在事件服务器角色运行的主机上。 |
| 存储配置默认值 | 保留5,000,000个事件 |
| 何处控制数据保留或最小/最大值 | 事件服务器使用的存储空间量受配置它可以保留多少个离散事件的影响。要在Cloudera Manager管理控制台中配置数据保留。1.转到Cloudera管理服务。2.单击 **配置** 选项卡。3.选择 **Scope> Event Server或Cloudera Management Service（服务范围）**。4.选择 **类别>主**。5.编辑以下属性：**事件服务器存储中事件的最大数量：** 事件中事件服务器存储的最大大小。超过此大小时，事件将从最早的第一个开始删除，直到存储的大小低于此阈值。6.点击 **保存更改** 以提交更改。 |
| 规模，规划和最佳实践 | 事件服务器是一个管理的Lucene索引，用于收集集群内发生的相关事件，例如运行状况测试的结果，当日志条目与一组用于标识感兴趣的消息并使其可用于搜索的规则匹配时创建的日志事件 ，过滤和其他操作。您可以在Cloudera Manager管理控制台的 **诊断>事件** 选项卡上查看和过滤事件。您还可以使用Cloudera Manager API轮询此数据。**注意：Cloudera Management Service角色Alert Publisher通过定期轮询事件服务器以查找标记为使用SNMP或SMTP（S）发送的条目来获取其工作的所有内容。不讨论Alert Publisher，因为它没有自己的值得注意的存储要求。** |






































222
