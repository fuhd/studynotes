硬件需求指南
================================================================================
要评估群集的硬件和资源分配，需要分析要在群集上运行的工作负载类型，以及您将用于运行这些工作负载的CDH组件。
您还应该考虑要存储和处理的数据大小，工作负载的频率，需要运行的并发作业数以及应用程序所需的速度。

在创建集群体系结构时，您需要在集群中的主机之间分配Cloudera Manager和CDH角色，以最大限度地利用资源。
Cloudera提供了有关如何将角色分配给群集主机的一些指导。请参阅推荐的 [群集主机和角色分配](https://www.cloudera.com/documentation/enterprise/latest/topics/cm_ig_host_allocations.html)。
将多个角色分配给主机时，将主机上每个角色的总资源需求（内存，CPU，磁盘）加在一起以确定所需的硬件。

有关工作负载如何影响尺寸决策的信息，请参阅以下博客文章：[操作方法：为您的新Hadoop集群选择合适的硬件](http://blog.cloudera.com/blog/2013/08/how-to-select-the-right-hardware-for-your-new-hadoop-cluster/)。
```
注意：关于核心数量的所有建议都是指逻辑核心，而不是物理核心。
```

## 1.Cloudera Manager

### 1.1.Cloudera Manager服务器存储要求

| 组件 | 存储 | 备注 |
| :------------- | :------------- | :-------------- |
| 分区托管 /usr | 1GB |  |
| Cloudera Manager数据库 | 5GB | 如果Cloudera Manager数据库与具有Service Monitor和Host Monitor的主机共享，则需要更多的存储空间才能满足这些组件的要求。 |

### 1.2.基于主机的Cloudera Manager服务器要求

| 群集主机数量 | 数据库主机配置 | 堆大小 | 逻辑处理器 | Cloudera Manager Server存储本地目录 |
| :--------- | :---------- | :------ | :------ | :-------------------------------- |
| 非常小（≤10） | 共享 | 2GB | 4 | 最低5GB |
| 小（≤20） | 共享 | 4GB | 6 | 最低20GB |
| 中等（≤200） | 专用 | 8GB | 6 | 最低200GB |
| 大（≤500） | 专用 | 10GB | 8 | 最低500GB |
| 特大（> 500） | 专用 | 16GB | 16 | 最低1TB |

```
注意：在较小的群集上，Cloudera Manager服务器和数据库可以共享主机。 在较大的群集上，它们必须在不同的专用主机上运行。
```

### 1.3.服务监视器要求
服务监视器的要求基于受监视实体的数量。要查看受监视实体的数量，请执行以下步骤：
1. 打开Cloudera Manager管理控制台，然后单击 **群集> Cloudera管理服务**。
2. 找到Cloudera管理服务监控的实体图表。如果图表不存在，请将其从图表库中添加。

#### 1.3.1.与HDFS，YARN或Impala集群
对于具有工作角色的唯一服务是HDFS，YARN或Impala的群集，请使用此表中的建议。

| 受监控实体的数量 | 主机数量 | 必需的Java堆大小 | 推荐的非Java堆大小 |
| :---------- | :-------- | :------------- | :-------------- |
| 0-2,000 | 0-100 | 1GB | 6GB |
| 2,000-4,000 | 100-200 | 1.5GB | 6GB |
| 4,000-8,000 | 200-400 | 1.5GB | 12GB |
| 8,000-16,000 | 400-800 | 2.5GB | 12GB |
| 16,000-20,000 | 800-1,000 | 3.5GB | 12GB |

#### 1.3.2.与HBase，Solr，Kafka或Kudu集群
在群集中部署HBase，Solr，Kafka或Kudu等服务时，请使用这些建议。这些服务通常具有较大数量的受监视实体。

| 受监控实体的数量 | 主机数量 | 必需的Java堆大小 | 推荐的非Java堆大小 |
| :---------- | :-------- | :------------- | :-------------- |
| 0-30,000 | 0-100 | 2GB | 12GB |
| 30,000-60,000 | 100-200 | 3GB | 12GB |
| 60,000-120,000 | 200-400 | 3.5GB | 12GB |
| 120,000-240,000 | 400-800 | 8GB | 20GB |

### 1.4.主机监视器
主机监视器的要求基于受监视实体的数量。要查看受监视实体的数量，请执行以下步骤：
1. 打开Cloudera Manager管理控制台，然后单击 **群集> Cloudera管理服务**。
2. 找到Cloudera管理服务监控的实体图表。如果图表不存在，请将其从图表库中添加。

| 主机数量 | 受监控实体的数量 | 堆大小 | 非Java堆大小 |
| :---------- | :-------- | :------------- | :-------------- |
| 0-200 | <6k | 1GB | 2GB |
| 200-800 | 6k-24k | 2GB | 6GB |
| 800-1000 | 24k-30k | 3GB | 6GB |

确保主机监视器，服务监视器，报告管理器和事件服务器数据库 **至少有25GB可用磁盘空间**。

### 1.5.报告管理器
报告管理器定期从NameNode获取fsimage。它读取fsimage并为它创建一个Lucene索引。**为了提高索引性能，
Cloudera建议配置一台尽可能强大的主机，并将SSD磁盘专用于报告管理器**。

| 组件 | Java堆 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| 报告管理器 | fsimage大小的3-4倍 | 最少：8个核心，推荐：16核心（32核心，启用超线程）| 1个专用磁盘，至少是fsimage大小的20倍。 Cloudera强烈建议使用SSD磁盘。 |

### 1.6.代理主机
未打包的parcel大约需要存储在Cloudera Manager服务器上的打包parcel的 **3倍** 空间。

### 1.7.事件服务器
为事件服务器索引目录预留 **20GB** 的磁盘空间。（此目录的位置由事件服务器索引目录事件服务器配置属性
设置。）

## 2.Cloudera导航器
导航器组件的大小根据集群的大小和生成的审计事件的数量而变化很大。有关更多信息，请参阅最小建议内存和磁盘
空间。

| 组件 | Java堆/内存 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| 导航器审计服务器 | 最小：2-3GB的Java堆;使用字节配置属性中的审计服务器Java堆大小配置此值 | 最小：1个核心 | Navigator Audit Server使用的数据库必须能够容纳数百GB（或每天数千万行）。数据库大小可能会达到TB。理想情况下，数据库不应该与其他服务共享，因为审计插入速率可能会压倒数据库服务器，使得使用同一数据库的其他服务的响应性降低。请参阅Cloudera Navigator的存储空间规划。 |
| 导航器元数据服务器 | 最小：10GB的Java堆,推荐：20GB Java堆；为操作系统缓冲区缓存添加20GB，但是对于繁忙的群集，内存要求可能要高得多，并且可能需要配置专用主机。导航器日志包括基于正在跟踪的对象数量的估计。使用字节配置属性中的导航器元数据服务器Java堆大小配置此值。| 最小：1个核心 | 最低：50GB，建议：100-200GB；注意：除非您运行清除功能，否则元数据服务器存储的数据会无限增长。如果您尚未将清除功能设置为按计划的时间间隔运行，则Cloudera建议您运行清除功能以回收磁盘空间并检查数据增长（以及相应的内存要求）。请参阅Cloudera导航器管理。|
| Navigator HSM KMS | 16GB RAM | 最低：2GHz 64位四核 | 40GB，使用中等到高性能驱动器。|

## 3.Cloudera数据科学工作台

| 硬件组件 | 需求 | 备注 |
| :---------- | :-------- | :------------- |
| CPU | 16+ CPU（vCPU）内核 | 每个会话至少分配一个CPU内核。1个CPU内核通常适用于轻工作负载。 |
| 内存 | 32 GB RAM | 作为一般指导，Cloudera建议RAM的容量在60GB到256GB之间；分配少于2GB的RAM可能会导致许多应用程序出现内存不足错误。|
| 磁盘 | root卷：100GB；应用程序块设备或安装点（仅限主主机）：500GB；Docker镜像块设备：500GB | 强烈建议将SSD用于应用程序数据存储。|

## 4.CDH

### 4.1.Accumulo

| 组件 | Java堆 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Master | 最小：1GB（100-1000 tablets：4GB；10,000或更多tablets与200或更多的tablets服务器：8GB；10,000或更多tablets与300或更多的tablets服务器：12 GB。使用Tablet Server Max Heapsize Accumulo配置属性设置此值。请参阅Flume Memory消耗 | 2个核心。为大型群集或批量加载添加更多内容。 | 1个本地日志磁盘 |
| Tablet服务器 | 最小：512MB Java堆；建议：8GB；中等规模生产（每台Tablet服务器200个或更多的Tablets）：16GB；使用Tablet Server Max Heapsize Accumulo配置属性设置此值。| 最少4个专用内核。您可以在使用复制或批量加载时为更大的群集添加更多核心。| 每个HDFS DataNode有4个或更多的主轴；1磁盘用于本地日志（该磁盘可与操作系统 和/或 其他Hadoop日志共享）|
| Tracer（追踪器）| 1~2GB，具体取决于集群工作负载；使用Tracer Max Heapsize Accumulo配置属性设置此值。| 2个或更多专用内核，具体取决于群集大小和工作负载 | 1磁盘用于本地日志，可以与操作系统 和/或 其他Hadoop日志共享 |
| GC角色 | 1~2GB，使用Accumulo配置属性(Tracer Max Heapsize)设置此值。| 2个或更多专用内核，具体取决于群集大小 | 1磁盘用于本地日志，可以与操作系统 和/或  其他Hadoop日志共享 |
| 监视角色 | 1~2GB，使用Monitor Max Heapsize Accumulo配置属性设置此值。| 2个或更多专用内核，具体取决于群集大小和工作负载 | 1磁盘用于本地日志，可以与操作系统 和/或 其他Hadoop日志共享 |

有关更多信息，请参阅CDH安装指南中的Apache Accumulo。

### 4.2.Flume

| 组件 | Java堆 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Flume | 最低：1GB；最大4GB；Java堆大小应该大于最大channel容量；使用Flume配置属性 **以字节为单位的Agent的Java堆大小** 设置此值。 | 使用以下公式计算核心数量：（sources数量+sinks的数量/2 | 建议多个磁盘用于文件通道，JBOD设置或RAID10（由于可靠性提高，首选）。 |

### 4.3.HDFS

| 组件 | 内存 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| JournalNode | 1GB（默认）；使用HDFS配置属性 **以字节为单位的JournalNode的Java堆大小** 来设置此值。 | 最少1个核心 | 1个专用磁盘 |
| NameNode | 最小：1GB（用于概念验证部署），为每增加1,000,000个block添加一个额外的1GB；快照和加密可以增加所需的堆内存。使用HDFS配置属性 **以字节为单位的NameNode的Java堆大小** 设置此值。 | 最少4个专用核;更大的集群可能需要更多 | 最少2个元数据专用磁盘；1个用于日志文件的专用磁盘（该磁盘可能与操作系统共享。）；最大磁盘数：4 |
| DataNode | 最低：1GB；增加内存以获得更高的副本计数或每个DataNode的更多块数；使用HDFS配置属性 **以字节为单位的DataNode的Java堆大小** 设置此值。 | 最小：4个核心。为高度活跃的群集添加更多内核。 | 最低：4；最大：24；最大可接受尺寸取决于平均块大小的大小。DN的可扩展性限制大多是每个DN的副本数量的函数，而不是所存储的总字节数。也就是说，如果机器或机架出现故障，使用超密度的DN将会影响恢复时间 - 我们建议每个DN不要超过100TB的原始存储容量。这种影响主要是集群中可用网络容量的一个功能。 |

### 4.4.HBase

| 组件 | Java堆 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Master | 100-10,000个regions：4GB；10,000或更多regions，200个或更多的regions服务：8GB；拥有300个或更多regions服务的10,000个或更多regions：12GB；使用HBase配置属性 **以字节为单位的HBase Master的Java堆大小** 设置此值。 | 最少4个专用内核。您可以在使用复制或批量加载时为更大的群集添加更多核心。 | 1磁盘用于本地日志，可以与操作系统 和/或 其他Hadoop日志共享 |
| Region服务 | 最低：8GB；中等规模生产：16GB；大于16GB的堆需要特殊的垃圾收集调整，请参阅配置HBase BlockCache；使用HBase配置属性 **以字节为单位的HBase Region服务的Java堆大小** 设置此值。 | 最低：4个专用内核 | 每个DataNode有4个磁盘 |

### 4.5.Hive

| 组件 | Java堆 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| HiveServer 2 | 单一连接：4GB；2-10个连接：4-6GB；11-20连接：6-12GB；21-40个连接：12-16GB；41到80个连接：16-24GB。Cloudera建议将HiveServer2分成多个实例，并在您开始为HiveServer2分配超过12GB的空间时对其进行负载平衡。目标是调整大小以减少Java垃圾回收对服务进行的活动处理的影响。使用Hive配置属性 **以字节为单位的HiveServer2的Java堆大小** 设置此值。 | 最少4个专用内核 | 最少1个磁盘，该磁盘对于以下项目是必需的：HiveServer2日志文件；标准输出和标准输出文件；配置文件；操作日志存储在可配置的operation_logs_dir目录中；任何可能由本地映射任务在 /tmp目录下创建的临时文件 |
| Hive Metastore | 单一连接：4GB；2-10个连接：4-10GB；11-20连接：10-12GB；21-40个连接：12-16GB；41到80个连接：16-24GB。使用Hive配置属性 **以字节为单位的Hive Metastore服务器的Java堆大小** 设置此值。 | 最少4个专用内核 | 最少1个磁盘，此磁盘是必需的，以便Hive Metastore可以存储以下工件：日志；配置文件；如果数据库服务器也托管在同一节点上，则用于存储元数据的后端数据库 |
| Beeline CLI | 最低：2GB | N/A | N/A |

#### 4.5.1.Hive on Spark
| 组件 | 内存 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Hive-on-Spark | 最低：16GB；建议：32GB用于较大的数据大小。单个执行程序堆不应大于16GB，因此具有更多RAM的计算机可以使用多个执行程序。 | 最小：4个核心；建议：对于更大的数据大小，8核心 | 磁盘空间要求由Spark溢出的临时空间要求驱动。 |

### 4.6.Hue
| 组件 | 内存 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Hue Server | 最低：4GB；最大10GB；如果群集使用Hue负载平衡器，请添加额外的内存 | 最低：1个运行Django的核心；将Hue配置为实现高可用性时，请添加其他核心 | 最低：数据库为10GB，根据群集大小和工作负载按比例增长。当Hue配置为高可用性时，需要添加临时空间 |

```
注意：Hue受cgroup设置的限制。Cloudera Manager 5.9及更高版本的所有内存软/硬限制都设置为-1。
```

### 4.7.Impala

| 组件 | 内存 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Impalad进程，目录服务器，StateStore | 最低：32GB；建议：128GB。使用配置属性 **以字节为单位的目录服务器的Java堆大小** 为目录服务器设置堆大小。| 最低：4；推荐：16或更多。CPU指令集支持：SSSE3 | 最小：1个磁盘；建议：8或更多 |

Impala的规模要求可能会有很大差异，具体取决于使用Impala的工作负载大小和类型。

### 4.8.Kafka
Kafka需要相当少量的资源，特别是在进行一些配置调整时。默认情况下，Kafka可以作为1核心和1GB内存运行，
并根据数据保留的需求进行存储扩展。

CPU很少成为瓶颈，因为Kafka是I/O繁重的，但具有足够线程的中等大小的CPU对处理并发连接和后台任务仍然非
常重要。

Kafka brocker倾向于拥有与HDFS数据节点类似的硬件配置文件。你如何构建它们取决于你的Kafka用例的重要性。
使用以下准则：

| 要影响这些功能的性能：| 调整这些参数： |
| :------------- | :------------- |
| Message保存 | 磁盘大小 |
| 客户吞吐量（生产者和消费者）| 网络容量 |
| 生产者吞吐量 | 磁盘I/O |
| 消费者吞吐量 | 内存 |

Kafka节点的常见选择如下：

| 组件 | 内存/Java堆 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Broker | 内存：64GB；推荐的Java堆：4GB。使用Kafka配置属性 **Broker的Java堆大小** 设置此值。 | 12-24核心 | 1个HDD用于操作系统；1个HDD用于Zookeeper dataLogDir（使用SSD可提供额外的性能）；10-HDD，使用Raid 10，用于Kafka数据 |
| MirrorMaker | 1 GB堆，使用Kafka配置属性的 **MirrorMaker Java堆大小** 设置此值。| 每3-4个流1个核心 | MirrorMaker实例不需要磁盘空间。目标Broker应具有足够的磁盘空间来存储正在复制的主题。|

网络要求：千兆以太网或万兆以太网。

### 4.9.Key Trustee

| 组件 | 内存 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Key Trustee服务；注意：KTS需要额外的专用资源。 有关更多信息，请参阅静态数据加密要求。| 8GB | 1 GHz 64位 四核 | 20GB，使用中等到高性能驱动器 |
| Key Trustee KMS；注意：Cloudera建议使用性能与您的NameNode主机相当的机器，并使用支持AES-NI的Intel CPU来获得最佳性能。 | 16GB | 2 GHz 64位 四核 | 40GB，使用中等到高性能驱动器 |

### 4.10.Kudu

| 组件 | 内存 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Tablet服务 | 最低：4GB；建议：10GB。 | 可能需要额外的硬件，具体取决于集群中运行的工作负载。如果您正在使用Impala，请参阅Impala大小调整指南 | 1个用于预写日志（WAL）的磁盘。使用SSD驱动器可能会提高性能。 |
| Master | 最小：256MB；建议：1GB。 |  | 1个磁盘 |

### 4.11.Oozie

| 组件 | Java堆 | CPU | 磁盘 |
| :---------- | :-------- | :------------- | :-------------- |
| Oozie | 最小值：1GB（这是Cloudera Manager设置的默认值）。对于少于10个并发工作流程而言，这是足够的，而不需要分流；如果您发现垃圾收集过多或内存不足错误，请将中型生产群集的堆大小增加到4GB，或将大型生产群集的堆大小增加到8GB；使用Oozie配置属性 **以字节为单位的Oozie服务器的Java堆大小** 设置此值。| 无需资源 | 无需资源 |

#### 4.11.1.其他调整
对于运行复杂工作流的具有多个协调器的工作负载(达到最大并发数!警告出现在日志中，Oozie管理-queuedump命令显示了一个大队列):
+ 将oozie.service.CallableQueueService.callable.concurrency属性的值增加到50
+ 将oozie.service.CallableQueueService.threads属性的值增加到200

**注意：不要将Derby数据库用作Oozie的后端数据库**。









































ddd
