CORS
===================================

### 什么是CORS？
CORS就是 **跨域资源共享** （Cross-Origin Resource Sharing）。

### CORS与JSONP区别
1. `JSONP`只能实现 **GET** 请求，而`CORS`支持 **所有类型的HTTP请求** 。
2. 使用`CORS`，开发者可以使用普通的`XMLHttpRequest`发起请求和获得数据，比起`JSONP`有更好的错误处理。
3. `JSONP`主要被老的浏览器支持，它们往往不支持`CORS`。而绝大多数现代浏览器都已经支持了CORS。

### CORS使用
假设`http://www.test1.com`是请求方，`http://www.test2.com`为被请求方。一般情况下，
如果我们直接使用`AJAX`来请求将会失败，浏览器也会返回 **源不匹配** 的错误，**跨域** 也就以此由来。
利用 **CORS**，`http://www.test2.com`只需添加一个或多个 **response header**，就可以允许来自`http://www.test1.com`的请求。
#### 简单跨域
要在 **GET** 或者 **POST** 的响应（ **response** ）里，增加 **header参数**。
示例，设置 **星号（＊）** 表示允许任何域向我们的服务端提交请求：
```java
response.setHeader("Access-Control-Allow-Origin", "*");  
```
也可以设置 **指定的域名**，如域名：`http://www.test1.com`，那么就允许来自这个域名的请求：
```java
response.setHeader("Access-Control-Allow-Origin", "http://www.test1.com");
```
#### 复杂跨域
浏览器会先发起一个验证的网络连接到`servlet`的`doOptions`方法。在后台的`doOptions`操作里设置：
```java
//允许跨域访问的域，可以是一个域的列表，也可以是通配符"*"
response.setHeader("Access-Control-Allow-Origin","http://www.test1.com");
//允许使用的请求方法，以逗号隔开
response.setHeader("Access-Control-Allow-Methods","GET,POST,OPTIONS");
//允许自定义的头部，以逗号隔开，大小写不敏感
response.setHeader("Access-Control-Allow-Headers","Content-type,hello");
//缓存此次请求的秒数。在这个时间范围内，所有同类型的请求都将不再发送预检请求而是直接使用此次返回的头作为判断依据，非常有用，大幅优化请求次数
response.setHeader("Access-Control-Max-Age","50");
```


### CORS安全性
CORS也是存在安全性问题的，需要配合其它技术！！
