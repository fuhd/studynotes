nginx的虚拟主机配置
===========================================================
### 什么是虚拟主机
虚拟主机使用的是特殊的软硬件技术，它把一台运行在因特网上的服务器主机分成一台台“虚拟”的主机，
每台虚拟主机都可以是一个独立的网站，可以具有独立的域名，具有完整的Internet服务器功能（www、ftp、email等），
同一台主机上的虚拟主机之间是完全独立的。从网站访问者来看，每一台虚拟机和一台独立的主机完全一样。

利用虚拟主机，不用为每个要运行的网站提供一台单独的Nginx服务器或单独运行一组Nginx进程。**虚拟主机提供了
在同一台服务器、同一组Nginx进程上运行多个网站的功能**。

在Nginx配置文件（nginx.conf）中，一个最简化的虚拟主机配置代码如下：
```nginx
http
{
  server
  {
    listen 80 default;
    server_name _ *;
    access_log logs/default.access.log combined;
    location / {
      index index.html;
      root /data0/htdocs/htdocs;
    }
  }
}
```
Nginx也可以配置多种类型的虚拟主机：一是 **基于IP的虚拟主机**，二是 **基于域名的虚拟主机**，三是 **基于端口的虚拟主机**。

### 配置基于IP的虚拟主机
**Linux、FreeBSD操作系统都允许添加IP别名。IP别名背后的概念很简单：可以在一块物理网卡上绑定多个IP地址。
这样就能够在使用单一网卡的同一个服务器上运行多个基于IP的虚拟主机**。设置IP别名也非常容易，**只须配置系统上的
网络接口，让它监听额外的IP地址**。在 **Linux** 系统上，可以使用标准的网络配置工具（比如 **ifconfig** 和 **route** 命令）
添加IP别名。以下是添加IP别名的示例：

先用 **ifconfig** 命令查看该服务器的IP地址。下面这台服务器有一块物理网卡设备 **eth0** 和本地回环设备 **lo**，
eth0的IP地址为192.168.8.42，本地回环lo的IP地址为127.0.0.1。
```shell
ifconfig
```
显示：
```
eth0      Link encap:以太网  硬件地址 00:0c:29:dd:c3:9a  
          inet 地址:192.168.8.42  广播:192.168.8.255  掩码:255.255.255.0
          inet6 地址: fe80::da40:93a8:6939:f69a/64 Scope:Link
          UP BROADCAST RUNNING MULTICAST  MTU:1500  跃点数:1
          接收数据包:30991 错误:0 丢弃:0 过载:0 帧数:0
          发送数据包:29029 错误:0 丢弃:0 过载:0 载波:0
          碰撞:0 发送队列长度:1000
          接收字节:5863087 (5.8 MB)  发送字节:3197153 (3.1 MB)

lo        Link encap:本地环回  
          inet 地址:127.0.0.1  掩码:255.0.0.0
          inet6 地址: ::1/128 Scope:Host
          UP LOOPBACK RUNNING  MTU:65536  跃点数:1
          接收数据包:2266 错误:0 丢弃:0 过载:0 帧数:0
          发送数据包:2266 错误:0 丢弃:0 过载:0 载波:0
          碰撞:0 发送队列长度:1
          接收字节:255758 (255.7 KB)  发送字节:255758 (255.7 KB)
```
如果要 **在eth0网卡设备上添加两个IP别名192.168.8.43和192.168.8.44，可以通过以下的ifconfig和route命令** 来进行：
```shell
/sbin/ifconfig eth0:1 192.168.8.43 broadcast 192.168.8.255 netmask 255.255.255.0 up
/sbin/route add -host 192.168.8.43 dev eth0:1

/sbin/ifconfig eth0:2 192.168.8.44 broadcast 192.168.8.255 netmask 255.255.255.0 up
/sbin/route add -host 192.168.8.44 dev eth0:2
```
这时，再执行ifconfig命令，就可以看到eth0网卡设备上绑定了两个IP别名。从另外一台服务器 Ping 192.168.8.43和
192.168.8.44两个IP，如果能够Ping通过，则证明配置无误。**但是，通过ifconfig和route配置的IP别名在服务器重启
之后会消失，不过可以将这两条ifconfig和route命令添加到/etc/rc.local文件中，让系统开机时自动运行**。

接下来在Nginx配置文件（nginx.conf）中，分别对192.168.8.43、192.168.8.44、192.168.8.45三个IP配置
三个纯静态HTML支持的虚拟主机，代码如下：
```shell
http {
  # 第一个虚拟主机
  server {
    # 监听的IP和端口
    listen 192.168.8.43:80;
    # 主机名称
    server_name 192.168.8.43;
    # 访问日志文件存放路径
    access_log logs/server1.access.log combined;
    location / {
      # 默认首页文件，顺序从左到右，如果找不到index.html文件，则查找index.htm文件作为首页文件
      index index.html index.htm;
      # HTML网页文件存放的目录
      root /data0/htdocs/server1;
    }
  }

  # 第二个虚拟主机
  server {
    # 监听的IP和端口
    listen 192.168.8.44:80;
    # 主机名称
    server_name 192.168.8.44;
    # 访问日志文件存放路径
    access_log logs/server2.access.log combined;
    location / {
      # 默认首页文件，顺序从左到右，如果找不到index.html文件，则查找index.htm文件作为首页文件
      index index.html index.htm;
      # HTML网页文件存放的目录
      root /data0/htdocs/server2;
    }
  }

  # 第三个虚拟主机
  server {
    # 监听的IP和端口
    listen 192.168.8.45:80;
    # 主机名称
    server_name 192.168.8.45;
    # 访问日志文件存放路径
    access_log logs/server3.access.log combined;
    location / {
      # 默认首页文件，顺序从左到右，如果找不到index.html文件，则查找index.htm文件作为首页文件
      index index.html index.htm;
      # HTML网页文件存放的目录
      root /data0/htdocs/server2;
    }
  }
}
```
