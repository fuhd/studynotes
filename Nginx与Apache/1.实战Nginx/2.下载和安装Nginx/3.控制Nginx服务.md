控制Nginx服务
================================================================
### 守护进程和服务
计算机应用程序有两个类型————有的需要用户在前端输入命令后立即运行，有的则不然，运行于后台。**Nginx属于后者，
即经常提及的作为守护进程运行的那种程序**。守护进程的名称后通常带有“d”字样。这里有几个例子————`httpd`是hTTP
服务器的守护进程，`named`是域名服务器的守护进程，`crond`是任务调度程序的守护进程。然而，需要注意，Nginx不是
这种情况。从命令行启动Nginx的时候，守护进程会立即返回到命令行提示符，在大多数情况下，用不着向终端屏幕输出数据。

因此，**启动Nginx的时候，屏幕上不会出现任何文本信息，并且提示符会立即返回**。

### 用户和组
一个最普遍的麻烦来源是：**对Nginx设置的是一个无效的访问权限的时候————由于用户或用户组的错误配置**，
经常会报告“403 forbidden”错误，因为Nginx不能访问你需要的文件。根据进程的功能，可能需要 **两个不同级别的进程权限**：

1. Nginx的master进程，由root启动，在大多数类Unix系统上，由root帐户开启的进程允许在开放任何端口的的TCP套接字，
但是其他用户启动的程序只能监听在1024以上的端口。如果不是以root帐户启动Nginx，将无法得到标准的端口（如80或443），即无法启动。
而且，通过user指令在配置文件中指定的用户和组用于工作进程，在这里不考虑。

2. Nginx的工作进程，由配置文件中user指令指定的帐户开始运行，配置文件中的设置优先于在配置时使用configure脚本开关选项指定的用户。
如果没有做任何指定，工作进程将以用户nobody开始，用户组为nobody组

### Nginx命令行开关项
Nginx二进制文件接收命令行参数，用于执行各种操作，控制后台进程。为了获取该命令的全部参数列表，可以请求help帮助：
```shell
cd /usr/local/nginx/sbin
./nginx -h
```

### 启动和停止守护进程
可以通过不带任何参数的Nginx二进制文件来启动Nginx。如果该守护进程已经运行，就会有一条消息指出已经有一个套接字在指定端口监听：
```shell 
./nginx
```
如果有守护进程已经在运行，结果如下：
```
nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
nginx: [emerg] still could not bind()
```
除了这一点，你可以控制这个守护进程，可以停止它，重启它，或只是重新载入配置文件，控制是通过 **nginx -s 命令** 向进程发送信号来实现的：

|命令             |描述                        |
|:---------------|:---------------------------|
|nginx -s stop | 立即停止守护进程（使用TERM信号）|
|nginx -s quit | 温和地停止守护进程（使用QUIT信号）|
|nginx -s reopen | 重新打开日志文件 |
|nginx -s reload | 重新载入配置文件 | 

**注意**，在开始运行这个守护进程，停止它或执行前面说的任何操作时，**会首先解析和确认配置文件，如果配置文件无效，不管提交什么命令，都会失败**，
甚至是试图停止一个守护进程。换句话说，如果配置文件无效，兴许无法停止Nginx服务。

有一种替代方法可以终止该进程，**只适用于危急情况**，即使用 **kill** 或 **killall** 命令：
```shell
killall nginx
```

### 测试配置文件
在配置文件中，任何不起眼的错误都可能导致你丧失对服务的控制权——可能无法以正常的方式停止服务，显而易见，服务拒绝运行。
因此，在很多情况下，下列命令是很有用的，可以检测语法，合法性和配置文件的完整性：
```shell
nginx -t
```
**开关选项 -t 代表测试配置文件**。Nginx将重新解析配置文件，让你知道配置文件是否有效。

一个最好的实践是 **将新配置放在一个单独的临时文件中，然后再对该文件进行测试**。Nginx提供了一个 **-c 选项**，便可进行这种测试：
```shell 
./nginx -t -c /home/alex/test.conf
```
该命令将解析配置文件 /home/alex/test.conf，确定它作为Nginx配置文件的有效性。此后，再 **覆盖** 原来配置文件，
然后 **重新载入** 服务器配置文件：
```shell 
cp /home/alex/test.conf /usr/local/nginx/conf/nginx.conf
./nginx -s reload
```

### 其他开关选项
许多情况下迟早都会用到： **-V 选项**，不但会告诉你当前Nginx的版本号，更重要的是还会 **提醒你在configure脚本那一步所添加的开关选项**，
换句话说，该开关选项将 **显示你在使用运行configure脚本配置的各种开关选项**。










































