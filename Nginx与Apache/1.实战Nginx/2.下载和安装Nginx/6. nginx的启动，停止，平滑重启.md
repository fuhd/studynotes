nginx的启动，停止，平滑重启
===============================================

### nginx的启动 
启动nginx，可以执行以下命令。假设nginx安装在 /usr/local/nginx/目录中，那么启动nginx的命令就是：
```shell
/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf 
```
**参数 "-c" 指定了配置文件的路径**，如果不加 "-c" 参数，nginx会默认加载其安装目录的conf子目录中的nginx.conf。

### nginx停止
nginx的停止方法有很多种，**一般通过发送系统信号给nginx主进程的方式来停止nginx**。我们可以通过 **ps命令** 来查找nginx的主进程号：
```shell
ps -ef | grep nginx
```
通过这个命令可以从屏幕上看到1个nginx进程的备注信息为**“master process”**，表示它为主进程，另外几个进程备注为**“worker process”**，
表示它们为子进程。

如果在nginx.conf配置文件中指定了pid文件存放的路径（例如：pid /usr/local/webserver/nginx/logs/nginx.pid;），
**该文件中存放的就是nginx当前主进程号**。如果没有指定pid文件存放的路径，nginx.pid文件默认存放在nginx安装目录的logs目录下。
所以，我们可以直接通过以下命令来完成平滑重启，省下寻找nginx主进程号的步骤：
```shell 
kill -信号类型 `/usr/local/webserver/nginx/logs/nginx.pid`
```

1. 从容停止nginx
```shell
kill -QUIT nginx主进程号

#或者：

kill -QUIT `/usr/local/webserver/nginx/logs/nginx.pid`
```

2. 快速停止nginx
```shell 
kill -TERM nginx主进程号
kill -TERM `/usr/local/webserver/nginx/logs/nginx.pid`

或者： 

kill -INT nginx主进程号
kill -INT `/usr/local/webserver/nginx/logs/nginx.pid`
```

3. 强制停止所有nginx进程
```shell 
pkill -9 nginx
```

### nginx的平滑重启
如果改变了nginx的配置文件（nginx.conf），想重启nginx，同样可以通过发送系统信号给nginx主进程的方式来进行。
不过，重启之前，要确认nginx配置文件（nginx.conf）的语法是正确的，否则nginx将不会加载新的配置文件。 
通过以下命令可以判断nginx配置文件是否正确，示例：
```shell
/usr/local/webserver/nginx/sbin/nginx -t -c /usr/local/webserver/nginx/conf/nginx.conf
```
如果配置文件正确，屏幕将提示以下两行信息：
```
the configuration file /usr/local/webserver/nginx/conf/nginx.conf syntax is ok 
configuration file /usr/local/webserver/nginx/conf/nginx.conf test is successful
```
这时候，就可以平滑重启nginx了。
```shell
kill -HUP nginx主进程号
```
或者：
```shell 
kill -HUP `/us/local/webserver/nginx/logs/nginx.pid`
```
当nginx接收到HUP信息时，它会尝试先解析配置文件，如果成功，就应用新的配置文件。之后，nginx运行新的工作进程并从容关闭
旧的工作进程

**注意：新版本的nginx中，已经有更好的办法(./nginx -s reload 命令)平滑重启**

