配置
===============================================================
在分布式系统中为了 **解决单点问题，通常会把数据复制多个副本部署到其他机器**，满足故障恢复和负载无均衡等需求。
Redis也是如此，它为我们提供了复制功能，实现了相同数据的多个Redis副本。**复制功能是高可用Redis的基础**，
后面章节的 **哨兵** 和 **集群** 都是 **在复制的基础上实现高可用的**。

### 配置

#### 建立复制
参与复制的Redis实例划分为 **主节点（master）** 和 **从节点（slave）。默认情况下，Redis都是主节点。
每个从节点只能有一个主节点，而主节点可以同时具有多个从节点。复制的数据流是单向的，只能由主节点复制到从节点**。

配置复制的方式有以下三种：
+ **在配置文件中加入slaveof {masterHost} {masterPort} 随Redis启动生效**。
+ **在redis-server启动命令后加入 --slaveof {masterHost} {masterPort}**。
+ **直接使用命令：slaveof {masterHost} {masterPort} 生效**。

综上所述，slaveof命令在使用时，可以运行期动态配置，也可以提前写到配置文件中。例如本地启动两个端口为
6379和6380的Redis节点，在127.0.0.1:6380执行如下命令：
```shell
127,0.0.1:6380>slaveof 127.0.0.1 6379
```
slaveof配置都是在从节点发起，这时6379作为主节点，6380作为从节点。复制关系建立后执行如下命令测试：
```shell
127.0.0.1:6379> set hello redis
OK
127.0.0.1:6379> get hello
"redis"
127.0.0.1:6380> get hello
"redis"
```
上例中，针对主节点6379的任何修改都可以同步到从节点6380中。

**slaveof本身是异步命令，执行slaveof命令时，节点只保存主节点信息后返回，后续复制流程在节点内部异步执行**。
主从节点复制成功建立后，可以 **使用info replication命令查看复制相关状态**。

1. 主节点6379复制状态信息：
```shell
127.0.0.1:6379> info replication
# replication
role:master
commected_slaves:1
slave0:ip=127.0.0.1,port=6379,state=online,offset=43,lag=0
```
