数据同步
====================================================================
Redis在 **2.8及以上版本** 使用 **`psync`命令** 完成主从数据同步，同步过程分为：**全量复制** 和 **部分复制**。
+ **全量复制**：**一般用于初次复制场景**，Redis早期支持的复制功能只有全量复制，**它会把主节点全部数据一次性发送给从节点**，
当数据量较大时，会对主从节点和网络造成很大的开销。
+ **部分复制**：用于处理在主从复制中 **因网络闪断等原因造成的数据丢失场景，当从节点再次连上主节点后，
如果条件允许，主节点会补发丢失数据给从节点**。因为补发的数据远远小于全量数据，可以有效避免全量复制的过高开销。

**部分复制是对老版本复制的重大优化，有效避免了不必要的全量复制操作**。因此当使用复制功能时，尽量采用2.8以上版本的Redis。

`psync`命令运行需要以下组件支持：
+ **主从节点各自复制偏移量**。
+ **主节点复制积压缓冲区**。
+ **主节点运行id**。

### 复制偏移量
**参与复制的主从节点都会维护自身复制偏移量**。主节点在处理完写入命令后，会把命令的字节长度做累加记录，
统计信息在`info replication`中的 **`master repl_offset`指标** 中：
```
127.0.0.1:6379> info replication
# Replication
role:master
...
master_repl_offset:1055130
```
**从节点每秒钟上报自身复制偏移量给主节点**，因此主节点也会保存从节点的复制偏移量，统计指标如下：
```
127.0.0.1:6379> info replicationconnected_slaves:1
slave0:ip=127.0.0.1,port=6380,state=online,offset=1055214,lag=1
...
```
**从节点在接收到主节点发送的命令后，也会累加记录自身的偏移量**。统计信息在`info replication`中的
`slave_repl_offset`指标中：
```
127.0.0.1:6380> info replication
# Replication
role:slave
...
slave_repl_offset:1055214
```
