全量复制
==============================================================
全量复制是Redis最早支持的复制方式，**也是主从第一次建立复制时必须经历的阶段**。触发全量复制的命令是
`sync`和 **`psync`**，这里主要介绍`psync`全量复制流程，它与2.8以前的`sync`全量复制机制基本一致。

流程说明：

1. **发送`psync`命令进行数据同步**，由于是第一次进行复制，从节点没有 **复制偏移量** 和 **主节点的运行ID**，
所以发送：**`psync ? -1`**。

2. 主节点根据`psync ? -1`解析出当前为全量复制，回复：**`+FULLRESYNC`** 响应。

3. **从节点** 接收主节点的响应数据保存 **运行ID** 和 **偏移量`offset`**。

4. **主节点执行`bgsave`保存RDB文件到本地**。

5. **主节点发送RDB文件给从节点**，从节点把接收的RDB文件保存在本地并直接作为从节点的数据文件。
   **注意：** 对于数据量较大的主节点，比如生成的 **RDB文件超过6GB以上** 时要格外小心。传输文件这一步操作非常耗时，
   速度取决于主从节点之间网络带宽，通过细致分析 **`Full resync`** 和 **`MASTER<->SLAVE`** 这两行日志的时间差，
   可以算出RDB文件从创建到传输完毕消耗的总时间。如果总时间超过 **`repl-timeout`所配置的值（默认60秒），
   从节点将放弃接受RDB文件并清理已经下载的临时文件**。针对数据量较大的节点，建议调大`repl-timeout`参数防止
   出现全量同步数据超时。

6. 对于从节点开始接收RDB快照到接收完成期间，主节点仍然响应读写命令，因此 **主节点会把这期间写命令数据保存在复制客户端缓冲区内**，
   当从节点加载完RDB文件后，主节点再把缓冲区内的数据发送给从节点，保证主从之间数据一致性。如果主节点创建和传输
   RDB的时间过长，**对于高流量写入场景非常容易造成主节点复制客户端缓冲区溢出**。
   **默认配置为`client-output-buffer-limit slave 256MB 64MB 60`**，如果 **60秒** 内缓冲区消耗持续大于 **64MB** 或者
   直接超过 **256MB** 时，主节点将直接关闭复制客户端连接，造成全量同步失败。因此，运维人员需要根据主节点数据量和
   写命令并发量调整`client-output-buffer-limit slave`配置，避免全量复制期间客户端缓冲区溢出。
   对于主节点，当发送完所有的数据后就认为全量复制完成，打印成功日志：`Synchronization with slave 127.0.0.1:6380 succeeded`,
   但是对于从节点全量复制依然没有完成，还有后续步骤需要处理。

7. **从节点接收完主节点传送来的全部数据后会清空自身旧数据**。

8. **从节点清空数据后开始加载RDB文件**，对于较大的RDB文件，这一步操作依然比较耗时。对于线上做 **读写分离** 的场景，
   **从节点也负责响应读命令**。如果此时从节点正出于全量复制阶段或者复制中断，那么从节点在响应读命令可能拿到过期或错误的数据。
   对于这种场景，Redis复制提供了 **`slave-serve-stale-data`** 参数，**默认开启状态。如果开启则从节点依然响应所有命令**。
   对于无法容忍不一致的应用场景可以设置no来关闭命令执行，此时
