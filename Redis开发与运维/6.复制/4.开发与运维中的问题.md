开发与运维中的问题
================================================================
### 读写分离
对于 **读占比较高** 的场景，可以通过 **把一部分流量分摊到从节点（slave）** 来减轻主节点（master）压力，同时需要注意
**永远只对主节点执行写操作**。

当使用从节点响应读请求时，业务端可以会遇到如下问题：
+ **复制数据延迟**；
+ **读到过期数据**；
+ **从节点故障**；

#### 数据延迟
Redis复制数据的 **延迟由于异步复制特性是无法避免的**，延迟取决于网络带宽和命令阻塞情况，比如刚在主节点写入数据
后立刻在从节点上读取可能获取不到。需要业务场景允许短时间内的数据延迟。对于无法容忍大量延迟场景，
可以 **编写外部监控程序监听主从节点的复制偏移量**，当延迟较大时触发报警或者通知客户端避免读取延迟过高的从节点。
1. 监控程序（monitor）定期检查主从节点的偏移量，主节点偏移量在`info replication`的 **`master_repl_offset`** 指标记录，
从节点偏移量可以查询主节点的 **`slave0`字段的`offset`** 指标，它们的 **差值** 就是主从节点延迟的字节量。
2. 当延迟字节量过高时，比如超过10MB。**监控程序触发报警并通知客户端从节点延迟过高**。可以采用`zookeeper`的监听
回调机制实现客户端通知。
3. 客户端接到具体的从节点高延迟通知后，**修改读命令路由到其他从节点或主节点上**。当延迟恢复后，再次通知客户端，
恢复从节点的读命令请求。

**这种方案的成本比较高**，需要单独修改适配Redis的客户端类库。如果涉及到多种语言成本将会扩大。

#### 读到过期数据
