原理之复制过程
==================================================================
在从节点执行`slaveof`命令后，复制过程便开始动作。复制过程大致分为6个过程：

### 保存主节点（master）信息
**执行`slaveof`命令后从节点只保存主节点的地址信息便直接返回，这时建立复制流程还没有开始**，以前一章节
的示例，在从节点6380执行`info replication`可以看到如下信息：
```
master_host:127.0.0.1
master_port:6379
master_link_status:down
```
从统计信息可以看出，主节点的`ip`和`port`被保存下来，但是主节点的连接状态（`master_link_status`）
是下线状态。

### 从节点（slave）内部通过每秒运行的定时任务维护复制相关逻辑
**当定时任务发现存在新的主节点后，会尝试与该节点建立网络连接。从节点会建立一个`socket`套接字，专门用于
接受主节点发送的复制命令**。从节点连接成功后打印如下日志：
```
* Connecting to MASTER 127.0.0.1:6379
* MASTER <-> SLAVE sync started
```
**如果从节点无法建立连接，定时任务会无限重试直到连接成功或者执行`slaveof no one`取消复制**。
关于连接失败，**可以在从节点执行`info replication`查看`master_link_down_since_seconds`指标，
它会记录与主节点连接失败的系统时间**。从节点连接主节点失败时也会每秒打印如下日志：
```
# Error condition on socket for SYNC: (socket_error_reason)
```

### 发送ping命令
连接建立成功后从节点发送`ping`请求进行首次通信，`ping`请求主要目的如下：
+ **检测主从之间网络套接字是否可用**。
+ **检测主节点当前是否可接受处理命令**。
**如果发送`ping`命令后，从节点没有收到主节点的`pong`回复或者超时，比如网络超时或者主节点正在阻塞无法响应命令，
从节点会断开复制连接，下次定时任务会发起重连**。

从节点发送`ping`命令成功返回，Redis打印如下日志，并继续后续复制流程：
```
Master replied to PING, replication can continue...
```

### 权限验证
如果主节点设置了 **`requirepass`参数**，则需要密码验证，**从节点必须配置`masterauth`参数保证与主节点相同的密码
才能通过验证**；如果验证失败复制将终止，从节点重新发起复制流程。
