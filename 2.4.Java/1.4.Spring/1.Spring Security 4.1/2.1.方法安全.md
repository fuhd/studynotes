方法安全
=======================================================================
从`2.0`版本开始，`Spring Security`开始对服务层的方法提供事实上的安全支持。其提供对`JSR-250`中注解的支持，
同时自身提供了 **`@Secured`** 注解。从`3.0`开始，你可以使用 **基于表达式的注解**。你可以针对单独的某个`Bean`应用安全策略，
使用拦截方法来装饰`Bean`的声明，或者你可以 **`Aspect`风格** 的切点来对整个`service`层中多个`Bean`进行安全保护。

### @EnableGlobalMethodSecurity
我们可以通过 **在任何`@Configuration`实例上使用`@EnableGlobalMethodSecurity`开启基于注解的安全验证**。例如，
如下配置将会使`SpringSecurity`的 **`@Secured`注解** 生效。
```java
@EnableGlobalMethodSecurity(securedEnabled = true)
public class MethodSecurityConfig {
    // ...
}
```
**添加一个注解到一个方法(或者类、接口)将会限制对这个方法的访问**。`Spring Secuirty`自带的注解支持为方法定义一列属性。
这将会被传递给`AccessDecisionManager`来做出事实上的决定。
```java
public interface BankService {
    @Secured("IS_AUTHENTICATED_ANONYMOUSLY")
    public Account readAccount(Long id);

    @Secured("IS_AUTHENTICATED_ANONYMOUSLY")
    public Account[] findAccounts();

    @Secured("ROLE_TELLER")
    public Account post(Account account, double amount);
    }
```
支持 **`JSR-250`的注解** 可以通过使用：
```java
@EnableGlobalMethodSecurity(jsr250Enabled = true)
public class MethodSecurityConfig {
    // ...
}
```
以下是基于标准的，并且允许简单的基于角色的约束。但是并不具备`Spring Security’s`原生注解的能力。
要使用基于表达式的语法，你要使用：
```java
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class MethodSecurityConfig {
    // ...
}
```
对应的`Java`代码是：
```java
public interface BankService {
    @PreAuthorize("isAnonymous()")
    public Account readAccount(Long id);

    @PreAuthorize("isAnonymous()")
    public Account[] findAccounts();

    @PreAuthorize("hasAuthority('ROLE_TELLER')")
    public Account post(Account account, double amount);
}
```

### GlobalMethodSecurityConfiguration
有的时候你可能需要执行一些比`@EnableGlobalMethodSecurity`所支持的更加复杂的操作。对于这些，你可以扩展
`GlobalMethodSecurityConfiguration`来保证`@EnableGlobalMethodSecurity`注解位于你的子类上。例如，
你想提供一个自定义的`MethodSecurityExpressionHander`，你可以使用以下的配置：
```java
@EnableGlobalMethodSecurity(prePostEnabled = true)
public class MethodSecurityConfig extends GlobalMethodSecurityConfiguration {
    @Override
    protected MethodSecurityExpressionHandler createExpressionHandler() {
        // ... create and return custom MethodSecurityExpressionHandler ...
        return expressionHander;
    }
}
```
