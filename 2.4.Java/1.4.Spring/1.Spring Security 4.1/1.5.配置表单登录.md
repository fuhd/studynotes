配置表单登录
====================================================================
你可能想知道登录表单页面来自于什么地方，你什么时候会被提示需要登录。由于在之前的配置中我们并没有显示的指定登录表单的页面`URL`，
`Spring Security`就会自动生成一个登录页面，并且对用户的登录操作进行处理。

在开始学习的时候，使用`Spring security`自动生成的登录页面，是一个很好的开始。但是，大多数情况下，我们可能会希望使用自己的登录页面。
此时我们可以按照类似以下的方式配置：
```java
protected void configure(HttpSecurity http) throws Exception {
    http.authorizeRequests()
        .anyRequest()
        .authenticated()
        .and()
        .formLogin()
        .loginPage( "/login")           //1
        .permitAll();                   //2
}
```
+ 1处：更新后的配置，指定了登录页面的位置；
+ 2处：我们必须允许所有的用户，不管是否登录，都可以访问这个页面。 `formLogin().permitAll()`允许所有用户访问这个页面。

以下是一个`JSP`形式登录页面的实现：
```jsp
<c:url value="/login" var="loginUrl"/>
<form action="${loginUrl}" method="post">
    <c:if test="${param.error != null}" >
        <p>
            Invalid username and password.
        </p>
    </c:if>
    <c:if test="${param.logout != null}" >
        <p>
            You have been logged out.
        </p>
    </c:if>
    <p>
        <label for="username" >Username</ label>
        <input type="text" id="username" name="username" />
    </p>
    <p>
        <label for="password" >Password</ label>
        <input type="password" id="password" name="password" />
    </p>
    <input type="hidden" name="${_csrf.parameterName}" value="${_csrf.token}" />
    <button type="submit" class="btn"> Log in</button >
</form>
```

### 源码解读
在这里，`SpringSecurity`强制要求我们的表单登录页面必须是以`POST`方式向`/login URL`提交请求，**而且要求用户名和密码的
参数名必须是`username`和`password`**。如果不符合，则不能正常工作。

原因在于，当我们调用了`HttpSecurity`对象的`formLogin`方法时，其最终会给我们注册一个过滤器
 **`UsernamePasswordAuthenticationFilter`**。我们来看一下这个过滤器的源码：
 ```java
 public class UsernamePasswordAuthenticationFilter extends AbstractAuthenticationProcessingFilter {
     // ~ Static fields/initializers
     // =====================================================================================
     public static final String SPRING_SECURITY_FORM_USERNAME_KEY = "username";//默认的用户名参数名
     public static final String SPRING_SECURITY_FORM_PASSWORD_KEY = "password";//默认的密码参数名
     
     private String usernameParameter = SPRING_SECURITY_FORM_USERNAME_KEY;
     private String passwordParameter = SPRING_SECURITY_FORM_PASSWORD_KEY;
     private boolean postOnly = true;
     // ~ Constructors
     // ===================================================================================================
     
    public UsernamePasswordAuthenticationFilter() {
        super(new AntPathRequestMatcher("/login", "POST"));//只对POST请求方式的/login进行拦截
    }
    ...
}
 ```