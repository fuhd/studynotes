Spring Security 11种常用过滤器介绍
=======================================================================
### HttpSessionContextIntegrationFilter
**位于过滤器顶端，第一个起作用的过滤器**。

**用途一**，在执行其他过滤器之前，率先判断用户的`session`中是否已经存在一个`SecurityContext`了。
如果存在，就把`SecurityContext`拿出来，放到`SecurityContextHolder`中，供`SpringSecurity`的其他部分使用。
如果不存在，就创建一个`SecurityContext`，还是放到`SecurityContextHolder`中，供`SpringSecurity`的其他部分使用。

**用途二**，在所有过滤器执行完毕后，清空`SecurityContextHolder`，因为`SecurityContextHolder`是基于
`ThreadLocal`的，如果在操作完成后清空`ThreadLocal`，会受到服务器的线程池机制的影响。

### LogoutFilter
**只处理注销请求，默认为`/j_spring_security_logout`**。

用途是在用户发送注销请求时，销毁用户`session`，清空`SecurityContextHolder`，然后重定向到注销成功页面。
可以与`rememberMe`之类的机制结合，在注销的同时清空用户`cookie`。

### AuthenticationProcessingFilter
**处理`form`登陆的过滤器，与`form`登陆有关的所有操作都是在此进行的**。

默认情况下只处理`/j_spring_security_check`请求，这个请求应该是用户使用`form`登陆后的提交地址。

此过滤器执行的基本操作是，通过用户名和密码判断用户是否有效，如果登录成功就跳转到成功页面（可能是登陆之前访问的受保护页面，
也可能是默认的成功页面），如果登录失败，就跳转到失败页面。

### DefaultLoginPageGeneratingFilter
**此过滤器用来生成一个默认的登录页面**，默认的访问地址为`/spring_security_login`，这个默认的登录页面虽然支持用户输入用户名，
密码，也支持`rememberMe`功能，但是因为太难看了，只能是在演示时做个样子，不可能直接用在实际项目中。

### BasicProcessingFilter
**此过滤器用于进行`basic`验证**，功能与`AuthenticationProcessingFilter`类似，只是验证的方式不同。

### SecurityContextHolderAwareRequestFilter
**此过滤器用来包装客户的请求。目的是在原始请求的基础上，为后续程序提供一些额外的数据**。比如`getRemoteUser()`
时直接返回当前登陆的用户名之类的。

### RememberMeProcessingFilter
**此过滤器实现`RememberMe`功能**，当用户`cookie`中存在`rememberMe`的标记，此过滤器会根据标记自动实现用户登陆，
并创建`SecurityContext`，授予对应的权限。

在配置文件中使用`auto-config="true"`就会自动启用`rememberMe`。

实际上，`Spring Security`中的`rememberMe`是依赖`cookie`实现的，当用户在登录时选择使用`rememberMe`，
系统就会在登录成功后将为用户生成一个唯一标识，并将这个标识保存进`cookie`中，我们可以通过浏览器查看用户电脑中的`cookie`。

### AnonymousProcessingFilter
为了保证操作统一性，**当用户没有登陆时，默认为用户分配匿名用户的权限**。在配置文件中使用`auto-config="true"`就会启
用匿名登录功能。

### ExceptionTranslationFilter
此过滤器的作用是处理中`FilterSecurityInterceptor`抛出的异常，然后将请求重定向到对应页面，
或返回对应的响应错误代码。

### SessionFixationProtectionFilter
**防御会话伪造攻击**。解决`session fix`的问题其实很简单，只要在用户登录成功之后，销毁用户的当前`session`，
并重新生成一个`session`就可以了。

### FilterSecurityInterceptor
用户的权限控制都包含在这个过滤器中。
+ **功能一**：如果用户尚未登陆，则抛出`AuthenticationCredentialsNotFoundException`“尚未认证异常”。
+ **功能二**：如果用户已登录，但是没有访问当前资源的权限，则抛出`AccessDeniedException`“拒绝访问异常”。
+ **功能三**：如果用户已登录，也具有访问当前资源的权限，则放行。

### 标准过滤器别名和顺序

| 别名 | 过滤器类 | 命名空间元素或属性 |
|:-----|:-------|:----------------|
| CHANNEL_FILTER | ChannelProcessingFilter | http/intercept-url@requires-channel |
| SECURITY_CONTEXT_FILTER | SecurityContextPersistenceFilter | http |
| CONCURRENT_SESSION_FILTER	| ConcurrentSessionFilter | session-management/concurrency-control |
| LOGOUT_FILTER | LogoutFilter | http/logout |
| X509_FILTER | X509AuthenticationFilter | http/x509 |
| PRE_AUTH_FILTER | AbstractPreAuthenticatedProcessingFilter Subclasses | N/A |
| CAS_FILTER | CasAuthenticationFilter | N/A |
| FORM_LOGIN_FILTER | UsernamePasswordAuthenticationFilter | http/form-login |
| BASIC_AUTH_FILTER | BasicAuthenticationFilter | http/http-basic |
| SERVLET_API_SUPPORT_FILTER | SecurityContextHolderAwareRequestFilter | http/@servlet-api-provision |
| JAAS_API_SUPPORT_FILTER | JaasApiIntegrationFilter | http/@jaas-api-provision |
| REMEMBER_ME_FILTER | RememberMeAuthenticationFilter | http/remember-me |
| ANONYMOUS_FILTER | AnonymousAuthenticationFilter | http/anonymous |
| SESSION_MANAGEMENT_FILTER | SessionManagementFilter | session-management |
| EXCEPTION_TRANSLATION_FILTER | ExceptionTranslationFilter | http |
| FILTER_SECURITY_INTERCEPTOR | FilterSecurityInterceptor | http |
| SWITCH_USER_FILTER | SwitchUserFilter | N/A | 

上面的表格中列出了命名空间中支持的所有标准过滤器以及它们对应的顺序，这些过滤器的顺序是至关重要的，
只有按照正确的顺序进行配置才能让这些过滤器正常发挥作用，在`ACEGI`的年代有太多太多的问题都是由于过滤器摆放的位置不正确造成的。
幸好我们现在可以使用命名空间，它会帮我们将使用到的过滤器按照正确的方式摆放在一起。







