证书管理之KeyTool证书管理
===============================================================
任何机构或个人都可以申请数字证书，并使用由`CA`机构颁发的数字证书为自己的应用帮保驾护航。

要获得数字证书，我们需要使用数字证书管理工具（如 **`KeyTool`** 和 **`OpenSSL`** ）构建CSR
（`Certificate Signing Request`，数字证书签发申请），交由CA机构签发，形成最终的数字证书。

**`KeyTool`是Java中的数字证书管理工具，用于数字证书的申请、导入、导出和撤销等操作**。
`KeyTool`与本地密钥库相关联，**将私钥存于密钥库，公钥则以数字证书输出**。`KeyTool`位于`%JAVA_HOME%\bin`目录中，
需要通过命令行进行相应的操作。

### 构建自签名证书
申请数字证书之前，需要在密钥库中以 **别名** 的方式生成本地数字证书，建立相应的 **加密算法、密钥、有效期等信息**，
同时需要提供 **用户身份信息**，我们可以为自己签发一个数字证书（即自签名证书）。

这里我们使用“`www.zlex.org`”作为别名，使用`RSA`作为加密算法，并规定密钥长度为`2048`位，使用`SHA1withRSA`
作为数字签名算法，欲签发有效期为`36000`天的数字证书。完整命令如下：
```shell
$ keytool -genkeypair -keyalg RSA -keysize 2048 -sigalg SHA1withRSA -validity 36000
    -alias www.zlex.org -keystore zlex.keystore
```
各参数的含义如下：

| 参数 | 描述 |
|:-----|:-----|
| **-genkeypair** | **表示生成密钥** |
| **-keyalg** | **指定密钥算法，这里指定为`RSA`算法** |
| **-keysize** | **指定密钥长度，默认1024位，这里指定为2048位** |
| **-sigalg** | **指定数字签名算法，这里指定为`SHA1withRSA`算法** |
| **-validity** | **指定证书有效期，这里指定为`36000`天** |
| **-alias** | **指定别名，这里是`www.zlex.org`** |
| **-keystore** | **指定密钥库存储位置，这里是`zlex.keystore`** |

**`KeyTool`工具支持`RSA`和`DSA`共2种算法，且`DSA`算法为默认算法**。

执行上述命令后，可按相应的提示输入用户的相关信息，如：
```
输入keystore密码：******
再次输入新密码：******
您的名字与姓氏是什么？
[Unknown]: www.zlex.org
您的组织单位名称是什么？
[Unknown]: zlex
您的组织名称是什么？
[Unknown]: zlex
您所在的城市或区域名称是什么？
[Unknown]: BJ
您所在的州或省份名称是什么？
[Unknown]: BJ
该单位的两字母国家代码是什么
[Unknown]: CN
CN=www.zlex.org, OU=zlex, O＝zlex, L=BJ, ST=BJ,C=CN 正确吗？
[否]：Y
输入<www.zlex.org>的主密码（如果和keystore密码相同，按回车）：
```
这里我们输入密码：“`123456`”，也可通过参数 “**`-storepass`**” 指定密码“`123456`”。
以 "www.zlex.org" 作为用户的姓名。这里的用户并不是指代现实意义中的用户个体，而是指代网络环境中
的用户个体。因此，通常使用域名或带有通配符“`*`”的泛域名，如“`*.zlex.org`”标识用户身份。

我们可以使用参数 **`-dname`** 指定用户信息，代替上述手动输入用户信息。完整命令如下：
```shell
$ keytool -genkeypair -keyslg RSA -keysize 2048 -sigalg SHA1withRSA -validity 3600
    -alias www.zlex.org -keystore zlex.keystore -dname "CN=www.zlex.org, OU=zlex, 
    O=zlex, L=BJ, ST=BJ, C=CN"
```
经过上述操作后，密钥库中已经创建了数字证书。**虽然这时的数字证书并没有经过`CA`认证，
但并不影响我们使用。我们仍可以将数字证书导出，发送给合作伙伴进行加密交互**。完整命令如下：
```shell
# 导出数字证书
$ keytool -exportcert -alias www.zlex.org -keystore zlex.keystore -file zlex.cer -rfc
```
各参数的含义如下所示：

| 参数 | 描述 |
|:-----|:-----|
| **-exportcert** | **表示证书导出操作** |
| **-alias** | **指定导别名，这里为www.zlex.org** |
| **-keystore** | **指定密钥库文件，这里为zlex.keystore** |
| **-file** | **指定导出文件路径，这里为zlex.cer** |
| **-rfc** | **指定以Base64编码格式输出** |

这里我们输入密码“123456”，也可通过参数“ **`-storepass`**”指定密码“123456”，将获得数字证书文件“zlex.cer”。





