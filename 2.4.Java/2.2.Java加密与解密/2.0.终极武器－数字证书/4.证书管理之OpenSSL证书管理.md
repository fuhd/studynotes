证书管理之OpenSSL证书管理
===============================================================
`OpenSSL`(`http://www.openssl.org/`) 是一个开放源代码软件包，由`Eri A. Young`和`Tim J. Hudson`等人编写，
实现了`SSL`及相关加密技术，是最常用的证书管理工具。**`OpenSSL`功能远胜于`KeyTool`，可用于根证书、
服务器证书和客户证书的管理**。

### 准备工作
首先，我们需要 **构建一个CA工作目录**。
```shell
$ mkdir CA
```
建立`CA`工作目录后，我们需要 **构建一些子目录，用于存放证书、密钥等**，完整命令如下：
```shell
# 构建CA子目录
$ echo 构建已发行证书存放目录 certs
$ mkdir certs
$ echo 构建新证书存放目录 newcerts
$ mkdir newcerts
$ echo 构建私钥存入目录 private
$ mkdir private
$ echo 构建证书吊销列表存放目录 crl
$ mkdir crl
```
我们将在创建证书时用到上述目录，**最终在`certs`目录中获得证书文件**。接下来，
**我们需要构建一些文件**，完整命令如下：
```shell
# 构建相关文件
$ echo 构建索引文件 index
$ echo 0 > index
$ echo 构建序列号文件 serial
$ echo 01 > serial
```
完成上述操作后，我们就可以进行证书的构建和签发工作了。

### 构建根证书
**根证书是`CA`认证中心给自己颁发的证书,是信任链的起始点。安装根证书意味着对这个`CA`认证中心的信任。**
从技术上讲， **证书其实包含三部分，用户的信息，用户的公钥，还有CA中心对该证书里面的信息的签名。
验证一份证书的真伪（即验证`CA`中心对该证书信息的签名是否有效），需要用`CA`中心的公钥验证，
而`CA`中心的公钥存在于对这份证书进行签名的证书内，故需要下载该证书，但使用该证书验证又需先验证该证书本身的真伪，
故又要用签发该证书的证书来验证，这样一来就构成一条证书链的关系，**这条证书链在哪里终结呢？答案就是根证书，
根证书是一份特殊的证书，它的签发者是它本身，下载根证书就表明您对该根证书以下所签发的证书都表示信任，
而技术上则是建立起一个验证证书信息的链条，证书的验证追溯至根证书即为结束。所以说用户在使用自己的数字证书之前必须先下载根证书**。

#### 构建随机数文件
**在构建根证书前，需要构建随机数文件（`.rand`）**，完整命令如下：
```shell
# 构建随机数
$ echo 构建随机数 private/.rand
$ openssl rand -out private/.rand 1000
```
各参数的含义如下：

| 参数 | 描述 |
|:----|:-----|
| **rand** | **随机数命令** |
| **-out** | **输出文件路径，这里将随机数文件输出到private目录下** |

这里的参数1000，指用来产生 **伪随机字节数**。

#### 构建根证书密钥
**`OpenSSL`通常使用`PEM`(`Privacy Enbanced Mail`，隐私增强邮件)编码格式保存私钥**。
接下来，我们需要构建根证书密钥（`ca.key.pem`），完整命令如下：
```shell
# 构建根证书私钥
$ echo 构建根证书私钥 private/ca.key.pem
$ openssl genrsa -aes256 -out private/ca.key.pem 2048
```
各参数的含义如下：

| 参数 | 描述 |
|:-----|:-----|
| **genrsa** | **产生RSA密钥命令** |
| **-aes256** | **使用AES算法（256位密钥）对产生的私钥加密。可选算法包括DES、DESede、IDEA和AES** |
| **-out** | **输出路径，这里指private/ca.key.pem** |

这里的参数2048，指RSA密钥长度位数，**默认长度为512位**。上述的命令执行 **需要输入根证书密码**，如“123456”。

#### 生成根证书签发申请
完成密钥构建操作后，我们需要生成根证书签发申请文件（`ca.csr`），完整命令如下：
```shell
# 生成根证书签发申请
$ echo 生成根证书签发申请 private/ca.csr
$ openssl req -new -key private/ca.key.pem -out private/ca.csr -subj "/C=CN/ST=BJ/O=zlex/OU=zlex/CN=*.zlex.org"
```
各参数的含义如下：

| 参数 | 描述 |
|:----|:-----|
| **req** | **产生证书签发申请命令** |
| **-new** | **表示新请求** |
| **-key** | **密钥，这里为private/ca.key.pem文件** |
| **-out** | **输出路径，这里为private/ca.csr文件** |
| **-subj** | **指定用户信息，这里使用泛域名“*.zlex.org”作为用户名** |

执行上述命令后，需要输入根证书密码：“123456”。

**得到根证书签发申请文件后，我们可以将其发送给`CA`机构签发。当然，我们也可以自行签发根证书**。

#### 签发根证书



