伪共享
================================================================================
缓存系统中是以 **缓存行**（`cache line`）为单位存储的。缓存行是 **2的整数幂** 个连续字节，一般
为`32-256`个字节。最常见的缓存行大小是`64`个字节。**当多线程修改互相独立的变量时，如果这些变量共
享同一个缓存行，就会无意中影响彼此的性能，这就是伪共享**。**缓存行上的写竞争** 是运行在`SMP`系统
中并行线程实现可伸缩性最重要的限制因素。有人将伪共享描述成无声的性能杀手，因为从代码中很难看清楚是
否会出现伪共享。

**为了让可伸缩性与线程数呈线性关系，就必须确保不会有两个线程往同一个变量或缓存行中写。两个线程写同
一个变量可以在代码中发现。为了确定互相独立的变量是否共享了同一个缓存行，就需要了解内存布局**，或找个
工具告诉我们。**Intel VTune就是这样一个分析工具**。本文中我将解释Java对象的内存布局以及我们该如
何 **填充缓存行以避免伪共享**。

![伪共享](img/14.png)
