外部化配置
=====================
Spring Boot允许外部化你的配置，这样你能够在不同的环境下使用相同的代码。你可以使用 **properties** 文件，
**YAML** 文件，**环境变量** 和 **命令行参数** 来外部化配置。使用 `@Value`注解，可以直接将属性值注入
到你的beans中。

Spring Boot使用一个非常特别的`PropertySource`次序来允许对值进行合理的覆盖，需要以下面的次序考虑属性：

1. 命令行参数
2. 来自于`java:comp/env`的JNDI属性
3. Java系统属性（`System.getProperties`）
4. 操作系统环境变量
5. 只有在`random.*`里包含的属性会产生一个`RandomValuePropertySource`
6. 在打包的jar外的应用程序配置文件（`application.properties`，包含YAML和profile变量）
7. 在打包的jar内的应用程序配置文件（`application.properties`，包含YAML和profile变量）
8. 在`@Configuration`类上的`@PropertySource`注解。
9. 默认属性（使用`SpringApplication.setDefaultProperties`指定）

示例：
```java
import org.springframework.stereotype.*
import org.springframework.beans.factory.annotation.*

@Component
public class MyBean {
  @Value("${name}")
  private String name;
    //...
}
```
你可以将一个`application.properties`文件捆绑到jar内，用来提供一个合理的默认name属性值。
当运行在生产环境时，可以在jar外提供一个`application.properties`文件来覆盖name属性。

### 访问命令行属性
默认情况下，`SpringApplication`将任何可选的命令行参数（以'--'开头，比如，`--server.port=9000`）
转化为property，并将其添加到Spring Environment中。**命令行属性总是优先于其他属性源** 。

### application属性文件
`SpringApplication`将从以下位置加载`application.properties`文件，并把它们添加到Spring Environment中：

1. 当前目录下的一个`/config`子目录。
2. 当前目录。
3. 一个`classpath`下的`/config`包。
4. `classpath`根路径（root）。

这个列表是按 **优先级** 排序的（列表中位置靠前的将覆盖位置靠后的）。注：你可以使用YAML（.yml）文件
替代`properties`。

### 使用YAML代替properties
YAML是JSON的一个超集，也是一种方便的定义层次配置数据的格式。无论你何时将`SnakeYAML`库放到`classpath`下，
SpringApplication类都会自动支持YAML作为properties的替换。**注：** 使用`spring-boot-starter`会自动
提供`SnakeYAML`。
#### 加载YAML
Spring框架提供两个便利的类用于加载YAML文档，`YamlPropertiesFactoryBean`会将YAML作为properties来加载，
`YamlMapFactoryBean`会将YAML作为Map来加载。示例：
```yml
environments:
  dev:
    url: http://dev.bar.com
    name: Developer	Setup
  prod:
    url: http://foo.bar.com
    name: My Cool App
```
上面的YAML文档会被转化到下面的属性中：
```
environments.dev.url=http://dev.bar.com
environments.dev.name=Developer Setup
environments.prod.url=http://foo.bar.com
environments.prod.name=My Cool App
```
YAML列表被表示成使用`[index]`间接引用作为属性keys的形式，例如下面的YAML：
```yml
my:
  servers:
    - dev.bar.com
    - foo.bar.com
```
将会转化到下面的属性中：
```
my.servers[0]=dev.bar.com
my.servers[1]=foo.bar.com
```
使用Spring DataBinder工具绑定上面那样的属性（这是`@ConfigurationProperties`做的事）。
你需要确定目标bean中有个`java.util.List`或`java.util.Set`类型的属性，并且需要提供一个setter。
示例如下：
```java
@ConfigurationProperties(prefix="my")
public class Config{
  private List<String> servers = new ArrayList<String>();
  public List<String> getServers() {
    return this.servers;
  }
}
```
#### 在Spring环境中使用YAML暴露属性
`YamlPropertySourceLoader`类能够用于将YAML作为一个`PropertySource`导出到Spring Environment。
这允许你使用熟悉的 **`@Value`注解** 和 **占位符语法** 访问YAML属性。
#### Multi-profile YAML文档
你可以在单个文件中定义多个特定配置的YAML文档，并通过一个`spring.profiles key`标示应用的文档。示例：
```yml
server:
  address: 192.168.1.100
---
spring:
  profiles: development
server:
  address: 127.0.0.1
---
spring:
  profiles: production
server:
  address: 192.168.1.120
```
上面的例子中，如果`development`配置被激活，那`server.address`属性将是127.0.0.1。如果`development`和
`production`配置（profiles）没有启用，则该属性值将是192.168.1.100。

### 类型安全的配置属性
使用`@Value("${property}")`注解注入配置属性有时可能比较笨重，特别是需要使用多个`properties`或你的数据
本身有层次结构。为为控制和校验你的应用配置，Spring Boot提供一个允许强类型beans的替代方法来使用properties。
示例：
```java
@Component
@ConfigurationProperties(prefix="connection")
public class ConnectionSettings {
  private String username;
  private InetAddress remoteAddress;
  //	...	getters	and	setters
}
```
当`@EnableConfigurationProperties`注解应用于你的`@Configuration`时，任何被`@ConfigurationProperties`
注解的beans将自动被Environment属性配置。这种风格的配置特别适合与SpringApplication的外部YAML配置进行配置合使用。
```yml
#	application.yml
connection:
  username: admin
  remoteAddress: 192.168.1.1
#	additional	configuration	as	required
```
为了使用`@ConfigurationProperties` beans，你可以使用与其他任何bean相同的方式注入它们：
```java
@Service
public class MyService {
  @Autowired
  private ConnectionSettings connection;
  @PostConstruct
  public void openConnection() {
    Server server = new Server();
    this.connection.configure(server);
  }
}
```
你可以通过在`@EnableConfigurationProperties`注解中直接简单的列出属性类来快捷的注册`@ConfigurationProperties`
bean的定义：
```java
@Configuration
@EnableConfigurationProperties(ConnectionSettings.class)
public class MyConfiguration {

}
```
#### 第三方配置
正如使用`@ConfigurationProperties`注解一个类，你也可以在`@Bean`方法上使用它。当你需要绑定属性到不
受你控制的第三方组件时，这种方式非常有用。示例：
```java
@ConfigurationProperties(prefix = "foo")
@Bean
public FooComponent fooComponent() {
  //..............
}
```
#### 松散的绑定
Spring Boot使用一些宽松的规则用于绑定Environment属性到`@ConfigurationProperties` beans，
所以Environment属性名和bean属性名不需要精确匹配。常见的示例中有用的包括 **虚线** 分割（比如，
`context--path`绑定到`contextPath`）和将环境属性转为大定字母（比如，`PORT`绑定到`port`）,
示例：
```java
@Component
@ConfigurationProperties(prefix="person")
public class ConnectionSettings {
  private String firstName;
}
```
下面的属性名都能用于上面的`@ConfigurationProperties`类：

属性|说明
---|---
person.firstName|标准驼峰规则
person.first-name|虚线表示，推荐用于`.properties`和`.yml`文件中
PERSON_FIRST_NAME|大写形式，使用系统环境变量时推荐
