拾遗之org.hidetake:gradle-ssh-plugin插件
=======================================
该插件的最新版本为：1.1.4。它必须java6+和Gradle2.0+的支持。

### 添加插件依赖
```gradle
buildscript {
  repositories {
    jcenter()
  }
  dependencies {
    classpath 'org.hidetake:gradle-ssh-plugin:1.1.4'
  }
}

apply plugin: 'org.hidetake.ssh'
```

### 添加远程主机配置
该插件可以增加远程主机的容器到该项目。一个或多个主机能被添加到远程控制的闭包中。示例：
```gradle
remotes {
  web01 {
    role 'masterNode'
    host = '192.168.1.101'
    user = 'jenkins'
  }
  web02 {
    host = '192.168.1.102'
    user = 'jenkins'
  }
}
```

### 在task中运行一个SSH会话
调用`ssh.run`方法来运行一个或多个SSH会话，示例：
```gradle
task checkWebServer << {
  ssh.run {
    session(remotes.web01) {
      //execute ...
    }
    session(remotes.web02) {
      //execute ...
    }
  }
}
```
`ssh.run`方法将连接到所有远程主机（例如：web01和web02）。

### 获取SSH命令的结果
`ssh.run`方法将返回最后一个会话的结果。我们可以使用该方法来取回远程命令的结果。示例：
```gradle
task syncKernelParam << {
  def paramKey = 'net.core.wmem_max'
  def paramValue = ssh.run {
    session(remotes.web01) {
      execute("sysctl '$paramKey' | sed -e 's/ //g'")
    }
  }
  assert paramValue.contains(paramKey)
  ssh.run {
    session(remotes.web02) {
      execute("sysctl -w '$paramValue'")
    }
  }
}
```

### 更多关于SSH会话的示例
```gradle
session([remotes.web01, remotes.web02]) {
  //execute ...
}
```
```gradle
session(remotes.web01, remotes.web02) {
  //execute ...
}
```
```gradle
session(host: '192.168.1.101', user: 'jenkins', identity: file('id_rsa')) {
  //execute ...
}
```

### SSH操作描述
示例：
```gradle
session(remotes.web01) {
  // 执行一个命令
  def result = execute 'uptime'

  // 在session闭包中，任意Gradle方法或属性都是可用的
  copy {
    from "src/main/resources/example"
    into "$buildDir/tmp"
  }

  // 同时Groovy的方法或属性在session闭包中，也是可用的
  println result
}
```
下面方法在session闭包中都是可用的：
+ `execute`：执行命令
+ `executeBackground`：在后台执行命令
+ `executeSudo`：支持用sudo来执行命令
+ `shell`：执行一个shell脚本
+ `put`：把文件或目录放到远程主机
+ `get`：从远程主机得到文件或目录
