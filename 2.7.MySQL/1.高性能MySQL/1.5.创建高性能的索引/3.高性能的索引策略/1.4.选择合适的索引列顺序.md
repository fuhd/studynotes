选择合适的索引列顺序
================================================================================
我们遇到的最容易引起困惑的问题就是 **索引列的顺序**。**正确的顺序依赖于使用该索引的查询**，并且同
时需要考虑如何更好地满足 **排序** 和 **分组** 的需要（顺便说明，**本节内容适用于B-Tree索引**，
哈希或者其他类型的索引并不会像B-Tree索引一样按顺序存储数据）。

在一个 **多列B-Tree索引** 中，索引列的顺序意味着 **索引首先按照最左列进行排序，其次是第二列，等
等**。所以，索引可以按照 **升序** 或者 **降序** 进行扫描，以满足 **精确符合列顺序的ORDER BY、
GROUP BY和DISTINCT等子句的查询需求**。

所以 **多列索引的列顺序至关重要**。在Lahdenmaki和Leach的 **“三星索引”系统中，列顺序也决定了一
个索引是否能够成为一个真正的”三星索引”**。

对于如何选择索引的列顺序有一个经验法则：**将选择性最高的列放到索引最前列**。这个建议有用吗？**在
某些场景可能有帮助，但通常不如避免随机IO和排序那么重要**，考虑问题需要更全面（场景不同则选择不同，
**没有一个放之四海皆准的法则**。这里只是说明，这个经验法则可能没有你想象的重要）。

**当不需要考虑排序和分组时，将选择性最高的列放在前面通常是很好的。这时候索引的作用只是用于优化WHERE
条件的查找**。在这种情况下，这样设计的索引确实能够最快地过滤出需要的行，对于在WHERE子句中只使用了索
引部分前缀列的查询来说选择性也更高。然而，**性能不只是依赖于所有索引列的选择性（整体基数），也和查询
条件的具体值有关**，也就是和值的分布有关。这和前面介绍的选择前缀的长度需要考虑的地方一样。**可能需要
根据那些运行频率最高的查询来调整索引列的顺序**，让这种情况下索引的选择性最高。

以下面的查询为例：
```sql
SELECT * FROM payment WHERE staff_id = 2 AND customer_id = 584;
```
是应该创建一个(staff_id, customer_id)索引还是应该颠倒一下顺序？可以跑一些查询来确定在这个表中
值的分布情况，并确定哪个列的选择性更高。先用下面的查询预测一下，看看各个WHERE条件的分支对应的数据
基数有多大：







































ddd
