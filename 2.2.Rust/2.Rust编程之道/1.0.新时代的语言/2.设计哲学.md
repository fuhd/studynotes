设计哲学
================================================================================
Rust语言遵循三条设计哲学：
+ **内存安全**；
+ **零成本抽象**；
+ **实用性**；

## 1.内存安全
现代编程语言早已发展到了“**程序即类型证明**”的阶段，**类型系统基本已经成为了各大编程语言的标配**。
类型系统提供了以下好处：
+ **允许编译器侦测无意义甚至无效的代码，暴露程序中隐含的错误**。
+ **可以为编译器提供有意义的类型信息，帮助优化代码**。
+ **可以增强代码的可读性，更直白地阐述开发者的意图**。
+ **提供了一定程度的高级抽象，提升开发效率**。

一般来说，**一门语言只要保证类型安全，就可以说它是一门安全的语言**。简单来说，**类型安全是指类型
系统可以保证程序的行为是意义明确、不出错的**。像C/C++语言的类型系统就不是类型安全的，因为它们并
没有对无意义的行为进行约束。一个最简单的例子就是数组越界，在C/C++语言中并不对其做任何检查，导致
发生了语言规范规定之外的行为，也就是未定义行为（`Undefined Behavior`）。

**Rust语言如果想保证内存安全，首先要做的就是保证类型安全**。

**在诸多编程语言中，OCaml和Haskell是公认的类型安全的典范，它们的类型系统不仅仅有强大的类型论理
论“背书”，而且在实践生产环境中也久经考验**。所以，Rust语言借鉴了它们的类型系统来保证类型安全，尤
其是Haskell，**你能在Rust语言中看到更多Haskell类型系统的影子**。

然而，**直接使用Haskell的类型系统也无法解决内存安全问题。类型系统的作用是定义编程语言中值和表达
式的类型，将它们归类，赋予它们不同的行为，指导它们如何相互作用。Haskell是一门纯函数式编程语言，
它的类型系统主要用于承载其“纯函数式”的思想，是范畴论的体现。而对于Rust来说，它的类型系统要承载其
“内存安全”的思想。所以，还需要有一个安全内存管理模型，并通过类型系统表达出来，才能保证内存安全**。

那么，**什么是内存安全呢？** 简单来说，**就是不会出现内存访问错误**。

**只有当程序访问未定义内存的时候才会产生内存错误**。一般来说，发生以下几种情况就是会产生内存错误：
+ **引用空指针**；
+ **使用未初始化内存**；
+ **释放后使用，也就是使用悬垂指针**；
+ **缓冲区溢出，比如数组越界**；
+ **非法释放已经释放过的指针或未分配的指针，也就是重复释放**；

为了保证内存安全，Rust语言建立了严格的 **安全内存管理模型**：
+ **所有权系统**：每个被分配的内存都有一个独占其所有权的指针。只有当该指针被销毁时，其对应的内存
才能随之被释放。
+ **借用和生命周期**：每个变量都有其生命周期，一旦超出生命周期，变量就会被自动释放。如果是借用，
则可以通过标记生命周期参数供编译器检查的方式，防止出现悬垂指针，也就是释放后使用的情况。

**其中所有权系统还包括了从现代C++那里借鉴的RAII机制，这是Rust无GC但是可以安全管理内存的基石**。

**建立了安全内存管理模型之后，再用类型系统表达出来即可**。Rust从Haskell的类型系统那里 **借鉴**
了以下特性：
+ 没有空指针；
+ 默认不可变；
+ 表达式；
+ 高阶函数；
+ 代数数据类型；
+ 模式匹配；
+ 泛型；
+ trait和关联类型；
+ 本地类型推导；

为了实现内存安全，Rust还具备以下 **独有的特性**：
+ **仿射类型（`Affine Type`），该类型用来表达Rust所有权中的Move语义**；
+ **借用、生命周期**；

借助类型系统的强大，Rust编译器可以在编译期对类型进行检查，看其是否满足安全内存模型，在编译期就能
发现内存不安全问题，有效地阻止未定义行为的发生。

**内存安全的Bug和并发安全的Bug产生的内在原因是相同的，都是因为内存的不正当访问而造成的。同样，利
用装载了所有权的强大类型系统，Rust还解决了并发安全的问题。Rust编译器会通过静态检查分析，在编译期
就检查出多线程并发代码中所有的数据竞争问题**。

## 2.零成本抽象
**编程语言如果想做到高效开发，就必须拥有一定的抽象表达能力**。关于抽象表达能力，最具代表性的语言
就是Ruby。Ruby代码和Rust代码的对比示意如下：
```ruby
# Ruby代码
5.times{puts "Hello Ruby"}
2.days.from_now
```
代码分别表示“输出5次Hello Ruby”和“从现在开始两天后”，代码的抽象表达能力已经非常接近自然语言。
```rust
//rust代码
5.times(|| println!("Hello Rust"));
2.days().from_now();
```





























































dd
